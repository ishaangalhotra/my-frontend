<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Forgot Password • QuickLocal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Fonts & icons (optional but matches login page style) -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4338ca;
      --primary-soft: rgba(99, 102, 241, 0.08);
      --bg: #0b1120;
      --card: #020617;
      --border: #1e293b;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --error: #ef4444;
      --success: #22c55e;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top, #1d2340 0, #020617 55%, #020617 100%);
      color: var(--text);
    }

    .wrapper {
      width: 100%;
      max-width: 420px;
      padding: 24px;
    }

    .card {
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.99));
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      box-shadow: 0 20px 45px rgba(15, 23, 42, 0.75);
      padding: 24px 22px 22px;
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .card-header-icon {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #a5b4fc, #6366f1 60%, #4338ca 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.5), 0 12px 25px rgba(79, 70, 229, 0.65);
    }

    h1 {
      font-size: 1.25rem;
      margin: 0;
    }

    p.subtitle {
      margin: 4px 0 18px;
      color: var(--muted);
      font-size: 0.85rem;
    }

    .form-group {
      margin-bottom: 14px;
    }

    label {
      display: block;
      font-size: 0.8rem;
      margin-bottom: 4px;
      color: #cbd5f5;
    }

    input[type="email"] {
      width: 100%;
      padding: 11px 12px;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.85);
      color: var(--text);
      font-size: 0.9rem;
      outline: none;
      transition: border 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    input[type="email"]:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.4);
      background: rgba(15, 23, 42, 0.92);
    }

    .hint {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 3px;
    }

    .status {
      margin-top: 10px;
      padding: 10px 11px;
      border-radius: 10px;
      font-size: 0.8rem;
      display: none;
      line-height: 1.35;
    }

    .status.success {
      background: rgba(22, 163, 74, 0.09);
      border: 1px solid rgba(34, 197, 94, 0.5);
      color: #bbf7d0;
    }

    .status.error {
      background: rgba(239, 68, 68, 0.08);
      border: 1px solid rgba(248, 113, 113, 0.7);
      color: #fecaca;
    }

    .status.info {
      background: rgba(59, 130, 246, 0.09);
      border: 1px solid rgba(96, 165, 250, 0.6);
      color: #bfdbfe;
    }

    button[type="submit"] {
      width: 100%;
      margin-top: 10px;
      padding: 11px 12px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #6366f1, #4f46e5);
      color: white;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 10px 25px rgba(79, 70, 229, 0.5);
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.15s ease;
    }

    button[type="submit"]:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 14px 30px rgba(79, 70, 229, 0.65);
      background: linear-gradient(135deg, #4f46e5, #4338ca);
    }

    button[type="submit"]:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      box-shadow: none;
    }

    .btn-icon {
      font-size: 0.95rem;
    }

    .footer-link {
      margin-top: 14px;
      text-align: center;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .footer-link a {
      color: #c4b5fd;
      text-decoration: none;
    }

    .footer-link a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="card">
      <div class="card-header">
        <div class="card-header-icon">
          <i class="fas fa-key"></i>
        </div>
        <div>
          <h1>Forgot your password?</h1>
          <p class="subtitle">Enter the email linked to your QuickLocal account and we’ll send you reset instructions.</p>
        </div>
      </div>

      <form id="forgotForm">
        <div class="form-group">
          <label for="email">Account email</label>
          <input id="email" type="email" placeholder="you@example.com" autocomplete="email" required />
          <div class="hint">Use the same email you use to log in or receive order updates.</div>
        </div>

        <div id="status" class="status"></div>

        <button type="submit" id="submitBtn">
          <span class="btn-icon"><i class="fas fa-paper-plane"></i></span>
          <span>Send reset link</span>
        </button>
      </form>

      <div class="footer-link">
        <a href="login.html"><i class="fas fa-arrow-left"></i> Back to login</a>
      </div>
    </div>
  </div>

  <script>
    (function() {
      const API = 'https://ecommerce-backend-mlik.onrender.com/api/v1/auth';
      const emailInput = document.getElementById('email');
      const form = document.getElementById('forgotForm');
      const statusEl = document.getElementById('status');
      const submitBtn = document.getElementById('submitBtn');

      function setStatus(message, type) {
        statusEl.textContent = message;
        statusEl.className = 'status ' + (type || 'info');
        statusEl.style.display = message ? 'block' : 'none';
      }

      function setLoading(isLoading) {
        submitBtn.disabled = isLoading;
        submitBtn.innerHTML = isLoading
          ? '<span class="btn-icon"><i class="fas fa-spinner fa-spin"></i></span><span>Sending...</span>'
          : '<span class="btn-icon"><i class="fas fa-paper-plane"></i></span><span>Send reset link</span>';
      }

      // Prefill email from query string if present
      try {
        const params = new URLSearchParams(window.location.search);
        const prefillEmail = params.get('email');
        if (prefillEmail) {
          emailInput.value = decodeURIComponent(prefillEmail);
        }
      } catch (e) {
        console.warn('Could not parse query params for email:', e);
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = emailInput.value.trim();

        if (!email || !email.includes('@')) {
          return setStatus('Please enter a valid email address.', 'error');
        }

        setLoading(true);
        setStatus('Sending reset instructions...', 'info');

        try {
          const res = await fetch(API + '/forgot-password', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: JSON.stringify({ email })
          });

          const data = await res.json().catch(() => ({}));

          if (!res.ok) {
            throw new Error(data.message || 'Unable to send reset email.');
          }

          // Backend already hides whether email exists – we just show generic success
          setStatus(
            data.message || 'If an account with that email exists, a reset link has been sent.',
            'success'
          );

        } catch (err) {
          console.error('Forgot password error:', err);
          setStatus(err.message || 'Something went wrong. Please try again.', 'error');
        } finally {
          setLoading(false);
        }
      });
    })();
  </script>
</body>
</html>
