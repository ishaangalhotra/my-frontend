<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickLocal Admin Dashboard</title>
    <meta name="description" content="QuickLocal administration panel for managing deliveries, orders, and sellers">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdn.tailwindcss.com" as="script">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/chart.js" as="script">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš¡</text></svg>">
    
    <!-- CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* Performance optimized animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
        
        .animate-slide-in {
            animation: slideIn 0.5s ease-out forwards;
        }
        
        /* Optimized hover effects */
        .stat-card {
            will-change: transform, box-shadow;
            transition: 
                transform 0.2s ease-out,
                box-shadow 0.2s ease-out;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        /* Enhanced gradient cards */
        .revenue-card {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .orders-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .customers-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .products-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .categories-card {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        
        /* Sidebar transitions */
        .sidebar-link {
            transition: 
                background-color 0.15s ease,
                border-color 0.15s ease,
                transform 0.15s ease;
        }
        
        .sidebar-link:hover {
            transform: translateX(2px);
        }
        
        .sidebar-link.active {
            background-color: rgba(59, 130, 246, 0.1);
            border-left: 4px solid #3b82f6;
            color: #3b82f6 !important;
        }
        
        /* Section visibility */
        .section-hidden {
            display: none;
        }

        /* Form styles */
        .form-section {
            margin-top: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        /* Button styles */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        /* Loading states */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Status colors */
        .status-pending { color: #f59e0b; }
        .status-processing { color: #3b82f6; }
        .status-shipped { color: #8b5cf6; }
        .status-delivered { color: #10b981; }
        .status-cancelled { color: #ef4444; }

        /* Enhanced table styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .data-table th,
        .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #f1f5f9;
        }

        .data-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }

        .data-table tr:hover {
            background-color: #f8fafc;
        }

        /* Notification styles */
        .notification-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 400px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .notification-toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .notification-success {
            border-left: 4px solid #10b981;
        }

        .notification-error {
            border-left: 4px solid #ef4444;
        }

        .notification-warning {
            border-left: 4px solid #f59e0b;
        }

        .notification-info {
            border-left: 4px solid #3b82f6;
        }

        /* Product grid styles */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .product-content {
            padding: 20px;
        }

        /* Category grid styles */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .category-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .category-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Responsive improvements */
        @media (max-width: 768px) {
            .stat-card {
                padding: 1rem;
            }
            
            .ml-64 {
                margin-left: 0;
            }
            
            .fixed.inset-y-0.left-0.w-64 {
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
            }
            
            .sidebar-open .fixed.inset-y-0.left-0.w-64 {
                transform: translateX(0);
            }

            .product-grid,
            .category-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Line clamp utilities */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* API status indicator */
        .api-status {
            display: inline-flex;
            align-items: center;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 20px;
        }

        .api-status.connected {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .api-status.disconnected {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        /* Enhanced search */
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px 12px 50px;
            border: 2px solid #e5e7eb;
            border-radius: 25px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans antialiased">
    <!-- Skip to content link for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:bg-blue-600 focus:text-white focus:px-4 focus:py-2 focus:rounded focus:z-50">
        Skip to content
    </a>

    <!-- Mobile sidebar toggle -->
    <button id="sidebar-toggle" class="fixed top-4 left-4 z-50 p-2 bg-white rounded-lg shadow-lg md:hidden">
        <i class="fas fa-bars text-xl"></i>
    </button>

    <!-- Sidebar -->
    <div id="sidebar" class="fixed inset-y-0 left-0 z-40 w-64 bg-white shadow-xl flex flex-col">
        <!-- Logo -->
        <div class="flex items-center justify-center h-16 revenue-card text-white">
            <i class="fas fa-bolt text-2xl mr-2" aria-hidden="true"></i>
            <span class="text-xl font-bold">QuickLocal Admin</span>
        </div>
        
        <!-- Navigation -->
        <nav class="mt-8 flex-1 overflow-y-auto">
            <div class="px-4 space-y-1">
                <a href="#" class="sidebar-link active flex items-center px-4 py-3 text-gray-700 rounded-lg" data-section="dashboard" aria-current="page">
                    <i class="fas fa-chart-line mr-3" aria-hidden="true"></i>
                    <span>Dashboard</span>
                </a>
                
                <a href="#" class="sidebar-link flex items-center px-4 py-3 text-gray-700 rounded-lg" data-section="products">
                    <i class="fas fa-shopping-bag mr-3" aria-hidden="true"></i>
                    <span>Products</span>
                </a>
                
                <a href="#" class="sidebar-link flex items-center px-4 py-3 text-gray-700 rounded-lg" data-section="categories">
                    <i class="fas fa-tags mr-3" aria-hidden="true"></i>
                    <span>Categories</span>
                </a>
                
                <a href="#" class="sidebar-link flex items-center px-4 py-3 text-gray-700 rounded-lg" data-section="orders">
                    <i class="fas fa-box mr-3" aria-hidden="true"></i>
                    <span>Orders</span>
                    <span class="ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full" id="pending-orders-count">0</span>
                </a>
                
                <a href="#" class="sidebar-link flex items-center px-4 py-3 text-gray-700 rounded-lg" data-section="sellers">
                    <i class="fas fa-store mr-3" aria-hidden="true"></i>
                    <span>Sellers</span>
                </a>
                
                <a href="#" class="sidebar-link flex items-center px-4 py-3 text-gray-700 rounded-lg" data-section="customers">
                    <i class="fas fa-users mr-3" aria-hidden="true"></i>
                    <span>Customers</span>
                </a>
                
                <a href="#" class="sidebar-link flex items-center px-4 py-3 text-gray-700 rounded-lg" data-section="analytics">
                    <i class="fas fa-chart-bar mr-3" aria-hidden="true"></i>
                    <span>Analytics</span>
                </a>
                
                <a href="#" class="sidebar-link flex items-center px-4 py-3 text-gray-700 rounded-lg" data-section="settings">
                    <i class="fas fa-cog mr-3" aria-hidden="true"></i>
                    <span>Settings</span>
                </a>
            </div>
        </nav>
        
        <!-- Bottom Section -->
        <div class="p-4 border-t border-gray-200">
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white">
                        <i class="fas fa-user" aria-hidden="true"></i>
                    </div>
                    <div class="ml-3 flex-1">
                        <p class="text-sm font-medium text-gray-800" id="admin-name">Admin User</p>
                        <p class="text-xs text-gray-500" id="admin-email">admin@quicklocal.com</p>
                    </div>
                </div>
                <button class="mt-3 w-full bg-white text-gray-700 px-3 py-2 rounded-lg text-sm hover:bg-gray-50 transition-colors flex items-center justify-center" onclick="logout()" aria-label="Logout">
                    <i class="fas fa-sign-out-alt mr-2" aria-hidden="true"></i>
                    Logout
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="ml-64 flex flex-col min-h-screen" id="main-layout">
        <!-- Top Bar -->
        <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-30">
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between px-6 py-4">
                <div class="mb-2 sm:mb-0">
                    <h1 class="text-xl sm:text-2xl font-bold text-gray-800" id="page-title">Dashboard Overview</h1>
                    <p class="text-sm sm:text-base text-gray-600" id="page-subtitle">Welcome back! Here's what's happening today.</p>
                </div>
                
                <div class="flex items-center space-x-3 sm:space-x-4 w-full sm:w-auto">
                    <!-- API Status -->
                    <div id="api-status" class="api-status disconnected">
                        <i class="fas fa-circle mr-2"></i>
                        <span>API Disconnected</span>
                    </div>
                    
                    <!-- Refresh Button -->
                    <button class="p-2 text-gray-600 hover:text-gray-800 transition-colors" onclick="refreshCurrentSection()" aria-label="Refresh">
                        <i class="fas fa-sync-alt text-xl" id="refresh-icon"></i>
                    </button>
                    
                    <!-- Profile -->
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-sm font-medium">
                            A
                        </div>
                        <span class="text-gray-700 font-medium hidden sm:inline">Admin</span>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Main Content Area -->
        <main id="main-content" class="flex-1 p-4 sm:p-6">
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="content-section">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 sm:gap-6 mb-6 sm:mb-8">
                    <!-- Total Revenue -->
                    <div class="stat-card bg-white rounded-xl shadow-sm hover:shadow-md p-4 sm:p-6 animate-fade-in revenue-card text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white opacity-90 text-xs sm:text-sm mb-1">Total Revenue</p>
                                <p class="text-2xl sm:text-3xl font-bold" id="totalRevenue">â‚¹0</p>
                            </div>
                            <div class="bg-white bg-opacity-20 p-2 sm:p-3 rounded-full">
                                <i class="fas fa-rupee-sign text-white text-lg sm:text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Total Orders -->
                    <div class="stat-card bg-white rounded-xl shadow-sm hover:shadow-md p-4 sm:p-6 animate-fade-in orders-card text-white" style="animation-delay: 0.1s">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white opacity-90 text-xs sm:text-sm mb-1">Total Orders</p>
                                <p class="text-2xl sm:text-3xl font-bold" id="totalOrders">0</p>
                            </div>
                            <div class="bg-white bg-opacity-20 p-2 sm:p-3 rounded-full">
                                <i class="fas fa-box text-white text-lg sm:text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Total Products -->
                    <div class="stat-card bg-white rounded-xl shadow-sm hover:shadow-md p-4 sm:p-6 animate-fade-in products-card text-white" style="animation-delay: 0.2s">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white opacity-90 text-xs sm:text-sm mb-1">Total Products</p>
                                <p class="text-2xl sm:text-3xl font-bold" id="totalProducts">0</p>
                            </div>
                            <div class="bg-white bg-opacity-20 p-2 sm:p-3 rounded-full">
                                <i class="fas fa-shopping-bag text-white text-lg sm:text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Total Categories -->
                    <div class="stat-card bg-white rounded-xl shadow-sm hover:shadow-md p-4 sm:p-6 animate-fade-in categories-card text-white" style="animation-delay: 0.3s">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white opacity-90 text-xs sm:text-sm mb-1">Categories</p>
                                <p class="text-2xl sm:text-3xl font-bold" id="totalCategories">0</p>
                            </div>
                            <div class="bg-white bg-opacity-20 p-2 sm:p-3 rounded-full">
                                <i class="fas fa-tags text-white text-lg sm:text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Total Customers -->
                    <div class="stat-card bg-white rounded-xl shadow-sm hover:shadow-md p-4 sm:p-6 animate-fade-in customers-card text-white" style="animation-delay: 0.4s">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white opacity-90 text-xs sm:text-sm mb-1">Customers</p>
                                <p class="text-2xl sm:text-3xl font-bold" id="totalCustomers">0</p>
                            </div>
                            <div class="bg-white bg-opacity-20 p-2 sm:p-3 rounded-full">
                                <i class="fas fa-users text-white text-lg sm:text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8">
                    <!-- Recent Orders -->
                    <div class="bg-white rounded-xl shadow-sm hover:shadow-md p-4 sm:p-6 animate-slide-in">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Recent Orders</h3>
                            <button class="text-blue-600 hover:text-blue-700 text-sm font-medium" onclick="loadRecentOrders()">
                                <i class="fas fa-sync-alt mr-1"></i> Refresh
                            </button>
                        </div>
                        <div id="recent-orders-list" class="space-y-3">
                            <div class="text-center text-gray-500 py-4">
                                <i class="fas fa-box-open text-2xl mb-2"></i>
                                <p>No recent orders</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- System Health -->
                    <div class="bg-white rounded-xl shadow-sm hover:shadow-md p-4 sm:p-6 animate-slide-in" style="animation-delay: 0.2s">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">System Health</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600">API Status</span>
                                <div class="flex items-center">
                                    <div class="w-2 h-2 rounded-full mr-2" id="api-health-dot"></div>
                                    <span class="font-semibold text-sm" id="api-health-text">Checking...</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600">Database</span>
                                <div class="flex items-center">
                                    <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                    <span class="font-semibold text-green-600 text-sm">Connected</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600">Admin Session</span>
                                <div class="flex items-center">
                                    <div class="w-2 h-2 rounded-full mr-2" id="session-health-dot"></div>
                                    <span class="font-semibold text-sm" id="session-health-text">Active</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Section -->
            <div id="products-section" class="content-section section-hidden">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Product Management</h2>
                        <p class="text-gray-600">Manage your product catalog and inventory</p>
                    </div>
                    <button class="btn" onclick="openProductModal()">
                        <i class="fas fa-plus mr-2"></i>Add Product
                    </button>
                </div>

                <!-- Search and Filters -->
                <div class="search-container">
                    <div class="search-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <input type="text" class="search-input" id="product-search" placeholder="Search products by name, category, or ID..." oninput="filterProducts()">
                </div>

                <!-- Products Grid -->
                <div class="product-grid" id="products-grid">
                    <div class="col-span-full text-center text-gray-500 py-8">
                        <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
                        <p>Loading products...</p>
                    </div>
                </div>
            </div>

            <!-- Categories Section -->
            <div id="categories-section" class="content-section section-hidden">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Category Management</h2>
                        <p class="text-gray-600">Organize your products with categories</p>
                    </div>
                    <button class="btn" onclick="openCategoryModal()">
                        <i class="fas fa-plus mr-2"></i>Add Category
                    </button>
                </div>

                <!-- Search and Filters -->
                <div class="search-container">
                    <div class="search-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <input type="text" class="search-input" id="category-search" placeholder="Search categories..." oninput="filterCategories()">
                </div>

                <!-- Categories Grid -->
                <div class="category-grid" id="categories-grid">
    <!-- Category Cards -->

</div>

<!-- Categories Table -->
<div class="bg-white rounded-xl shadow-sm overflow-hidden mt-6">
    <table class="data-table" id="categories-table">
        <thead>
            <tr>
                <th>Category Name</th>
                <th>Slug</th>
                <th>Description</th>
                <th>Image</th>
                <th>Product Count</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="categories-table-body">
            <tr>
                <td colspan="6" class="text-center py-8">
                    <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                    <p>Loading categories...</p>
                </td>
            </tr>
        </tbody>
    </table>
</div>
                    <div class="col-span-full text-center text-gray-500 py-8">
                        <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
                        <p>Loading categories...</p>
                    </div>
                </div>
            </div>

            <!-- Orders Section -->
            <div id="orders-section" class="content-section section-hidden">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Order Management</h2>
                        <p class="text-gray-600">Track and manage all customer orders</p>
                    </div>
                    <div class="flex gap-2">
                        <select class="form-control" id="order-status-filter" onchange="filterOrders()">
                            <option value="">All Orders</option>
                            <option value="pending">Pending</option>
                            <option value="processing">Processing</option>
                            <option value="shipped">Shipped</option>
                            <option value="delivered">Delivered</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                        <button class="btn" onclick="refreshOrders()">
                            <i class="fas fa-sync-alt mr-2"></i>Refresh
                        </button>
                    </div>
                </div>

                <!-- Orders Table -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <table class="data-table" id="orders-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="orders-table-body">
                            <tr>
                                <td colspan="7" class="text-center py-8">
                                    <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                    <p>Loading orders...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sellers Section -->
            <div id="sellers-section" class="content-section section-hidden">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Seller Management</h2>
                        <p class="text-gray-600">Manage and monitor seller performance</p>
                    </div>
                    <button class="btn" onclick="refreshSellers()">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                </div>

                <!-- Sellers Table -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <table class="data-table" id="sellers-table">
                        <thead>
                            <tr>
                                <th>Seller Name</th>
                                <th>Email</th>
                                <th>Products</th>
                                <th>Orders</th>
                                <th>Revenue</th>
                                <th>Rating</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="sellers-table-body">
                            <tr>
                                <td colspan="8" class="text-center py-8">
                                    <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                    <p>Loading sellers...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Customers Section -->
            <div id="customers-section" class="content-section section-hidden">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Customer Management</h2>
                        <p class="text-gray-600">View and manage customer relationships</p>
                    </div>
                    <button class="btn" onclick="refreshCustomers()">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                </div>

                <!-- Customers Table -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <table class="data-table" id="customers-table">
                        <thead>
                            <tr>
                                <th>Customer Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Orders</th>
                                <th>Total Spent</th>
                                <th>Join Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="customers-table-body">
                            <tr>
                                <td colspan="8" class="text-center py-8">
                                    <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                    <p>Loading customers...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analytics-section" class="content-section section-hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Analytics Dashboard</h2>
                    <p class="text-gray-600">Insights and performance metrics</p>
                </div>

                <!-- Charts Row -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Revenue Chart -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-800">Revenue Trends</h3>
                            <select class="form-control" onchange="updateRevenueChart(this.value)">
                                <option value="7">Last 7 days</option>
                                <option value="30" selected>Last 30 days</option>
                                <option value="90">Last 3 months</option>
                            </select>
                        </div>
                        <div style="height: 300px; position: relative;">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Category Distribution -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-6">Sales by Category</h3>
                        <div style="height: 300px; position: relative;">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Top Products</h4>
                        <div id="top-products-list" class="space-y-3">
                            <div class="text-center text-gray-500 py-4">Loading...</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Top Categories</h4>
                        <div id="top-categories-list" class="space-y-3">
                            <div class="text-center text-gray-500 py-4">Loading...</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Recent Activity</h4>
                        <div id="recent-activity-list" class="space-y-3">
                            <div class="text-center text-gray-500 py-4">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings-section" class="content-section section-hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Settings</h2>
                    <p class="text-gray-600">Configure your admin preferences</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- API Configuration -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">API Configuration</h3>
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">API Base URL</label>
                            <input type="url" id="api-base-url" class="form-control" value="https://quicklocal-backend.onrender.com" placeholder="Enter API base URL">
                        </div>
                        <button class="btn mt-4" onclick="testApiConnection()">
                            <i class="fas fa-plug mr-2"></i>Test Connection
                        </button>
                    </div>

                    <!-- Admin Profile -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Admin Profile</h3>
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Name</label>
                            <input type="text" id="admin-profile-name" class="form-control" value="Admin User">
                        </div>
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" id="admin-profile-email" class="form-control" value="admin@quicklocal.com">
                        </div>
                        <button class="btn mt-4" onclick="updateProfile()">
                            <i class="fas fa-save mr-2"></i>Update Profile
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    
    <!-- Product Modal -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-800" id="product-modal-title">Add Product</h2>
                <button class="text-gray-400 hover:text-gray-600" onclick="closeProductModal()">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="product-form" onsubmit="handleProductSubmit(event)">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-group">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Product Name *</label>
                        <input type="text" id="product-name" name="name" required class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Price (â‚¹) *</label>
                        <input type="number" id="product-price" name="price" required min="0" step="0.01" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Category *</label>
                        <select id="product-category" name="category" required class="form-control">
                            <option value="">Select Category</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Stock Quantity</label>
                        <input type="number" id="product-stock" name="stockQuantity" min="0" class="form-control" value="0">
                    </div>
                    
                    <div class="form-group">
    <label class="block text-sm font-medium text-gray-700 mb-2">Slug</label>
    <input type="text" id="product-slug" name="slug" class="form-control" placeholder="auto-generated if empty">
</div>

<div class="form-group md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="product-description" name="description" rows="4" class="form-control"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Image URL</label>
                        <input type="url" id="product-image" name="image" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Discount (%)</label>
                        <input type="number" id="product-discount" name="discountPercentage" min="0" max="100" step="0.01" class="form-control" value="0">
                    </div>
                </div>
                
                <div class="flex justify-end gap-4 mt-6">
                    <button type="button" class="btn bg-gray-500 hover:bg-gray-600" onclick="closeProductModal()">
                        <i class="fas fa-times mr-2"></i>Cancel
                    </button>
                    <button type="submit" class="btn" id="product-submit-btn">
                        <i class="fas fa-save mr-2"></i>Save Product
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="category-modal" class="modal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-800" id="category-modal-title">Add Category</h2>
                <button class="text-gray-400 hover:text-gray-600" onclick="closeCategoryModal()">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="category-form" onsubmit="handleCategorySubmit(event)">
                <div class="form-group">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category Name *</label>
                    <input type="text" id="category-name" name="name" required class="form-control">
                </div>
                
                <div class="form-group">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Slug</label>
                    <input type="text" id="category-slug" name="slug" class="form-control" placeholder="auto-generated if empty">
                </div>
                
                <div class="form-group">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea id="category-description" name="description" rows="3" class="form-control"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Image URL</label>
                    <input type="url" id="category-image" name="image" class="form-control">
                </div>
                
                <div class="flex justify-end gap-4 mt-6">
                    <button type="button" class="btn bg-gray-500 hover:bg-gray-600" onclick="closeCategoryModal()">
                        <i class="fas fa-times mr-2"></i>Cancel
                    </button>
                    <button type="submit" class="btn" id="category-submit-btn">
                        <i class="fas fa-save mr-2"></i>Save Category
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Global variables and state
        let currentSection = 'dashboard';
        let API_BASE = 'https://quicklocal-backend.onrender.com';
        let isAPIConnected = false;
        let authToken = null;
        let dashboardData = {
            products: [],
            categories: [],
            orders: [],
            customers: [],
            sellers: []
        };
        let charts = {};
        let currentEditingId = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ QuickLocal Admin Dashboard initializing...');
            
            initializeAuth();
            initializeDashboard();
            setupEventListeners();
            testApiConnection();
            
            console.log('âœ… Dashboard initialization complete');
        });

        // Initialize authentication
        function initializeAuth() {
            authToken = localStorage.getItem('qk_token');
            if (!authToken) {
                showNotification('Please login to access the admin dashboard', 'error');
                // Redirect to login page or show login form
                return;
            }
            
            // Update session health
            updateSessionHealth(true);
        }

        // Initialize dashboard components
        function initializeDashboard() {
            showSection('dashboard');
            updateApiStatus(false);
        }

        // Setup event listeners
        function setupEventListeners() {
            // Sidebar navigation
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = link.dataset.section;
                    showSection(section);
                    
                    // Update active state
                    document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                });
            });

            // Mobile sidebar toggle
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const mainLayout = document.getElementById('main-layout');
            
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', () => {
                    document.body.classList.toggle('sidebar-open');
                });
            }

            // Auto-generate slug for category name
            const categoryNameInput = document.getElementById('category-name');
            const categorySlugInput = document.getElementById('category-slug');
            
            if (categoryNameInput && categorySlugInput) {
                categoryNameInput.addEventListener('input', (e) => {
                    const slug = e.target.value
                        .toLowerCase()
                        .replace(/[^a-z0-9]+/g, '-')
                        .replace(/(^-|-$)/g, '');
                    categorySlugInput.value = slug;
                });
            }

            // Close modals when clicking outside
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    closeAllModals();
                }
            });

            // Escape key to close modals
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeAllModals();
                }
            });
        }

        // Show specific section
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('section-hidden');
            });

            // Show selected section
            const targetSection = document.getElementById(`${sectionName}-section`);
            if (targetSection) {
                targetSection.classList.remove('section-hidden');
            }

            // Update page titles
            const titles = {
                dashboard: { title: 'Dashboard Overview', subtitle: "Welcome back! Here's what's happening today." },
                products: { title: 'Product Management', subtitle: 'Manage your product catalog and inventory' },
                categories: { title: 'Category Management', subtitle: 'Organize your products with categories' },
                orders: { title: 'Order Management', subtitle: 'Track and manage all customer orders' },
                sellers: { title: 'Seller Management', subtitle: 'Manage and monitor seller performance' },
                customers: { title: 'Customer Management', subtitle: 'View and manage customer relationships' },
                analytics: { title: 'Analytics Dashboard', subtitle: 'Insights and performance metrics' },
                settings: { title: 'Settings', subtitle: 'Configure your admin preferences' }
            };

            const pageInfo = titles[sectionName] || titles.dashboard;
            const titleEl = document.getElementById('page-title');
            const subtitleEl = document.getElementById('page-subtitle');
            
            if (titleEl) titleEl.textContent = pageInfo.title;
            if (subtitleEl) subtitleEl.textContent = pageInfo.subtitle;

            currentSection = sectionName;
            
            // Load section-specific data
            loadSectionData(sectionName);
        }

        // Load section-specific data
        async function loadSectionData(sectionName) {
            switch(sectionName) {
                case 'dashboard':
                    await loadDashboardData();
                    break;
                case 'products':
                    await loadProductsData();
                    break;
                case 'categories':
                    await loadCategoriesData();
                    break;
                case 'orders':
                    await loadOrdersData();
                    break;
                case 'sellers':
                    await loadSellersData();
                    break;
                case 'customers':
                    await loadCustomersData();
                    break;
                case 'analytics':
                    await loadAnalyticsData();
                    break;
            }
        }

        // API Helper Functions
        async function apiRequest(endpoint, options = {}) {
            const url = `${API_BASE}${endpoint}`;
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    ...(authToken && { 'Authorization': `Bearer ${authToken}` }),
                    ...options.headers
                },
                ...options
            };

            try {
                const response = await fetch(url, config);
                
                if (response.status === 401) {
                    handleAuthError();
                    return null;
                }

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || data.error || `HTTP ${response.status}`);
                }

                return data;
            } catch (error) {
                console.error(`API Error (${endpoint}):`, error);
                throw error;
            }
        }

        // Handle authentication errors
        function handleAuthError() {
            localStorage.removeItem('qk_token');
            authToken = null;
            updateSessionHealth(false);
            showNotification('Session expired. Please login again.', 'error');
        }

        // Test API connection
        async function testApiConnection() {
            const statusEl = document.getElementById('api-status');
            const healthDot = document.getElementById('api-health-dot');
            const healthText = document.getElementById('api-health-text');
            
            try {
                // Test multiple endpoints
                const endpoints = ['/api/v1/products', '/api/v1/categories', '/'];
                let connected = false;

                for (const endpoint of endpoints) {
                    try {
                        await fetch(`${API_BASE}${endpoint}`, { 
                            method: 'HEAD',
                            timeout: 5000 
                        });
                        connected = true;
                        break;
                    } catch (error) {
                        continue;
                    }
                }

                isAPIConnected = connected;
                updateApiStatus(connected);
                
                if (healthDot && healthText) {
                    if (connected) {
                        healthDot.className = 'w-2 h-2 bg-green-500 rounded-full mr-2';
                        healthText.textContent = 'Connected';
                        healthText.className = 'font-semibold text-green-600 text-sm';
                    } else {
                        healthDot.className = 'w-2 h-2 bg-red-500 rounded-full mr-2';
                        healthText.textContent = 'Disconnected';
                        healthText.className = 'font-semibold text-red-600 text-sm';
                    }
                }

                console.log(`API Connection: ${connected ? 'Connected' : 'Failed'}`);
                
            } catch (error) {
                console.error('API Connection Test Failed:', error);
                isAPIConnected = false;
                updateApiStatus(false);
            }
        }

        // Update API status indicator
        function updateApiStatus(connected) {
            const statusEl = document.getElementById('api-status');
            if (statusEl) {
                statusEl.className = `api-status ${connected ? 'connected' : 'disconnected'}`;
                statusEl.innerHTML = `
                    <i class="fas fa-circle mr-2"></i>
                    <span>API ${connected ? 'Connected' : 'Disconnected'}</span>
                `;
            }
        }

        // Update session health indicator
        function updateSessionHealth(active) {
            const sessionDot = document.getElementById('session-health-dot');
            const sessionText = document.getElementById('session-health-text');
            
            if (sessionDot && sessionText) {
                if (active) {
                    sessionDot.className = 'w-2 h-2 bg-green-500 rounded-full mr-2';
                    sessionText.textContent = 'Active';
                    sessionText.className = 'font-semibold text-green-600 text-sm';
                } else {
                    sessionDot.className = 'w-2 h-2 bg-red-500 rounded-full mr-2';
                    sessionText.textContent = 'Expired';
                    sessionText.className = 'font-semibold text-red-600 text-sm';
                }
            }
        }

        // Load Dashboard Data
        async function loadDashboardData() {
            try {
                // Load all data in parallel
                const [products, categories, orders] = await Promise.allSettled([
                    loadProductsData(),
                    loadCategoriesData(), 
                    loadOrdersData()
                ]);

                // Update dashboard stats
                updateDashboardStats();
                loadRecentOrders();
                
            } catch (error) {
                console.error('Failed to load dashboard data:', error);
                showNotification('Failed to load dashboard data', 'error');
            }
        }

        // Update dashboard statistics
        function updateDashboardStats() {
            // Update stats from loaded data
            document.getElementById('totalProducts').textContent = dashboardData.products.length || 0;
            document.getElementById('totalCategories').textContent = dashboardData.categories.length || 0;
            document.getElementById('totalOrders').textContent = dashboardData.orders.length || 0;
            document.getElementById('totalCustomers').textContent = dashboardData.customers.length || 0;
            
            // Calculate total revenue
            const totalRevenue = dashboardData.orders.reduce((sum, order) => {
                return sum + (order.totalAmount || order.total || 0);
            }, 0);
            
            document.getElementById('totalRevenue').textContent = `â‚¹${totalRevenue.toLocaleString('en-IN')}`;
            
            // Update pending orders count
            const pendingOrders = dashboardData.orders.filter(order => 
                order.status === 'pending' || order.status === 'processing'
            ).length;
            
            const pendingCountEl = document.getElementById('pending-orders-count');
            if (pendingCountEl) {
                pendingCountEl.textContent = pendingOrders;
            }
        }

        // Load Products Data
        async function loadProductsData() {
            try {
                const response = await apiRequest('/api/v1/products');
                dashboardData.products = response.data || [];
                updateProductsDisplay();
                await loadCategoriesForSelect();
                
            } catch (error) {
                console.error('Failed to load products:', error);
                showProductsError();
            }
        }

        // Update products display
        function updateProductsDisplay() {
            const grid = document.getElementById('products-grid');
            const products = dashboardData.products;
            
            if (!grid) return;

            if (products.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center text-gray-500 py-8">
                        <i class="fas fa-shopping-bag text-4xl mb-4"></i>
                        <p>No products found. Add your first product!</p>
                    </div>
                `;
                return;
            }

            const productsHTML = products.map(product => {
                const imageUrl = product.images?.[0]?.url || product.image || 'https://via.placeholder.com/300x200?text=No+Image';
                const categoryName = product.category?.name || 'Uncategorized';
                const finalPrice = product.finalPrice || product.price;
                const originalPrice = product.price;
                const hasDiscount = finalPrice < originalPrice;

                return `
                    <div class="product-card">
                        <img src="${imageUrl}" alt="${product.name}" class="product-image" 
                             onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
                        <div class="product-content">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2 line-clamp-2">${product.name}</h3>
                            <p class="text-sm text-gray-600 mb-3 line-clamp-3">${product.description || 'No description available'}</p>
                            
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center space-x-2">
                                    ${hasDiscount ? 
                                        `<span class="text-lg font-bold text-green-600">â‚¹${finalPrice}</span>
                                         <span class="text-sm text-gray-500 line-through">â‚¹${originalPrice}</span>` :
                                        `<span class="text-lg font-bold text-gray-800">â‚¹${originalPrice}</span>`
                                    }
                                </div>
                                <span class="text-xs px-2 py-1 rounded-full ${product.inStock !== false ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                    ${product.inStock !== false ? 'In Stock' : 'Out of Stock'}
                                </span>
                            </div>
                            
                            <div class="mb-3">
                                <span class="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full">${categoryName}</span>
                                ${product.stockQuantity ? `<span class="text-xs text-gray-500 ml-2">Stock: ${product.stockQuantity}</span>` : ''}
                            </div>
                            
                            <div class="flex space-x-2">
                                <button class="flex-1 btn text-xs py-2" onclick="editProduct('${product._id}')">
                                    <i class="fas fa-edit mr-1"></i> Edit
                                </button>
                                <button class="flex-1 btn-danger text-xs py-2" onclick="deleteProduct('${product._id}', '${product.name}')">
                                    <i class="fas fa-trash mr-1"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            grid.innerHTML = productsHTML;
        }

        // Show products error
        function showProductsError() {
            const grid = document.getElementById('products-grid');
            if (grid) {
                grid.innerHTML = `
                    <div class="col-span-full text-center text-red-500 py-8">
                        <i class="fas fa-exclamation-circle text-4xl mb-4"></i>
                        <p>Failed to load products. Please check your connection.</p>
                        <button class="btn mt-4" onclick="loadProductsData()">
                            <i class="fas fa-retry mr-2"></i>Retry
                        </button>
                    </div>
                `;
            }
        }

        // Load Categories Data
        async function loadCategoriesData() {
            try {
                const response = await apiRequest('/api/v1/categories');
                dashboardData.categories = response.data || [];
                updateCategoriesDisplay();
                
            } catch (error) {
                console.error('Failed to load categories:', error);
                showCategoriesError();
            }
        }

        // Update categories display
        function updateCategoriesDisplay() {
            const grid = document.getElementById('categories-grid');
            const categories = dashboardData.categories;
            
            if (!grid) return;

            if (categories.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center text-gray-500 py-8">
                        <i class="fas fa-tags text-4xl mb-4"></i>
                        <p>No categories found. Add your first category!</p>
                    </div>
                `;
                return;
            }

            const categoriesHTML = categories.map(category => {
                const imageUrl = category.image || 'https://via.placeholder.com/250x150?text=' + encodeURIComponent(category.name);
                const productCount = dashboardData.products.filter(p => p.category?._id === category._id).length;

                return `
                    <div class="category-card">
                        <img src="${imageUrl}" alt="${category.name}" class="w-full h-32 object-cover" 
                             onerror="this.src='https://via.placeholder.com/250x150?text=' + encodeURIComponent('${category.name}')">
                        <div class="p-4">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">${category.name}</h3>
                            ${category.description ? `<p class="text-sm text-gray-600 mb-3 line-clamp-2">${category.description}</p>` : ''}
                            
                            <div class="flex items-center justify-between mb-3">
                                <span class="text-sm text-gray-500">${productCount} products</span>
                                ${category.slug ? `<span class="text-xs text-blue-600">/${category.slug}</span>` : ''}
                            </div>
                            
                            <div class="flex space-x-2">
                                <button class="flex-1 btn text-xs py-2" onclick="editCategory('${category._id}')">
                                    <i class="fas fa-edit mr-1"></i> Edit
                                </button>
                                <button class="flex-1 btn-danger text-xs py-2" onclick="deleteCategory('${category._id}', '${category.name}')">
                                    <i class="fas fa-trash mr-1"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            grid.innerHTML = categoriesHTML;
        }

        // Show categories error
        function showCategoriesError() {
            const grid = document.getElementById('categories-grid');
            if (grid) {
                grid.innerHTML = `
                    <div class="col-span-full text-center text-red-500 py-8">
                        <i class="fas fa-exclamation-circle text-4xl mb-4"></i>
                        <p>Failed to load categories. Please check your connection.</p>
                        <button class="btn mt-4" onclick="loadCategoriesData()">
                            <i class="fas fa-retry mr-2"></i>Retry
                        </button>
                    </div>
                `;
            }
        }

        // Load categories for product select dropdown
        async function loadCategoriesForSelect() {
            const select = document.getElementById('product-category');
            if (!select) return;

            select.innerHTML = '<option value="">Select Category</option>';
            
            dashboardData.categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category._id;
                option.textContent = category.name;
                select.appendChild(option);
            });
        }

        // Load Orders Data
        async function loadOrdersData() {
            try {
                const response = await apiRequest('/api/v1/orders');
                dashboardData.orders = response.data || [];
                updateOrdersDisplay();
                
            } catch (error) {
                console.error('Failed to load orders:', error);
                showOrdersError();
            }
        }

        // Update orders display
        function updateOrdersDisplay() {
            const tbody = document.getElementById('orders-table-body');
            const orders = dashboardData.orders;
            
            if (!tbody) return;

            if (orders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-8">
                            <i class="fas fa-shopping-cart text-2xl mb-2 text-gray-400"></i>
                            <p class="text-gray-500">No orders found</p>
                        </td>
                    </tr>
                `;
                return;
            }

            const ordersHTML = orders.map(order => {
                const statusClass = getStatusClass(order.status);
                const formattedDate = new Date(order.createdAt || order.date).toLocaleDateString('en-IN');
                const customerName = order.user?.name || order.customer?.name || order.customerName || 'Unknown Customer';
                const itemCount = order.items?.length || order.itemCount || 1;
                const totalAmount = order.totalAmount || order.total || 0;

                return `
                    <tr>
                        <td class="font-mono text-sm">${order._id || order.id}</td>
                        <td>${customerName}</td>
                        <td>${itemCount} items</td>
                        <td class="font-semibold">â‚¹${totalAmount.toLocaleString('en-IN')}</td>
                        <td>
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${statusClass}">
                                ${order.status || 'pending'}
                            </span>
                        </td>
                        <td>${formattedDate}</td>
                        <td>
                            <div class="flex space-x-1">
                                <button class="btn text-xs py-1 px-2" onclick="viewOrder('${order._id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-warning text-xs py-1 px-2" onclick="editOrderStatus('${order._id}', '${order.status}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');

            tbody.innerHTML = ordersHTML;
        }

        // Show orders error
        function showOrdersError() {
            const tbody = document.getElementById('orders-table-body');
            if (tbody) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-8">
                            <i class="fas fa-exclamation-circle text-2xl mb-2 text-red-500"></i>
                            <p class="text-red-500">Failed to load orders</p>
                            <button class="btn mt-2" onclick="loadOrdersData()">
                                <i class="fas fa-retry mr-1"></i>Retry
                            </button>
                        </td>
                    </tr>
                `;
            }
        }

        // Load Recent Orders for Dashboard
        async function loadRecentOrders() {
            const container = document.getElementById('recent-orders-list');
            if (!container) return;

            const recentOrders = dashboardData.orders
                .sort((a, b) => new Date(b.createdAt || b.date) - new Date(a.createdAt || a.date))
                .slice(0, 5);

            if (recentOrders.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-4">
                        <i class="fas fa-box-open text-2xl mb-2"></i>
                        <p>No recent orders</p>
                    </div>
                `;
                return;
            }

            const ordersHTML = recentOrders.map(order => {
                const customerName = order.user?.name || order.customer?.name || 'Unknown Customer';
                const statusClass = getStatusClass(order.status);
                const timeAgo = getTimeAgo(new Date(order.createdAt || order.date));

                return `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                        <div>
                            <div class="font-semibold text-gray-800">${order._id}</div>
                            <div class="text-sm text-gray-600">${customerName}</div>
                            <div class="text-xs text-gray-500">${timeAgo}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-gray-800">â‚¹${(order.totalAmount || order.total || 0).toLocaleString('en-IN')}</div>
                            <span class="text-xs px-2 py-1 rounded-full ${statusClass}">
                                ${order.status || 'pending'}
                            </span>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = ordersHTML;
        }

        // Load Customers Data
        async function loadCustomersData() {
            try {
                const response = await apiRequest('/api/v1/users');
                dashboardData.customers = response.data || [];
                updateCustomersDisplay();
                
            } catch (error) {
                console.error('Failed to load customers:', error);
                showCustomersError();
            }
        }

        // Update customers display
        function updateCustomersDisplay() {
            const tbody = document.getElementById('customers-table-body');
            const customers = dashboardData.customers;
            
            if (!tbody) return;

            if (customers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-8">
                            <i class="fas fa-users text-2xl mb-2 text-gray-400"></i>
                            <p class="text-gray-500">No customers found</p>
                        </td>
                    </tr>
                `;
                return;
            }

            const customersHTML = customers.map(customer => {
                const joinDate = new Date(customer.createdAt).toLocaleDateString('en-IN');
                const customerOrders = dashboardData.orders.filter(order => 
                    order.user?._id === customer._id || order.userId === customer._id
                );
                const totalSpent = customerOrders.reduce((sum, order) => sum + (order.totalAmount || order.total || 0), 0);
                const statusClass = customer.isActive !== false ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';

                return `
                    <tr>
                        <td class="font-medium">${customer.name || 'N/A'}</td>
                        <td>${customer.email || 'N/A'}</td>
                        <td>${customer.phone || 'N/A'}</td>
                        <td>${customerOrders.length}</td>
                        <td class="font-semibold">â‚¹${totalSpent.toLocaleString('en-IN')}</td>
                        <td>${joinDate}</td>
                        <td>
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${statusClass}">
                                ${customer.isActive !== false ? 'Active' : 'Inactive'}
                            </span>
                        </td>
                        <td>
                            <div class="flex space-x-1">
                                <button class="btn text-xs py-1 px-2" onclick="viewCustomer('${customer._id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-warning text-xs py-1 px-2" onclick="editCustomer('${customer._id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');

            tbody.innerHTML = customersHTML;
        }

        // Show customers error
        function showCustomersError() {
            const tbody = document.getElementById('customers-table-body');
            if (tbody) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-8">
                            <i class="fas fa-exclamation-circle text-2xl mb-2 text-red-500"></i>
                            <p class="text-red-500">Failed to load customers</p>
                            <button class="btn mt-2" onclick="loadCustomersData()">
                                <i class="fas fa-retry mr-1"></i>Retry
                            </button>
                        </td>
                    </tr>
                `;
            }
        }

        // Load Sellers Data (placeholder for future implementation)
        async function loadSellersData() {
            const tbody = document.getElementById('sellers-table-body');
            if (tbody) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-8">
                            <i class="fas fa-store text-2xl mb-2 text-blue-500"></i>
                            <p class="text-blue-600">Seller management coming soon</p>
                        </td>
                    </tr>
                `;
            }
        }

        // Load Analytics Data
        async function loadAnalyticsData() {
            initializeCharts();
            loadTopProducts();
            loadTopCategories();
            loadRecentActivity();
        }

        // Initialize charts
        function initializeCharts() {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx && !charts.revenueChart) {
                charts.revenueChart = new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: generateDateLabels(30),
                        datasets: [{
                            label: 'Revenue',
                            data: generateRevenueData(30),
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'â‚¹' + (value / 1000) + 'K';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Category Chart
            const categoryCtx = document.getElementById('categoryChart');
            if (categoryCtx && !charts.categoryChart) {
                const categoryData = generateCategoryAnalytics();
                
                charts.categoryChart = new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: categoryData.labels,
                        datasets: [{
                            data: categoryData.values,
                            backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#43e97b']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
        }

        // Generate date labels for charts
        function generateDateLabels(days) {
            const labels = [];
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en-IN', { month: 'short', day: 'numeric' }));
            }
            return labels;
        }

        // Generate revenue data for charts
        function generateRevenueData(days) {
            const data = [];
            const orders = dashboardData.orders;
            
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dayStart = new Date(date.setHours(0, 0, 0, 0));
                const dayEnd = new Date(date.setHours(23, 59, 59, 999));
                
                const dayRevenue = orders
                    .filter(order => {
                        const orderDate = new Date(order.createdAt || order.date);
                        return orderDate >= dayStart && orderDate <= dayEnd;
                    })
                    .reduce((sum, order) => sum + (order.totalAmount || order.total || 0), 0);
                
                data.push(dayRevenue);
            }
            
            return data;
        }

        // Generate category analytics
        function generateCategoryAnalytics() {
            const categoryStats = {};
            
            dashboardData.products.forEach(product => {
                const categoryName = product.category?.name || 'Uncategorized';
                categoryStats[categoryName] = (categoryStats[categoryName] || 0) + 1;
            });
            
            return {
                labels: Object.keys(categoryStats),
                values: Object.values(categoryStats)
            };
        }

        // Load top products
        function loadTopProducts() {
            const container = document.getElementById('top-products-list');
            if (!container) return;

            // Calculate product performance based on orders
            const productPerformance = {};
            
            dashboardData.orders.forEach(order => {
                if (order.items) {
                    order.items.forEach(item => {
                        const productId = item.product?._id || item.productId;
                        if (productId) {
                            productPerformance[productId] = (productPerformance[productId] || 0) + (item.quantity || 1);
                        }
                    });
                }
            });

            const topProducts = dashboardData.products
                .map(product => ({
                    ...product,
                    salesCount: productPerformance[product._id] || 0
                }))
                .sort((a, b) => b.salesCount - a.salesCount)
                .slice(0, 5);

            if (topProducts.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-4">No product data available</div>';
                return;
            }

            const productsHTML = topProducts.map((product, index) => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-3">
                            ${index + 1}
                        </div>
                        <div>
                            <div class="font-medium text-gray-800 line-clamp-1">${product.name}</div>
                            <div class="text-sm text-gray-500">${product.salesCount} sold</div>
                        </div>
                    </div>
                    <div class="font-bold text-gray-800">â‚¹${product.price}</div>
                </div>
            `).join('');

            container.innerHTML = productsHTML;
        }

        // Load top categories
        function loadTopCategories() {
            const container = document.getElementById('top-categories-list');
            if (!container) return;

            const categoryStats = dashboardData.categories.map(category => {
                const productCount = dashboardData.products.filter(p => p.category?._id === category._id).length;
                return { ...category, productCount };
            }).sort((a, b) => b.productCount - a.productCount).slice(0, 5);

            if (categoryStats.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-4">No category data available</div>';
                return;
            }

            const categoriesHTML = categoryStats.map((category, index) => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-teal-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-3">
                            ${index + 1}
                        </div>
                        <div>
                            <div class="font-medium text-gray-800">${category.name}</div>
                            <div class="text-sm text-gray-500">${category.productCount} products</div>
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = categoriesHTML;
        }

        // Load recent activity
        function loadRecentActivity() {
            const container = document.getElementById('recent-activity-list');
            if (!container) return;

            const activities = [];
            
            // Add recent product additions
            dashboardData.products.slice(0, 3).forEach(product => {
                activities.push({
                    icon: 'fas fa-plus-circle',
                    color: 'text-green-600',
                    text: `Product "${product.name}" added`,
                    time: getTimeAgo(new Date(product.createdAt))
                });
            });

            // Add recent orders
            dashboardData.orders.slice(0, 2).forEach(order => {
                activities.push({
                    icon: 'fas fa-shopping-cart',
                    color: 'text-blue-600',
                    text: `New order #${order._id}`,
                    time: getTimeAgo(new Date(order.createdAt || order.date))
                });
            });

            if (activities.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-4">No recent activity</div>';
                return;
            }

            const activitiesHTML = activities.slice(0, 5).map(activity => `
                <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                    <i class="${activity.icon} ${activity.color} mr-3"></i>
                    <div class="flex-1">
                        <div class="text-sm text-gray-800">${activity.text}</div>
                        <div class="text-xs text-gray-500">${activity.time}</div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = activitiesHTML;
        }

        // Modal Functions
        function openProductModal(productId = null) {
            const modal = document.getElementById('product-modal');
            const form = document.getElementById('product-form');
            const title = document.getElementById('product-modal-title');
            
            currentEditingId = productId;
            
            if (productId) {
                title.textContent = 'Edit Product';
                const product = dashboardData.products.find(p => p._id === productId);
                if (product) {
                    document.getElementById('product-name').value = product.name || '';
                    document.getElementById('product-price').value = product.price || '';
                    document.getElementById('product-category').value = product.category?._id || '';
                    document.getElementById('product-stock').value = product.stockQuantity || '';
                    document.getElementById('product-description').value = product.description || '';
                    document.getElementById('product-image').value = product.images?.[0]?.url || product.image || '';
                    document.getElementById('product-discount').value = product.discountPercentage || 0;
                }
            } else {
                title.textContent = 'Add Product';
                form.reset();
            }
            
            modal.style.display = 'block';
        }

        function closeProductModal() {
            const modal = document.getElementById('product-modal');
            modal.style.display = 'none';
            currentEditingId = null;
        }

        function openCategoryModal(categoryId = null) {
            const modal = document.getElementById('category-modal');
            const form = document.getElementById('category-form');
            const title = document.getElementById('category-modal-title');
            
            currentEditingId = categoryId;
            
            if (categoryId) {
                title.textContent = 'Edit Category';
                const category = dashboardData.categories.find(c => c._id === categoryId);
                if (category) {
                    document.getElementById('category-name').value = category.name || '';
                    document.getElementById('category-slug').value = category.slug || '';
                    document.getElementById('category-description').value = category.description || '';
                    document.getElementById('category-image').value = category.image || '';
                }
            } else {
                title.textContent = 'Add Category';
                form.reset();
            }
            
            modal.style.display = 'block';
        }

        function closeCategoryModal() {
            const modal = document.getElementById('category-modal');
            modal.style.display = 'none';
            currentEditingId = null;
        }

        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
            currentEditingId = null;
        }

        // Form Handlers
        async function handleProductSubmit(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('product-submit-btn');
            const originalText = submitBtn.innerHTML;
            
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';
            submitBtn.disabled = true;

            try {
                const formData = new FormData(event.target);
                const productData = {
                    name: formData.get('name'),
                    price: parseFloat(formData.get('price')),
                    category: formData.get('category'),
                    description: formData.get('description'),
                    stockQuantity: parseInt(formData.get('stockQuantity')) || 0,
                    discountPercentage: parseFloat(formData.get('discountPercentage')) || 0
                };

                // Handle image
                const imageUrl = formData.get('image');
                if (imageUrl) {
                    productData.images = [{ url: imageUrl, alt: productData.name }];
                }

                // Calculate final price
                if (productData.discountPercentage > 0) {
                    productData.finalPrice = productData.price * (1 - productData.discountPercentage / 100);
                    productData.isOnSale = true;
                }

                let response;
                if (currentEditingId) {
                    response = await apiRequest(`/api/v1/products/${currentEditingId}`, {
                        method: 'PUT',
                        body: JSON.stringify(productData)
                    });
                } else {
                    response = await apiRequest('/api/v1/products', {
                        method: 'POST',
                        body: JSON.stringify(productData)
                    });
                }

                if (response) {
                    showNotification(
                        currentEditingId ? 'Product updated successfully!' : 'Product added successfully!', 
                        'success'
                    );
                    closeProductModal();
                    await loadProductsData();
                    await loadDashboardData();
                }

            } catch (error) {
                console.error('Failed to save product:', error);
                showNotification('Failed to save product: ' + error.message, 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        async function handleCategorySubmit(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('category-submit-btn');
            const originalText = submitBtn.innerHTML;
            
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';
            submitBtn.disabled = true;

            try {
                const formData = new FormData(event.target);
                const categoryData = {
                    name: formData.get('name'),
                    slug: formData.get('slug') || formData.get('name').toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, ''),
                    description: formData.get('description'),
                    image: formData.get('image')
                };

                let response;
                if (currentEditingId) {
                    response = await apiRequest(`/api/v1/categories/${currentEditingId}`, {
                        method: 'PUT',
                        body: JSON.stringify(categoryData)
                    });
                } else {
                    response = await apiRequest('/api/v1/categories', {
                        method: 'POST',
                        body: JSON.stringify(categoryData)
                    });
                }

                if (response) {
                    showNotification(
                        currentEditingId ? 'Category updated successfully!' : 'Category added successfully!', 
                        'success'
                    );
                    closeCategoryModal();
                    await loadCategoriesData();
                    await loadCategoriesForSelect();
                    await loadDashboardData();
                }

            } catch (error) {
                console.error('Failed to save category:', error);
                showNotification('Failed to save category: ' + error.message, 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        // CRUD Operations
        async function editProduct(productId) {
            await loadCategoriesForSelect();
            openProductModal(productId);
        }

        async function deleteProduct(productId, productName) {
            if (!confirm(`Are you sure you want to delete "${productName}"?`)) return;

            try {
                await apiRequest(`/api/v1/products/${productId}`, { method: 'DELETE' });
                showNotification('Product deleted successfully!', 'success');
                await loadProductsData();
                await loadDashboardData();
            } catch (error) {
                console.error('Failed to delete product:', error);
                showNotification('Failed to delete product: ' + error.message, 'error');
            }
        }

        async function editCategory(categoryId) {
            openCategoryModal(categoryId);
        }

        async function deleteCategory(categoryId, categoryName) {
            if (!confirm(`Are you sure you want to delete "${categoryName}"?`)) return;

            try {
                await apiRequest(`/api/v1/categories/${categoryId}`, { method: 'DELETE' });
                showNotification('Category deleted successfully!', 'success');
                await loadCategoriesData();
                await loadCategoriesForSelect();
                await loadDashboardData();
            } catch (error) {
                console.error('Failed to delete category:', error);
                showNotification('Failed to delete category: ' + error.message, 'error');
            }
        }

        // Order Management
        function viewOrder(orderId) {
            showNotification('Order details view coming soon!', 'info');
        }

        function editOrderStatus(orderId, currentStatus) {
            const newStatus = prompt(`Change order status from "${currentStatus}" to:`, currentStatus);
            if (newStatus && newStatus !== currentStatus) {
                updateOrderStatus(orderId, newStatus);
            }
        }

        async function updateOrderStatus(orderId, newStatus) {
            try {
                await apiRequest(`/api/v1/orders/${orderId}`, {
                    method: 'PUT',
                    body: JSON.stringify({ status: newStatus })
                });
                showNotification('Order status updated successfully!', 'success');
                await loadOrdersData();
                await loadDashboardData();
            } catch (error) {
                console.error('Failed to update order status:', error);
                showNotification('Failed to update order status: ' + error.message, 'error');
            }
        }

        // Customer Management
        function viewCustomer(customerId) {
            showNotification('Customer details view coming soon!', 'info');
        }

        function editCustomer(customerId) {
            showNotification('Customer editing coming soon!', 'info');
        }

        // Filter Functions
        function filterProducts() {
            const searchTerm = document.getElementById('product-search').value.toLowerCase();
            const productCards = document.querySelectorAll('#products-grid .product-card');

            productCards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(searchTerm) ? 'block' : 'none';
            });
        }

        function filterCategories() {
            const searchTerm = document.getElementById('category-search').value.toLowerCase();
            const categoryCards = document.querySelectorAll('#categories-grid .category-card');

            categoryCards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(searchTerm) ? 'block' : 'none';
            });
        }

        function filterOrders() {
            const statusFilter = document.getElementById('order-status-filter').value;
            const tableRows = document.querySelectorAll('#orders-table-body tr');

            tableRows.forEach(row => {
                if (row.cells.length < 5) return; // Skip loading/error rows
                
                const statusCell = row.cells[4];
                const status = statusCell.textContent.trim().toLowerCase();
                
                if (!statusFilter || status.includes(statusFilter)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Refresh Functions
        function refreshCurrentSection() {
            const refreshIcon = document.getElementById('refresh-icon');
            refreshIcon.classList.add('fa-spin');
            
            setTimeout(() => {
                refreshIcon.classList.remove('fa-spin');
            }, 1000);

            loadSectionData(currentSection);
        }

        async function refreshProducts() {
            await loadProductsData();
            showNotification('Products refreshed!', 'success');
        }

        async function refreshCategories() {
            await loadCategoriesData();
            showNotification('Categories refreshed!', 'success');
        }

        async function refreshOrders() {
            await loadOrdersData();
            showNotification('Orders refreshed!', 'success');
        }

        async function refreshCustomers() {
            await loadCustomersData();
            showNotification('Customers refreshed!', 'success');
        }

        async function refreshSellers() {
            await loadSellersData();
            showNotification('Sellers refreshed!', 'success');
        }

        // Settings Functions
        async function testApiConnection() {
            const apiBaseUrl = document.getElementById('api-base-url').value.trim();
            if (apiBaseUrl) {
                API_BASE = apiBaseUrl;
            }
            
            await testApiConnection();
            showNotification('API connection tested!', 'info');
        }

        function updateProfile() {
            const name = document.getElementById('admin-profile-name').value;
            const email = document.getElementById('admin-profile-email').value;
            
            document.getElementById('admin-name').textContent = name;
            document.getElementById('admin-email').textContent = email;
            
            showNotification('Profile updated successfully!', 'success');
        }

        // Utility Functions
        function getStatusClass(status) {
            const statusClasses = {
                pending: 'bg-yellow-100 text-yellow-800',
                processing: 'bg-blue-100 text-blue-800',
                shipped: 'bg-purple-100 text-purple-800',
                delivered: 'bg-green-100 text-green-800',
                cancelled: 'bg-red-100 text-red-800'
            };
            return statusClasses[status] || 'bg-gray-100 text-gray-800';
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return 'Just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} minutes ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} hours ago`;
            return `${Math.floor(diffInSeconds / 86400)} days ago`;
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR'
            }).format(amount);
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('en-IN').format(num);
        }

        // Notification System
        function showNotification(message, type = 'success') {
            // Remove existing notifications
            document.querySelectorAll('.notification-toast').forEach(n => n.remove());

            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification-toast notification-${type}`;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-times-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };

            const colors = {
                success: 'text-green-600',
                error: 'text-red-600',
                warning: 'text-yellow-600',
                info: 'text-blue-600'
            };
            
            notification.innerHTML = `
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas ${icons[type]} ${colors[type]} text-lg"></i>
                    </div>
                    <div class="ml-3 flex-1">
                        <p class="text-sm font-medium text-gray-900">${message}</p>
                    </div>
                    <div class="ml-4 flex-shrink-0">
                        <button class="text-gray-400 hover:text-gray-600 transition-colors" onclick="this.parentElement.parentElement.parentElement.remove()">
                            <i class="fas fa-times text-sm"></i>
                        </button>
                    </div>
                </div>
            `;

            // Add to document
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('qk_token');
                showNotification('Logged out successfully!', 'success');
                // Redirect to login page or reload
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            }
        }

        // Chart update functions
        function updateRevenueChart(period) {
            if (charts.revenueChart) {
                const days = parseInt(period);
                const labels = generateDateLabels(days);
                const data = generateRevenueData(days);
                
                charts.revenueChart.data.labels = labels;
                charts.revenueChart.data.datasets[0].data = data;
                charts.revenueChart.update();
            }
        }

        // Error handling for missing elements
        function safeGetElement(id) {
            const element = document.getElementById(id);
            if (!element) {
                console.warn(`Element with id '${id}' not found`);
            }
            return element;
        }

        // Initialize everything when DOM is ready
        console.log('QuickLocal Admin Dashboard script loaded successfully! ðŸš€');

        // Add some demo data if API is not connected (for testing)
        function addDemoData() {
            if (!isAPIConnected) {
                dashboardData.products = [
                    {
                        _id: 'demo1',
                        name: 'Premium Headphones',
                        price: 2999,
                        finalPrice: 2499,
                        description: 'High-quality wireless headphones with noise cancellation',
                        category: { _id: 'cat1', name: 'Electronics' },
                        images: [{ url: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=300', alt: 'Headphones' }],
                        discountPercentage: 17,
                        stockQuantity: 50,
                        inStock: true,
                        createdAt: new Date().toISOString()
                    }
                ];

                dashboardData.categories = [
                    {
                        _id: 'cat1',
                        name: 'Electronics',
                        slug: 'electronics',
                        description: 'Electronic gadgets and devices',
                        image: 'https://images.unsplash.com/photo-1498049794561-7780e7231661?w=300',
                        createdAt: new Date().toISOString()
                    }
                ];

                dashboardData.orders = [
                    {
                        _id: 'order1',
                        user: { name: 'John Doe' },
                        items: [{ product: { _id: 'demo1' }, quantity: 1 }],
                        totalAmount: 2499,
                        status: 'pending',
                        createdAt: new Date().toISOString()
                    }
                ];

                updateDashboardStats();
                console.log('Demo data loaded for offline testing');
            }
        }

        // Auto-load demo data after a delay if API connection fails
        setTimeout(() => {
            if (!isAPIConnected) {
                addDemoData();
            }
        }, 3000);
    </script>
<div id="loading-indicator" class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center hidden z-50">
    <div class="bg-white px-6 py-4 rounded-lg shadow-lg flex items-center gap-3">
        <i class="fas fa-spinner fa-spin text-2xl text-blue-600"></i>
        <span class="font-medium text-gray-700">Loading...</span>
    </div>
</div>
<input id="search-users" type="text" placeholder="Search users..." class="border px-3 py-2 rounded w-full mb-4">

<div id="users-pagination" class="flex gap-2 mt-4"></div>


<script src="admin-categories.js"></script>
</body>
</html>