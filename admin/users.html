<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Management - QuickLocal Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #4f46e5;
      --primary-light: #6366f1;
      --primary-dark: #4338ca;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    }
    
    .user-card {
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }
    
    .user-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .animate-fade-in {
      animation: fadeIn 0.5s ease-out forwards;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .status-indicator {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    .table-row:hover {
      background-color: #f8fafc;
    }
    
    .avatar-placeholder {
      background: linear-gradient(45deg, var(--primary), var(--primary-dark));
    }
    
    .badge {
      @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium;
    }
    
    .badge-primary {
      @apply bg-indigo-100 text-indigo-800;
    }
    
    .badge-success {
      @apply bg-green-100 text-green-800;
    }
    
    .badge-warning {
      @apply bg-yellow-100 text-yellow-800;
    }
    
    .badge-danger {
      @apply bg-red-100 text-red-800;
    }
    
    .badge-info {
      @apply bg-blue-100 text-blue-800;
    }
    
    .badge-secondary {
      @apply bg-gray-100 text-gray-800;
    }
    
    .smooth-transition {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1a1;
    }
    
    /* Loading spinner */
    .spinner {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Toast notification animation */
    @keyframes slideIn {
      from { transform: translateX(100%); }
      to { transform: translateX(0); }
    }
    
    @keyframes slideOut {
      from { transform: translateX(0); }
      to { transform: translateX(100%); }
    }
    
    .toast {
      animation: slideIn 0.3s forwards;
    }
    
    .toast.hide {
      animation: slideOut 0.3s forwards;
    }
    
    /* Tooltip */
    .tooltip {
      position: relative;
    }
    
    .tooltip .tooltip-text {
      visibility: hidden;
      width: 120px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .tooltip .tooltip-text::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: #333 transparent transparent transparent;
    }
    
    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }
    
    /* Custom checkbox */
    .custom-checkbox {
      position: relative;
      width: 18px;
      height: 18px;
    }
    
    .custom-checkbox input {
      opacity: 0;
      position: absolute;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    
    .custom-checkbox .checkmark {
      position: absolute;
      top: 0;
      left: 0;
      height: 18px;
      width: 18px;
      background-color: #fff;
      border: 2px solid #d1d5db;
      border-radius: 4px;
      transition: all 0.2s;
    }
    
    .custom-checkbox input:checked ~ .checkmark {
      background-color: var(--primary);
      border-color: var(--primary);
    }
    
    .custom-checkbox .checkmark:after {
      content: "";
      position: absolute;
      display: none;
      left: 5px;
      top: 2px;
      width: 5px;
      height: 10px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
    }
    
    .custom-checkbox input:checked ~ .checkmark:after {
      display: block;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans antialiased">
  <!-- Header -->
  <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-10">
    <div class="flex items-center justify-between px-6 py-3">
      <div class="flex items-center space-x-4">
        <a href="dashboard.html" class="text-indigo-600 hover:text-indigo-700 flex items-center smooth-transition">
          <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
        </a>
        <div class="h-6 w-px bg-gray-300"></div>
        <div>
          <h1 class="text-2xl font-bold text-gray-800">User Management</h1>
          <p class="text-gray-600 text-sm">Manage customers, sellers, and administrators</p>
        </div>
      </div>
      
      <div class="flex items-center space-x-4">
        <!-- Search with advanced options -->
        <div class="relative group">
          <div class="relative">
            <input 
              type="text" 
              id="searchInput"
              placeholder="Search users..." 
              class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 w-64 smooth-transition"
            >
            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          <div class="absolute right-0 mt-1 w-64 bg-white rounded-lg shadow-xl border border-gray-200 p-2 hidden group-focus-within:block z-20">
            <div class="text-xs text-gray-500 mb-2">Advanced search options:</div>
            <div class="space-y-2">
              <div class="flex items-center">
                <input type="checkbox" id="searchName" class="mr-2" checked>
                <label for="searchName" class="text-sm">Name</label>
              </div>
              <div class="flex items-center">
                <input type="checkbox" id="searchEmail" class="mr-2" checked>
                <label for="searchEmail" class="text-sm">Email</label>
              </div>
              <div class="flex items-center">
                <input type="checkbox" id="searchPhone" class="mr-2">
                <label for="searchPhone" class="text-sm">Phone</label>
              </div>
              <div class="flex items-center">
                <input type="checkbox" id="searchId" class="mr-2">
                <label for="searchId" class="text-sm">User ID</label>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Add User Button with dropdown -->
        <div class="relative group">
          <button 
            id="addUserBtn"
            class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 smooth-transition flex items-center"
          >
            <i class="fas fa-plus mr-2"></i>Add User
          </button>
          <div class="absolute right-0 mt-1 w-48 bg-white rounded-lg shadow-xl border border-gray-200 hidden group-hover:block z-20">
            <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-indigo-50 smooth-transition" onclick="userManager.openUserModal()">
              <i class="fas fa-user-plus mr-2 text-indigo-600"></i>Single User
            </a>
            <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-indigo-50 smooth-transition">
              <i class="fas fa-file-import mr-2 text-indigo-600"></i>Bulk Import
            </a>
            <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-indigo-50 smooth-transition">
              <i class="fas fa-link mr-2 text-indigo-600"></i>Invite Link
            </a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="p-6">
    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <div class="bg-white rounded-xl shadow-sm p-6 animate-fade-in hover:shadow-md smooth-transition">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm mb-1">Total Users</p>
            <p class="text-2xl font-bold text-gray-800" id="totalUsers">2,847</p>
            <div class="flex items-center mt-2">
              <i class="fas fa-arrow-up text-green-500 text-sm mr-1"></i>
              <span class="text-green-500 text-sm">+12%</span>
              <span class="text-gray-400 text-sm ml-1">vs last month</span>
            </div>
          </div>
          <div class="bg-indigo-100 p-3 rounded-full">
            <i class="fas fa-users text-indigo-600 text-xl"></i>
          </div>
        </div>
      </div>
      
      <div class="bg-white rounded-xl shadow-sm p-6 animate-fade-in hover:shadow-md smooth-transition" style="animation-delay: 0.1s">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm mb-1">Active Users</p>
            <p class="text-2xl font-bold text-gray-800" id="activeUsers">2,643</p>
            <div class="flex items-center mt-2">
              <i class="fas fa-arrow-up text-green-500 text-sm mr-1"></i>
              <span class="text-green-500 text-sm">+8%</span>
              <span class="text-gray-400 text-sm ml-1">this week</span>
            </div>
          </div>
          <div class="bg-green-100 p-3 rounded-full">
            <i class="fas fa-user-check text-green-600 text-xl"></i>
          </div>
        </div>
      </div>
      
      <div class="bg-white rounded-xl shadow-sm p-6 animate-fade-in hover:shadow-md smooth-transition" style="animation-delay: 0.2s">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm mb-1">Sellers</p>
            <p class="text-2xl font-bold text-gray-800" id="totalSellers">485</p>
            <div class="flex items-center mt-2">
              <i class="fas fa-arrow-up text-green-500 text-sm mr-1"></i>
              <span class="text-green-500 text-sm">+18%</span>
              <span class="text-gray-400 text-sm ml-1">new this month</span>
            </div>
          </div>
          <div class="bg-purple-100 p-3 rounded-full">
            <i class="fas fa-store text-purple-600 text-xl"></i>
          </div>
        </div>
      </div>
      
      <div class="bg-white rounded-xl shadow-sm p-6 animate-fade-in hover:shadow-md smooth-transition" style="animation-delay: 0.3s">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm mb-1">Admins</p>
            <p class="text-2xl font-bold text-gray-800" id="totalAdmins">12</p>
            <div class="flex items-center mt-2">
              <div class="w-2 h-2 bg-green-500 rounded-full status-indicator mr-2"></div>
              <span class="text-green-600 text-sm">All active</span>
            </div>
          </div>
          <div class="bg-red-100 p-3 rounded-full">
            <i class="fas fa-user-shield text-red-600 text-xl"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters and Actions -->
    <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div class="flex flex-wrap items-center gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
            <select id="roleFilter" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 smooth-transition">
              <option value="">All Roles</option>
              <option value="customer">Customers</option>
              <option value="seller">Sellers</option>
              <option value="admin">Administrators</option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
            <select id="statusFilter" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 smooth-transition">
              <option value="">All Status</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="suspended">Suspended</option>
              <option value="pending">Pending</option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Registration</label>
            <select id="dateFilter" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 smooth-transition">
              <option value="">All Time</option>
              <option value="today">Today</option>
              <option value="week">This Week</option>
              <option value="month">This Month</option>
              <option value="year">This Year</option>
              <option value="custom">Custom Range</option>
            </select>
          </div>
          
          <div id="customDateRange" class="hidden">
            <label class="block text-sm font-medium text-gray-700 mb-1">Date Range</label>
            <div class="flex items-center space-x-2">
              <input type="date" id="startDate" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 smooth-transition">
              <span>to</span>
              <input type="date" id="endDate" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 smooth-transition">
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Verification</label>
            <select id="verificationFilter" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 smooth-transition">
              <option value="">All Users</option>
              <option value="verified">Verified</option>
              <option value="pending">Pending</option>
              <option value="rejected">Rejected</option>
            </select>
          </div>
        </div>
        
        <div class="flex items-center space-x-2">
          <button id="resetFilters" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 smooth-transition flex items-center">
            <i class="fas fa-undo mr-2"></i>Reset
          </button>
          <div class="relative group">
            <button id="exportUsers" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 smooth-transition flex items-center">
              <i class="fas fa-download mr-2"></i>Export
            </button>
            <div class="absolute right-0 mt-1 w-48 bg-white rounded-lg shadow-xl border border-gray-200 hidden group-hover:block z-20">
              <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-green-50 smooth-transition">
                <i class="fas fa-file-csv mr-2 text-green-600"></i>CSV Format
              </a>
              <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-green-50 smooth-transition">
                <i class="fas fa-file-excel mr-2 text-green-600"></i>Excel Format
              </a>
              <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-green-50 smooth-transition">
                <i class="fas fa-file-pdf mr-2 text-green-600"></i>PDF Format
              </a>
            </div>
          </div>
          <div class="relative group">
            <button id="bulkActions" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 smooth-transition flex items-center">
              <i class="fas fa-tasks mr-2"></i>Bulk Actions
            </button>
            <div class="absolute right-0 mt-1 w-48 bg-white rounded-lg shadow-xl border border-gray-200 hidden group-hover:block z-20">
              <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-purple-50 smooth-transition">
                <i class="fas fa-user-check mr-2 text-purple-600"></i>Activate Selected
              </a>
              <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-purple-50 smooth-transition">
                <i class="fas fa-user-slash mr-2 text-purple-600"></i>Deactivate Selected
              </a>
              <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-purple-50 smooth-transition">
                <i class="fas fa-envelope mr-2 text-purple-600"></i>Email Selected
              </a>
              <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-purple-50 smooth-transition">
                <i class="fas fa-trash mr-2 text-purple-600"></i>Delete Selected
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Users Table -->
    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
        <h3 class="text-lg font-semibold text-gray-800">Users</h3>
        <div class="flex items-center space-x-4">
          <div class="flex items-center space-x-2">
            <span class="text-sm text-gray-500">Show:</span>
            <select id="itemsPerPage" class="border border-gray-300 rounded px-2 py-1 text-sm focus:ring-2 focus:ring-indigo-500 smooth-transition">
              <option value="10">10</option>
              <option value="25">25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
            <span class="text-sm text-gray-500">per page</span>
          </div>
          <button id="refreshTable" class="text-gray-500 hover:text-indigo-600 smooth-transition">
            <i class="fas fa-sync-alt"></i>
          </button>
        </div>
      </div>
      
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                <label class="custom-checkbox">
                  <input type="checkbox" id="selectAll">
                  <span class="checkmark"></span>
                </label>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 smooth-transition" onclick="userManager.sortTable('name')">
                <div class="flex items-center">
                  <span>User</span>
                  <i class="fas fa-sort ml-1 text-gray-400"></i>
                </div>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 smooth-transition" onclick="userManager.sortTable('role')">
                <div class="flex items-center">
                  <span>Role</span>
                  <i class="fas fa-sort ml-1 text-gray-400"></i>
                </div>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 smooth-transition" onclick="userManager.sortTable('status')">
                <div class="flex items-center">
                  <span>Status</span>
                  <i class="fas fa-sort ml-1 text-gray-400"></i>
                </div>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 smooth-transition" onclick="userManager.sortTable('joinDate')">
                <div class="flex items-center">
                  <span>Joined</span>
                  <i class="fas fa-sort ml-1 text-gray-400"></i>
                </div>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 smooth-transition" onclick="userManager.sortTable('lastActive')">
                <div class="flex items-center">
                  <span>Last Active</span>
                  <i class="fas fa-sort ml-1 text-gray-400"></i>
                </div>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 smooth-transition" onclick="userManager.sortTable('orders')">
                <div class="flex items-center">
                  <span>Orders</span>
                  <i class="fas fa-sort ml-1 text-gray-400"></i>
                </div>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody id="usersTableBody" class="bg-white divide-y divide-gray-200">
            <!-- Loading state -->
            <tr id="loadingRow" class="h-64">
              <td colspan="8" class="text-center">
                <div class="flex flex-col items-center justify-center py-10">
                  <div class="w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full spinner mb-4"></div>
                  <p class="text-gray-600">Loading users...</p>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <!-- Pagination -->
      <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex items-center justify-between">
        <div class="text-sm text-gray-500">
          Showing <span id="showingFrom">1</span> to <span id="showingTo">10</span> of <span id="totalItems">2,847</span> users
        </div>
        <div class="flex items-center space-x-2">
          <button id="firstPage" class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 smooth-transition" disabled>
            <i class="fas fa-angle-double-left"></i>
          </button>
          <button id="prevPage" class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 smooth-transition" disabled>
            <i class="fas fa-chevron-left"></i>
          </button>
          
          <div class="flex items-center space-x-1">
            <template id="pageTemplate">
              <button class="page-btn px-3 py-1 border rounded smooth-transition"></button>
            </template>
          </div>
          
          <button id="nextPage" class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-50 smooth-transition">
            <i class="fas fa-chevron-right"></i>
          </button>
          <button id="lastPage" class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-50 smooth-transition">
            <i class="fas fa-angle-double-right"></i>
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- Add/Edit User Modal -->
  <div id="userModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <h2 id="modalTitle" class="text-2xl font-bold text-gray-800">Add New User</h2>
        <button id="closeModal" class="text-gray-400 hover:text-gray-600 smooth-transition">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <form id="userForm" class="space-y-6">
        <!-- Profile Image Upload -->
        <div class="text-center">
          <div class="relative inline-block">
            <div id="profilePreview" class="w-24 h-24 rounded-full avatar-placeholder flex items-center justify-center text-white text-2xl font-bold mx-auto mb-4">
              <i class="fas fa-user"></i>
            </div>
            <button type="button" id="uploadImageBtn" class="absolute bottom-0 right-0 bg-indigo-600 text-white p-2 rounded-full hover:bg-indigo-700 smooth-transition tooltip">
              <i class="fas fa-camera text-sm"></i>
              <span class="tooltip-text">Upload Photo</span>
            </button>
            <input type="file" id="imageInput" class="hidden" accept="image/*">
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="firstName" class="block text-sm font-medium text-gray-700 mb-2">First Name <span class="text-red-500">*</span></label>
            <input type="text" id="firstName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 smooth-transition">
          </div>
          
          <div>
            <label for="lastName" class="block text-sm font-medium text-gray-700 mb-2">Last Name <span class="text-red-500">*</span></label>
            <input type="text" id="lastName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 smooth-transition">
          </div>
          
          <div>
            <label for="userEmail" class="block text-sm font-medium text-gray-700 mb-2">Email Address <span class="text-red-500">*</span></label>
            <input type="email" id="userEmail" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 smooth-transition">
          </div>
          
          <div>
            <label for="userPhone" class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
            <input type="tel" id="userPhone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 smooth-transition">
          </div>
          
          <div>
            <label for="userRole" class="block text-sm font-medium text-gray-700 mb-2">Role <span class="text-red-500">*</span></label>
            <select id="userRole" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 smooth-transition">
              <option value="">Select Role</option>
              <option value="customer">Customer</option>
              <option value="seller">Seller</option>
              <option value="admin">Administrator</option>
            </select>
          </div>
          
          <div>
            <label for="userStatus" class="block text-sm font-medium text-gray-700 mb-2">Status <span class="text-red-500">*</span></label>
            <select id="userStatus" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 smooth-transition">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="suspended">Suspended</option>
              <option value="pending">Pending</option>
            </select>
          </div>
        </div>
        
        <!-- Password Section (only for new users) -->
        <div id="passwordSection" class="border-t pt-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Password</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password <span class="text-red-500">*</span></label>
              <div class="relative">
                <input type="password" id="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 smooth-transition">
                <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600" onclick="userManager.togglePasswordVisibility('password')">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              <div class="text-xs text-gray-500 mt-1">Minimum 8 characters</div>
            </div>
            
            <div>
              <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-2">Confirm Password <span class="text-red-500">*</span></label>
              <div class="relative">
                <input type="password" id="confirmPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 smooth-transition">
                <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600" onclick="userManager.togglePasswordVisibility('confirmPassword')">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Address Section -->
        <div class="border-t pt-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Address Information</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="md:col-span-2">
              <label for="address" class="block text-sm font-medium text-gray-700 mb-2">Street Address</label>
              <input type="text" id="address" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 smooth-transition">
            </div>
            
            <div>
              <label for="city" class="block text-sm font-medium text-gray-700 mb-2">City</label>
              <input type="text" id="city" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 smooth-transition">
            </div>
            
            <div>
              <label for="state" class="block text-sm font-medium text-gray-700 mb-2">State</label>
              <select id="state" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 smooth-transition">
                <option value="">Select State</option>
                <option value="MH">Maharashtra</option>
                <option value="DL">Delhi</option>
                <option value="KA">Karnataka</option>
                <option value="TN">Tamil Nadu</option>
                <option value="UP">Uttar Pradesh</option>
                <option value="GJ">Gujarat</option>
                <option value="RJ">Rajasthan</option>
                <option value="AP">Andhra Pradesh</option>
                <option value="WB">West Bengal</option>
                <option value="PB">Punjab</option>
              </select>
            </div>
            
            <div>
              <label for="pincode" class="block text-sm font-medium text-gray-700 mb-2">PIN Code</label>
              <input type="text" id="pincode" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 smooth-transition">
            </div>
          </div>
        </div>
        
        <!-- Permissions for Admin/Seller -->
        <div id="permissionsSection" class="border-t pt-6 hidden">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Permissions</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <label class="flex items-center">
              <input type="checkbox" id="canManageOrders" class="mr-2 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 smooth-transition">
              <span class="text-sm text-gray-700">Manage Orders</span>
            </label>
            <label class="flex items-center">
              <input type="checkbox" id="canManageProducts" class="mr-2 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 smooth-transition">
              <span class="text-sm text-gray-700">Manage Products</span>
            </label>
            <label class="flex items-center">
              <input type="checkbox" id="canManageUsers" class="mr-2 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 smooth-transition">
              <span class="text-sm text-gray-700">Manage Users</span>
            </label>
            <label class="flex items-center">
              <input type="checkbox" id="canViewAnalytics" class="mr-2 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 smooth-transition">
              <span class="text-sm text-gray-700">View Analytics</span>
            </label>
            <label class="flex items-center">
              <input type="checkbox" id="canManageContent" class="mr-2 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 smooth-transition">
              <span class="text-sm text-gray-700">Manage Content</span>
            </label>
            <label class="flex items-center">
              <input type="checkbox" id="canManageSettings" class="mr-2 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 smooth-transition">
              <span class="text-sm text-gray-700">Manage Settings</span>
            </label>
          </div>
        </div>
        
        <!-- Additional Information -->
        <div class="border-t pt-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Additional Information</h3>
          <div class="grid grid-cols-1 gap-6">
            <div>
              <label for="notes" class="block text-sm font-medium text-gray-700 mb-2">Notes</label>
              <textarea id="notes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 smooth-transition"></textarea>
            </div>
          </div>
        </div>
        
        <div class="flex justify-end space-x-3 pt-6 border-t">
          <button type="button" id="cancelBtn" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 smooth-transition">
            Cancel
          </button>
          <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 smooth-transition flex items-center">
            <i class="fas fa-save mr-2"></i>Save User
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- User Details Modal -->
  <div id="userDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white rounded-2xl p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-800">User Details</h2>
        <button id="closeDetailsModal" class="text-gray-400 hover:text-gray-600 smooth-transition">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <div id="userDetailsContent">
        <!-- Dynamic user details will be inserted here -->
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div id="confirmationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold text-gray-800" id="confirmationTitle">Confirm Action</h3>
        <button id="closeConfirmationModal" class="text-gray-400 hover:text-gray-600 smooth-transition">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <p class="text-gray-600 mb-6" id="confirmationMessage">Are you sure you want to perform this action?</p>
      <div class="flex justify-end space-x-3">
        <button id="cancelAction" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 smooth-transition">
          Cancel
        </button>
        <button id="confirmAction" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 smooth-transition">
          Confirm
        </button>
      </div>
    </div>
  </div>

  <!-- Toast Notification Container -->
  <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2 w-80"></div>

  <script>
    class UserManager {
      constructor() {
        this.users = [];
        this.currentPage = 1;
        this.itemsPerPage = 10;
        this.filters = {};
        this.editingUser = null;
        this.sortField = 'joinDate';
        this.sortDirection = 'desc';
        this.selectedUsers = new Set();
        
        this.init();
      }
      
      init() {
        this.generateMockData();
        this.setupEventListeners();
        this.simulateLoading();
      }
      
      simulateLoading() {
        // Show loading state
        document.getElementById('loadingRow').classList.remove('hidden');
        
        // Simulate API call delay
        setTimeout(() => {
          this.renderUsers();
          this.updateStats();
          document.getElementById('loadingRow').classList.add('hidden');
        }, 1000);
      }
      
      setupEventListeners() {
        // Search
        document.getElementById('searchInput').addEventListener('input', (e) => {
          this.debounce(this.handleSearch.bind(this), 500)(e.target.value);
        });
        
        // Filters
        ['roleFilter', 'statusFilter', 'dateFilter', 'verificationFilter'].forEach(id => {
          document.getElementById(id).addEventListener('change', () => {
            this.applyFilters();
          });
        });
        
        // Custom date range
        document.getElementById('dateFilter').addEventListener('change', (e) => {
          const customRange = document.getElementById('customDateRange');
          if (e.target.value === 'custom') {
            customRange.classList.remove('hidden');
          } else {
            customRange.classList.add('hidden');
          }
          this.applyFilters();
        });
        
        // Date range inputs
        ['startDate', 'endDate'].forEach(id => {
          document.getElementById(id).addEventListener('change', () => {
            this.applyFilters();
          });
        });
        
        // Reset filters
        document.getElementById('resetFilters').addEventListener('click', () => {
          this.resetFilters();
        });
        
        // Add user
        document.getElementById('addUserBtn').addEventListener('click', () => {
          this.openUserModal();
        });
        
        // Modal controls
        document.getElementById('closeModal').addEventListener('click', () => {
          this.closeUserModal();
        });
        
        document.getElementById('closeDetailsModal').addEventListener('click', () => {
          this.closeDetailsModal();
        });
        
        document.getElementById('closeConfirmationModal').addEventListener('click', () => {
          this.closeConfirmationModal();
        });
        
        document.getElementById('cancelBtn').addEventListener('click', () => {
          this.closeUserModal();
        });
        
        document.getElementById('cancelAction').addEventListener('click', () => {
          this.closeConfirmationModal();
        });
        
        // Form submission
        document.getElementById('userForm').addEventListener('submit', (e) => {
          e.preventDefault();
          this.saveUser();
        });
        
        // Image upload
        document.getElementById('uploadImageBtn').addEventListener('click', () => {
          document.getElementById('imageInput').click();
        });
        
        document.getElementById('imageInput').addEventListener('change', (e) => {
          this.handleImageUpload(e);
        });
        
        // Role change
        document.getElementById('userRole').addEventListener('change', (e) => {
          this.togglePermissionsSection(e.target.value);
        });
        
        // Pagination
        document.getElementById('prevPage').addEventListener('click', () => {
          if (this.currentPage > 1) {
            this.currentPage--;
            this.renderUsers();
          }
        });
        
        document.getElementById('nextPage').addEventListener('click', () => {
          const totalPages = Math.ceil(this.getFilteredUsers().length / this.itemsPerPage);
          if (this.currentPage < totalPages) {
            this.currentPage++;
            this.renderUsers();
          }
        });
        
        document.getElementById('firstPage').addEventListener('click', () => {
          this.currentPage = 1;
          this.renderUsers();
        });
        
        document.getElementById('lastPage').addEventListener('click', () => {
          this.currentPage = Math.ceil(this.getFilteredUsers().length / this.itemsPerPage);
          this.renderUsers();
        });
        
        // Items per page
        document.getElementById('itemsPerPage').addEventListener('change', (e) => {
          this.itemsPerPage = parseInt(e.target.value);
          this.currentPage = 1;
          this.renderUsers();
        });
        
        // Select all
        document.getElementById('selectAll').addEventListener('change', (e) => {
          this.selectAllUsers(e.target.checked);
        });
        
        // Refresh table
        document.getElementById('refreshTable').addEventListener('click', () => {
          this.simulateLoading();
        });
        
        // Export users
        document.getElementById('exportUsers').addEventListener('click', () => {
          this.showNotification('Export started. You will receive an email when ready.', 'info');
        });
      }
      
      generateMockData() {
        const roles = ['customer', 'seller', 'admin'];
        const statuses = ['active', 'inactive', 'suspended', 'pending'];
        const firstNames = ['Aarav', 'Aditi', 'Akshay', 'Ananya', 'Arjun', 'Diya', 'Ishaan', 'Kavya', 'Rohan', 'Sanya'];
        const lastNames = ['Patel', 'Sharma', 'Singh', 'Kumar', 'Gupta', 'Verma', 'Joshi', 'Malhotra', 'Reddy', 'Mehta'];
        const cities = ['Mumbai', 'Delhi', 'Bangalore', 'Hyderabad', 'Ahmedabad', 'Chennai', 'Kolkata', 'Pune', 'Jaipur', 'Surat'];
        const states = ['MH', 'DL', 'KA', 'TN', 'UP', 'GJ', 'RJ', 'AP', 'WB', 'PB'];
        
        this.users = [];
        
        for (let i = 1; i <= 2847; i++) {
          const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
          const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
          const role = roles[Math.floor(Math.random() * roles.length)];
          const status = statuses[Math.floor(Math.random() * statuses.length)];
          const city = cities[Math.floor(Math.random() * cities.length)];
          const state = states[Math.floor(Math.random() * states.length)];
          
          const user = {
            id: `USR-${String(i).padStart(4, '0')}`,
            firstName,
            lastName,
            email: `${firstName.toLowerCase()}.${lastName.toLowerCase()}@example.com`,
            phone: `+91 ${Math.floor(Math.random() * 9000000000) + 1000000000}`,
            role,
            status,
            avatar: `https://ui-avatars.com/api/?name=${firstName}+${lastName}&background=667eea&color=fff`,
            address: {
              street: `${Math.floor(Math.random() * 999) + 1} Main Street`,
              city,
              state,
              pincode: `${Math.floor(Math.random() * 900000) + 100000}`
            },
            joinDate: new Date(Date.now() - Math.random() * 365 * 24 * 60 * 60 * 1000),
            lastActive: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000),
            orders: Math.floor(Math.random() * 50),
            totalSpent: Math.floor(Math.random() * 50000),
            isVerified: Math.random() > 0.3,
            notes: Math.random() > 0.7 ? 'Important customer' : '',
            permissions: role === 'admin' ? ['all'] : role === 'seller' ? ['manage_products', 'view_orders'] : []
          };
          
          this.users.push(user);
        }
        
        // Sort by join date (newest first)
        this.users.sort((a, b) => b.joinDate - a.joinDate);
      }
      
      renderUsers() {
        const tbody = document.getElementById('usersTableBody');
        const filteredUsers = this.getFilteredUsers();
        const sortedUsers = this.sortUsers(filteredUsers);
        const startIndex = (this.currentPage - 1) * this.itemsPerPage;
        const endIndex = startIndex + this.itemsPerPage;
        const paginatedUsers = sortedUsers.slice(startIndex, endIndex);
        
        tbody.innerHTML = paginatedUsers.map(user => `
          <tr class="table-row">
            <td class="px-6 py-4 whitespace-nowrap">
              <label class="custom-checkbox">
                <input type="checkbox" class="user-checkbox" value="${user.id}" ${this.selectedUsers.has(user.id) ? 'checked' : ''}>
                <span class="checkmark"></span>
              </label>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <img src="${user.avatar}" alt="${user.firstName}" class="w-10 h-10 rounded-full mr-3 object-cover">
                <div>
                  <div class="font-medium text-gray-900">${user.firstName} ${user.lastName}</div>
                  <div class="text-sm text-gray-500 flex items-center">
                    ${user.email}
                    ${user.isVerified ? 
                      '<i class="fas fa-check-circle text-green-500 text-xs ml-1 tooltip" title="Verified"></i>' : 
                      '<i class="fas fa-exclamation-triangle text-yellow-500 text-xs ml-1 tooltip" title="Unverified"></i>'}
                  </div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              ${this.getRoleBadge(user.role)}
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              ${this.getStatusBadge(user.status)}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              ${this.formatDate(user.joinDate)}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              ${this.formatDateRelative(user.lastActive)}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              <div class="flex items-center">
                ${user.orders}
                ${user.orders > 0 ? 
                  `<span class="ml-1 text-xs text-gray-500">(₹${user.totalSpent.toLocaleString()})</span>` : ''}
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <div class="flex items-center space-x-2">
                <button onclick="userManager.viewUser('${user.id}')" class="text-blue-600 hover:text-blue-900 smooth-transition tooltip" title="View Details">
                  <i class="fas fa-eye"></i>
                </button>
                <button onclick="userManager.editUser('${user.id}')" class="text-green-600 hover:text-green-900 smooth-transition tooltip" title="Edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button onclick="userManager.toggleUserStatus('${user.id}')" class="text-yellow-600 hover:text-yellow-900 smooth-transition tooltip" title="${user.status === 'active' ? 'Deactivate' : 'Activate'}">
                  <i class="fas fa-${user.status === 'active' ? 'pause' : 'play'}"></i>
                </button>
                <button onclick="userManager.deleteUser('${user.id}')" class="text-red-600 hover:text-red-900 smooth-transition tooltip" title="Delete">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        `).join('');
        
        // Add event listeners to checkboxes
        document.querySelectorAll('.user-checkbox').forEach(checkbox => {
          checkbox.addEventListener('change', (e) => {
            const userId = e.target.value;
            if (e.target.checked) {
              this.selectedUsers.add(userId);
            } else {
              this.selectedUsers.delete(userId);
              document.getElementById('selectAll').checked = false;
            }
          });
        });
        
        this.updatePagination();
      }
      
      sortUsers(users) {
        return users.sort((a, b) => {
          let comparison = 0;
          
          switch (this.sortField) {
            case 'name':
              comparison = `${a.firstName} ${a.lastName}`.localeCompare(`${b.firstName} ${b.lastName}`);
              break;
            case 'role':
              comparison = a.role.localeCompare(b.role);
              break;
            case 'status':
              comparison = a.status.localeCompare(b.status);
              break;
            case 'joinDate':
              comparison = a.joinDate - b.joinDate;
              break;
            case 'lastActive':
              comparison = a.lastActive - b.lastActive;
              break;
            case 'orders':
              comparison = a.orders - b.orders;
              break;
            default:
              comparison = a.joinDate - b.joinDate;
          }
          
          return this.sortDirection === 'asc' ? comparison : -comparison;
        });
      }
      
      sortTable(field) {
        if (this.sortField === field) {
          this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
        } else {
          this.sortField = field;
          this.sortDirection = 'asc';
        }
        
        this.renderUsers();
      }
      
      getRoleBadge(role) {
        const badges = {
          customer: '<span class="badge badge-primary">Customer</span>',
          seller: '<span class="badge badge-info">Seller</span>',
          admin: '<span class="badge badge-danger">Admin</span>'
        };
        
        return badges[role] || badges.customer;
      }
      
      getStatusBadge(status) {
        const badges = {
          active: '<span class="badge badge-success">Active</span>',
          inactive: '<span class="badge badge-secondary">Inactive</span>',
          suspended: '<span class="badge badge-danger">Suspended</span>',
          pending: '<span class="badge badge-warning">Pending</span>'
        };
        
        return badges[status] || badges.active;
      }
      
      getFilteredUsers() {
        return this.users.filter(user => {
          // Role filter
          if (this.filters.role && user.role !== this.filters.role) return false;
          
          // Status filter
          if (this.filters.status && user.status !== this.filters.status) return false;
          
          // Verification filter
          if (this.filters.verification === 'verified' && !user.isVerified) return false;
          if (this.filters.verification === 'pending' && user.isVerified) return false;
          
          // Date filter
          if (this.filters.date) {
            const now = new Date();
            const userDate = new Date(user.joinDate);
            
            switch (this.filters.date) {
              case 'today':
                if (!this.isSameDay(userDate, now)) return false;
                break;
              case 'week':
                const startOfWeek = new Date(now);
                startOfWeek.setDate(now.getDate() - now.getDay());
                if (userDate < startOfWeek) return false;
                break;
              case 'month':
                if (userDate.getMonth() !== now.getMonth() || userDate.getFullYear() !== now.getFullYear()) return false;
                break;
              case 'year':
                if (userDate.getFullYear() !== now.getFullYear()) return false;
                break;
              case 'custom':
                if (this.filters.startDate && this.filters.endDate) {
                  const startDate = new Date(this.filters.startDate);
                  const endDate = new Date(this.filters.endDate);
                  if (userDate < startDate || userDate > endDate) return false;
                }
                break;
            }
          }
          
          // Search filter
          if (this.filters.search) {
            const search = this.filters.search.toLowerCase();
            const searchFields = {
              name: document.getElementById('searchName').checked,
              email: document.getElementById('searchEmail').checked,
              phone: document.getElementById('searchPhone').checked,
              id: document.getElementById('searchId').checked
            };
            
            let matches = false;
            
            if (searchFields.name && 
                (`${user.firstName} ${user.lastName}`.toLowerCase().includes(search) || 
                 `${user.lastName} ${user.firstName}`.toLowerCase().includes(search))) {
              matches = true;
            }
            
            if (!matches && searchFields.email && user.email.toLowerCase().includes(search)) {
              matches = true;
            }
            
            if (!matches && searchFields.phone && user.phone.includes(search)) {
              matches = true;
            }
            
            if (!matches && searchFields.id && user.id.toLowerCase().includes(search)) {
              matches = true;
            }
            
            if (!matches) return false;
          }
          
          return true;
        });
      }
      
      isSameDay(date1, date2) {
        return date1.getFullYear() === date2.getFullYear() &&
               date1.getMonth() === date2.getMonth() &&
               date1.getDate() === date2.getDate();
      }
      
      updatePagination() {
        const filteredUsers = this.getFilteredUsers();
        const totalItems = filteredUsers.length;
        const totalPages = Math.ceil(totalItems / this.itemsPerPage);
        const startItem = (this.currentPage - 1) * this.itemsPerPage + 1;
        const endItem = Math.min(this.currentPage * this.itemsPerPage, totalItems);
        
        document.getElementById('showingFrom').textContent = startItem.toLocaleString();
        document.getElementById('showingTo').textContent = endItem.toLocaleString();
        document.getElementById('totalItems').textContent = totalItems.toLocaleString();
        
        // Update pagination buttons
        document.getElementById('prevPage').disabled = this.currentPage <= 1;
        document.getElementById('nextPage').disabled = this.currentPage >= totalPages;
        document.getElementById('firstPage').disabled = this.currentPage <= 1;
        document.getElementById('lastPage').disabled = this.currentPage >= totalPages;
        
        // Generate page buttons
        const pageButtonsContainer = document.querySelector('.flex.items-center.space-x-1');
        pageButtonsContainer.innerHTML = '';
        
        // Always show first page
        if (totalPages > 1) {
          this.createPageButton(1, pageButtonsContainer);
        }
        
        // Show ellipsis if needed
        if (this.currentPage > 3) {
          const ellipsis = document.createElement('span');
          ellipsis.className = 'px-2';
          ellipsis.textContent = '...';
          pageButtonsContainer.appendChild(ellipsis);
        }
        
        // Show current page and neighbors
        const startPage = Math.max(2, this.currentPage - 1);
        const endPage = Math.min(totalPages - 1, this.currentPage + 1);
        
        for (let i = startPage; i <= endPage; i++) {
          this.createPageButton(i, pageButtonsContainer);
        }
        
        // Show ellipsis if needed
        if (this.currentPage < totalPages - 2) {
          const ellipsis = document.createElement('span');
          ellipsis.className = 'px-2';
          ellipsis.textContent = '...';
          pageButtonsContainer.appendChild(ellipsis);
        }
        
        // Always show last page if different from first
        if (totalPages > 1) {
          this.createPageButton(totalPages, pageButtonsContainer);
        }
      }
      
      createPageButton(pageNumber, container) {
        const pageBtn = document.createElement('button');
        pageBtn.className = `page-btn px-3 py-1 border rounded smooth-transition ${this.currentPage === pageNumber ? 'bg-indigo-600 text-white border-indigo-600' : 'border-gray-300 hover:bg-gray-50'}`;
        pageBtn.textContent = pageNumber;
        pageBtn.addEventListener('click', () => {
          this.currentPage = pageNumber;
          this.renderUsers();
        });
        container.appendChild(pageBtn);
      }
      
      updateStats() {
        const total = this.users.length;
        const active = this.users.filter(u => u.status === 'active').length;
        const sellers = this.users.filter(u => u.role === 'seller').length;
        const admins = this.users.filter(u => u.role === 'admin').length;
        
        document.getElementById('totalUsers').textContent = total.toLocaleString();
        document.getElementById('activeUsers').textContent = active.toLocaleString();
        document.getElementById('totalSellers').textContent = sellers.toLocaleString();
        document.getElementById('totalAdmins').textContent = admins.toLocaleString();
      }
      
      openUserModal(user = null) {
        this.editingUser = user;
        const modal = document.getElementById('userModal');
        const title = document.getElementById('modalTitle');
        const form = document.getElementById('userForm');
        
        if (user) {
          title.textContent = 'Edit User';
          // Populate form with user data
          document.getElementById('firstName').value = user.firstName;
          document.getElementById('lastName').value = user.lastName;
          document.getElementById('userEmail').value = user.email;
          document.getElementById('userPhone').value = user.phone;
          document.getElementById('userRole').value = user.role;
          document.getElementById('userStatus').value = user.status;
          document.getElementById('address').value = user.address?.street || '';
          document.getElementById('city').value = user.address?.city || '';
          document.getElementById('state').value = user.address?.state || '';
          document.getElementById('pincode').value = user.address?.pincode || '';
          document.getElementById('notes').value = user.notes || '';
          
          // Update profile preview
          const preview = document.getElementById('profilePreview');
          preview.innerHTML = `<img src="${user.avatar}" alt="Profile" class="w-full h-full rounded-full object-cover">`;
          
          // Hide password section for existing users
          document.getElementById('passwordSection').classList.add('hidden');
          
          this.togglePermissionsSection(user.role);
          
          // Set permissions checkboxes
          if (user.permissions) {
            document.getElementById('canManageOrders').checked = user.permissions.includes('all') || user.permissions.includes('manage_orders');
            document.getElementById('canManageProducts').checked = user.permissions.includes('all') || user.permissions.includes('manage_products');
            document.getElementById('canManageUsers').checked = user.permissions.includes('all') || user.permissions.includes('manage_users');
            document.getElementById('canViewAnalytics').checked = user.permissions.includes('all') || user.permissions.includes('view_analytics');
            document.getElementById('canManageContent').checked = user.permissions.includes('all') || user.permissions.includes('manage_content');
            document.getElementById('canManageSettings').checked = user.permissions.includes('all') || user.permissions.includes('manage_settings');
          }
        } else {
          title.textContent = 'Add New User';
          form.reset();
          document.getElementById('profilePreview').innerHTML = '<i class="fas fa-user"></i>';
          document.getElementById('passwordSection').classList.remove('hidden');
        }
        
        modal.classList.remove('hidden');
      }
      
      closeUserModal() {
        document.getElementById('userModal').classList.add('hidden');
        this.editingUser = null;
      }
      
      closeDetailsModal() {
        document.getElementById('userDetailsModal').classList.add('hidden');
      }
      
      closeConfirmationModal() {
        document.getElementById('confirmationModal').classList.add('hidden');
      }
      
      saveUser() {
        const formData = {
          firstName: document.getElementById('firstName').value.trim(),
          lastName: document.getElementById('lastName').value.trim(),
          email: document.getElementById('userEmail').value.trim(),
          phone: document.getElementById('userPhone').value.trim(),
          role: document.getElementById('userRole').value,
          status: document.getElementById('userStatus').value,
          address: {
            street: document.getElementById('address').value.trim(),
            city: document.getElementById('city').value.trim(),
            state: document.getElementById('state').value,
            pincode: document.getElementById('pincode').value.trim()
          },
          notes: document.getElementById('notes').value.trim(),
          permissions: []
        };
        
        // Get permissions if role is admin or seller
        if (formData.role === 'admin' || formData.role === 'seller') {
          if (document.getElementById('canManageOrders').checked) formData.permissions.push('manage_orders');
          if (document.getElementById('canManageProducts').checked) formData.permissions.push('manage_products');
          if (document.getElementById('canManageUsers').checked) formData.permissions.push('manage_users');
          if (document.getElementById('canViewAnalytics').checked) formData.permissions.push('view_analytics');
          if (document.getElementById('canManageContent').checked) formData.permissions.push('manage_content');
          if (document.getElementById('canManageSettings').checked) formData.permissions.push('manage_settings');
          
          // If admin and all permissions checked, just set to 'all'
          if (formData.role === 'admin' && formData.permissions.length === 6) {
            formData.permissions = ['all'];
          }
        }
        
        // Validate form
        if (!formData.firstName || !formData.lastName || !formData.email || !formData.role || !formData.status) {
          this.showNotification('Please fill in all required fields', 'error');
          return;
        }
        
        // Validate email format
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(formData.email)) {
          this.showNotification('Please enter a valid email address', 'error');
          return;
        }
        
        // For new users, validate password
        if (!this.editingUser) {
          const password = document.getElementById('password').value;
          const confirmPassword = document.getElementById('confirmPassword').value;
          
          if (!password || !confirmPassword) {
            this.showNotification('Password fields are required', 'error');
            return;
          }
          
          if (password.length < 8) {
            this.showNotification('Password must be at least 8 characters', 'error');
            return;
          }
          
          if (password !== confirmPassword) {
            this.showNotification('Passwords do not match', 'error');
            return;
          }
        }
        
        if (this.editingUser) {
          // Update existing user
          const index = this.users.findIndex(u => u.id === this.editingUser.id);
          if (index !== -1) {
            this.users[index] = { 
              ...this.users[index], 
              ...formData,
              // Preserve existing fields not in form
              id: this.users[index].id,
              avatar: this.users[index].avatar,
              joinDate: this.users[index].joinDate,
              lastActive: this.users[index].lastActive,
              orders: this.users[index].orders,
              totalSpent: this.users[index].totalSpent,
              isVerified: this.users[index].isVerified
            };
          }
          this.showNotification('User updated successfully!', 'success');
        } else {
          // Add new user
          const newUser = {
            ...formData,
            id: `USR-${String(this.users.length + 1).padStart(4, '0')}`,
            avatar: `https://ui-avatars.com/api/?name=${formData.firstName}+${formData.lastName}&background=667eea&color=fff`,
            joinDate: new Date(),
            lastActive: new Date(),
            orders: 0,
            totalSpent: 0,
            isVerified: false
          };
          this.users.unshift(newUser);
          this.showNotification('User added successfully!', 'success');
        }
        
        this.closeUserModal();
        this.renderUsers();
        this.updateStats();
      }
      
      viewUser(userId) {
        const user = this.users.find(u => u.id === userId);
        if (!user) return;
        
        const modal = document.getElementById('userDetailsModal');
        const content = document.getElementById('userDetailsContent');
        
        // Format permissions for display
        let permissionsDisplay = 'None';
        if (user.permissions && user.permissions.length > 0) {
          if (user.permissions.includes('all')) {
            permissionsDisplay = 'All Permissions';
          } else {
            permissionsDisplay = user.permissions
              .map(p => {
                switch(p) {
                  case 'manage_orders': return 'Manage Orders';
                  case 'manage_products': return 'Manage Products';
                  case 'manage_users': return 'Manage Users';
                  case 'view_analytics': return 'View Analytics';
                  case 'manage_content': return 'Manage Content';
                  case 'manage_settings': return 'Manage Settings';
                  default: return p;
                }
              })
              .join(', ');
          }
        }
        
        content.innerHTML = `
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- User Profile -->
            <div class="lg:col-span-1">
              <div class="text-center">
                <img src="${user.avatar}" alt="${user.firstName}" class="w-32 h-32 rounded-full mx-auto mb-4 object-cover">
                <h3 class="text-xl font-bold text-gray-800">${user.firstName} ${user.lastName}</h3>
                <p class="text-gray-600 mb-4">${user.email}</p>
                <div class="flex justify-center space-x-2 mb-6">
                  ${this.getRoleBadge(user.role)}
                  ${this.getStatusBadge(user.status)}
                </div>
              </div>
              
              <div class="bg-gray-50 rounded-lg p-4 space-y-3">
                <div class="flex items-center justify-between">
                  <span class="text-gray-600">User ID:</span>
                  <span class="font-medium">${user.id}</span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-gray-600">Phone:</span>
                  <span class="font-medium">${user.phone}</span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-gray-600">Joined:</span>
                  <span class="font-medium">${this.formatDate(user.joinDate)}</span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-gray-600">Last Active:</span>
                  <span class="font-medium">${this.formatDateRelative(user.lastActive)}</span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-gray-600">Verified:</span>
                  <span class="font-medium ${user.isVerified ? 'text-green-600' : 'text-red-600'}">
                    <i class="fas fa-${user.isVerified ? 'check-circle' : 'times-circle'} mr-1"></i>
                    ${user.isVerified ? 'Yes' : 'No'}
                  </span>
                </div>
                ${user.role === 'admin' || user.role === 'seller' ? `
                <div class="flex items-start justify-between">
                  <span class="text-gray-600">Permissions:</span>
                  <span class="font-medium text-right">${permissionsDisplay}</span>
                </div>
                ` : ''}
              </div>
            </div>
            
            <!-- User Details -->
            <div class="lg:col-span-2">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Address -->
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                  <h4 class="font-semibold text-gray-800 mb-3">
                    <i class="fas fa-map-marker-alt mr-2 text-blue-600"></i>Address
                  </h4>
                  ${user.address?.street ? `
                    <p class="text-gray-600">${user.address.street}</p>
                    <p class="text-gray-600">${user.address.city}, ${user.address.state}</p>
                    <p class="text-gray-600">${user.address.pincode}</p>
                  ` : '<p class="text-gray-400 italic">No address provided</p>'}
                </div>
                
                <!-- Order Statistics -->
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                  <h4 class="font-semibold text-gray-800 mb-3">
                    <i class="fas fa-shopping-cart mr-2 text-green-600"></i>Order Stats
                  </h4>
                  <div class="space-y-2">
                    <div class="flex justify-between">
                      <span class="text-gray-600">Total Orders:</span>
                      <span class="font-medium">${user.orders}</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-gray-600">Total Spent:</span>
                      <span class="font-medium">₹${user.totalSpent?.toLocaleString() || 0}</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-gray-600">Avg Order:</span>
                      <span class="font-medium">₹${user.orders > 0 ? Math.round(user.totalSpent / user.orders).toLocaleString() : 0}</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-gray-600">Last Order:</span>
                      <span class="font-medium">${user.orders > 0 ? '2 days ago' : 'Never'}</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Recent Activity -->
              <div class="mt-6">
                <h4 class="font-semibold text-gray-800 mb-4">
                  <i class="fas fa-history mr-2 text-purple-600"></i>Recent Activity
                </h4>
                <div class="bg-gray-50 rounded-lg p-4">
                  <div class="space-y-3">
                    <div class="flex items-center space-x-3">
                      <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                      <span class="text-gray-700">Last login: ${this.formatDateRelative(user.lastActive)}</span>
                    </div>
                    <div class="flex items-center space-x-3">
                      <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                      <span class="text-gray-700">Account created: ${this.formatDate(user.joinDate)}</span>
                    </div>
                    ${user.orders > 0 ? `
                    <div class="flex items-center space-x-3">
                      <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                      <span class="text-gray-700">Last order: 2 days ago</span>
                    </div>
                    ` : ''}
                    ${user.notes ? `
                    <div class="flex items-start space-x-3">
                      <div class="w-2 h-2 bg-yellow-500 rounded-full mt-2"></div>
                      <div>
                        <span class="text-gray-700">Notes:</span>
                        <p class="text-gray-600 text-sm">${user.notes}</p>
                      </div>
                    </div>
                    ` : ''}
                  </div>
                </div>
              </div>
              
              <!-- Actions -->
              <div class="mt-6 flex flex-wrap gap-3">
                <button onclick="userManager.editUser('${user.id}'); userManager.closeDetailsModal();" 
                        class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 smooth-transition flex items-center">
                  <i class="fas fa-edit mr-2"></i>Edit User
                </button>
                <button onclick="userManager.toggleUserStatus('${user.id}'); userManager.closeDetailsModal();" 
                        class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 smooth-transition flex items-center">
                  <i class="fas fa-${user.status === 'active' ? 'pause' : 'play'} mr-2"></i>
                  ${user.status === 'active' ? 'Deactivate' : 'Activate'}
                </button>
                <button onclick="userManager.sendMessage('${user.id}')" 
                        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 smooth-transition flex items-center">
                  <i class="fas fa-envelope mr-2"></i>Send Message
                </button>
                <button onclick="userManager.resetPassword('${user.id}')" 
                        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 smooth-transition flex items-center">
                  <i class="fas fa-key mr-2"></i>Reset Password
                </button>
                <button onclick="userManager.deleteUser('${user.id}')" 
                        class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 smooth-transition flex items-center">
                  <i class="fas fa-trash mr-2"></i>Delete User
                </button>
              </div>
            </div>
          </div>
        `;
        
        modal.classList.remove('hidden');
      }
      
      editUser(userId) {
        const user = this.users.find(u => u.id === userId);
        if (user) {
          this.openUserModal(user);
        }
      }
      
      toggleUserStatus(userId) {
        const userIndex = this.users.findIndex(u => u.id === userId);
        if (userIndex !== -1) {
          const currentStatus = this.users[userIndex].status;
          const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
          
          this.showConfirmation(
            `${currentStatus === 'active' ? 'Deactivate' : 'Activate'} User`,
            `Are you sure you want to ${currentStatus === 'active' ? 'deactivate' : 'activate'} this user?`,
            () => {
              this.users[userIndex].status = newStatus;
              this.renderUsers();
              this.updateStats();
              this.showNotification(
                `User ${currentStatus === 'active' ? 'deactivated' : 'activated'} successfully!`, 
                'success'
              );
            }
          );
        }
      }
      
      deleteUser(userId) {
        this.showConfirmation(
          'Delete User',
          'Are you sure you want to delete this user? This action cannot be undone.',
          () => {
            this.users = this.users.filter(u => u.id !== userId);
            this.selectedUsers.delete(userId);
            this.renderUsers();
            this.updateStats();
            this.showNotification('User deleted successfully!', 'success');
          }
        );
      }
      
      resetPassword(userId) {
        this.showNotification('Password reset link sent to user email', 'success');
      }
      
      sendMessage(userId) {
        this.showNotification('Message sent successfully!', 'success');
      }
      
      showConfirmation(title, message, confirmCallback) {
        const modal = document.getElementById('confirmationModal');
        document.getElementById('confirmationTitle').textContent = title;
        document.getElementById('confirmationMessage').textContent = message;
        
        const confirmBtn = document.getElementById('confirmAction');
        // Remove previous event listeners
        confirmBtn.replaceWith(confirmBtn.cloneNode(true));
        
        document.getElementById('confirmAction').addEventListener('click', () => {
          confirmCallback();
          this.closeConfirmationModal();
        });
        
        modal.classList.remove('hidden');
      }
      
      handleSearch(query) {
        this.filters.search = query;
        this.currentPage = 1;
        this.renderUsers();
      }
      
      applyFilters() {
        this.filters.role = document.getElementById('roleFilter').value;
        this.filters.status = document.getElementById('statusFilter').value;
        this.filters.date = document.getElementById('dateFilter').value;
        this.filters.verification = document.getElementById('verificationFilter').value;
        
        if (this.filters.date === 'custom') {
          this.filters.startDate = document.getElementById('startDate').value;
          this.filters.endDate = document.getElementById('endDate').value;
        } else {
          delete this.filters.startDate;
          delete this.filters.endDate;
        }
        
        this.currentPage = 1;
        this.renderUsers();
      }
      
      resetFilters() {
        this.filters = {};
        document.getElementById('searchInput').value = '';
        document.getElementById('roleFilter').value = '';
        document.getElementById('statusFilter').value = '';
        document.getElementById('dateFilter').value = '';
        document.getElementById('verificationFilter').value = '';
        document.getElementById('customDateRange').classList.add('hidden');
        
        // Reset search options
        document.getElementById('searchName').checked = true;
        document.getElementById('searchEmail').checked = true;
        document.getElementById('searchPhone').checked = false;
        document.getElementById('searchId').checked = false;
        
        this.currentPage = 1;
        this.renderUsers();
      }
      
      selectAllUsers(checked) {
        const checkboxes = document.querySelectorAll('.user-checkbox');
        checkboxes.forEach(checkbox => {
          checkbox.checked = checked;
          const userId = checkbox.value;
          if (checked) {
            this.selectedUsers.add(userId);
          } else {
            this.selectedUsers.delete(userId);
          }
        });
      }
      
      handleImageUpload(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        // Validate file type
        if (!file.type.match('image.*')) {
          this.showNotification('Please select an image file', 'error');
          return;
        }
        
        // Validate file size (max 2MB)
        if (file.size > 2 * 1024 * 1024) {
          this.showNotification('Image size should be less than 2MB', 'error');
          return;
        }
        
        const reader = new FileReader();
        reader.onload = (e) => {
          document.getElementById('profilePreview').innerHTML = 
            `<img src="${e.target.result}" alt="Profile" class="w-full h-full rounded-full object-cover">`;
        };
        reader.readAsDataURL(file);
      }
      
      togglePermissionsSection(role) {
        const section = document.getElementById('permissionsSection');
        if (role === 'admin' || role === 'seller') {
          section.classList.remove('hidden');
        } else {
          section.classList.add('hidden');
        }
      }
      
      togglePasswordVisibility(fieldId) {
        const field = document.getElementById(fieldId);
        const icon = field.nextElementSibling.querySelector('i');
        
        if (field.type === 'password') {
          field.type = 'text';
          icon.classList.replace('fa-eye', 'fa-eye-slash');
        } else {
          field.type = 'password';
          icon.classList.replace('fa-eye-slash', 'fa-eye');
        }
      }
      
      formatDate(date) {
        return new Intl.DateTimeFormat('en-IN', {
          year: 'numeric',
          month: 'short',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        }).format(date);
      }
      
      formatDateRelative(date) {
        const now = new Date();
        const diff = now - date;
        const seconds = Math.floor(diff / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours = Math.floor(minutes / 60);
        const days = Math.floor(hours / 24);
        
        if (seconds < 60) return 'Just now';
        if (minutes < 60) return `${minutes} min ago`;
        if (hours < 24) return `${hours} hr ago`;
        if (days === 1) return 'Yesterday';
        if (days < 7) return `${days} days ago`;
        if (days < 30) return `${Math.floor(days / 7)} weeks ago`;
        if (days < 365) return `${Math.floor(days / 30)} months ago`;
        
        return this.formatDate(date);
      }
      
      showNotification(message, type = 'info') {
        const toastContainer = document.getElementById('toastContainer');
        const toastId = `toast-${Date.now()}`;
        
        const colors = {
          success: 'bg-green-600',
          error: 'bg-red-600',
          info: 'bg-blue-600',
          warning: 'bg-yellow-600'
        };
        
        const icons = {
          success: 'fas fa-check-circle',
          error: 'fas fa-exclamation-circle',
          info: 'fas fa-info-circle',
          warning: 'fas fa-exclamation-triangle'
        };
        
        const toast = document.createElement('div');
        toast.id = toastId;
        toast.className = `toast p-4 rounded-lg shadow-lg text-white flex items-start ${colors[type]}`;
        toast.innerHTML = `
          <i class="${icons[type]} mt-1 mr-3"></i>
          <div class="flex-1">${message}</div>
          <button class="ml-3 text-white hover:text-gray-200" onclick="document.getElementById('${toastId}').classList.add('hide')">
            <i class="fas fa-times"></i>
          </button>
        `;
        
        toastContainer.appendChild(toast);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
          if (document.getElementById(toastId)) {
            toast.classList.add('hide');
            setTimeout(() => {
              toast.remove();
            }, 300);
          }
        }, 5000);
      }
      
      debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }
    }
    
    // Initialize when DOM is loaded
    let userManager;
    document.addEventListener('DOMContentLoaded', () => {
      userManager = new UserManager();
      
      // Set today's date as default for date inputs
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('startDate').value = today;
      document.getElementById('endDate').value = today;
      document.getElementById('startDate').max = today;
      document.getElementById('endDate').max = today;
    });
  </script>
</body>
</html>