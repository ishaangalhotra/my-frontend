<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hybrid Auth Client Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status { padding: 15px; border-radius: 5px; margin: 10px 0; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        input { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 3px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Hybrid Auth Client Test</h1>
        
        <div id="loadStatus" class="status info">Testing script loading...</div>
        
        <div id="clientStatus" class="status info">Checking client status...</div>
        
        <h3>Test Login</h3>
        <input type="email" id="testEmail" placeholder="test@example.com" value="test@quicklocal.com">
        <input type="password" id="testPassword" placeholder="password" value="test123">
        <button onclick="testLogin()">Test Login</button>
        <div id="loginResult"></div>
        
        <h3>Backend Connection Test</h3>
        <button onclick="testBackend()">Test Backend</button>
        <div id="backendResult"></div>
        
        <h3>Debug Information</h3>
        <div id="debugInfo" class="status info">Ready for testing...</div>
    </div>

    <!-- Load hybrid auth client from backend server -->
    <script src="http://localhost:10000/hybrid-auth-client.js"></script>
    
    <script>
        let authClient = null;
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üß™ Hybrid auth test page loaded');
            
            // Test script loading
            setTimeout(() => {
                const loadStatusDiv = document.getElementById('loadStatus');
                const clientStatusDiv = document.getElementById('clientStatus');
                const debugInfoDiv = document.getElementById('debugInfo');
                
                if (typeof HybridAuthClient !== 'undefined') {
                    loadStatusDiv.className = 'status success';
                    loadStatusDiv.innerHTML = '‚úÖ hybrid-auth-client.js loaded successfully!';
                    
                    try {
                        // Initialize the client
                        authClient = new HybridAuthClient(
                            'https://pmvhsjezhuokwygvhhqk.supabase.co',
                            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBtdmhzamV6aHVva3d5Z3ZoaHFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjYzOTAwMjksImV4cCI6MjA0MTk2NjAyOX0.c6aUZnHBHBGK-Bh1EKCbTMN5CHPt7Kul0T3FHFJfmLI',
                            'http://localhost:10000'
                        );
                        
                        clientStatusDiv.className = 'status success';
                        clientStatusDiv.innerHTML = '‚úÖ HybridAuthClient initialized successfully!';
                        
                        debugInfoDiv.innerHTML = `
                            <strong>Debug Info:</strong><br>
                            - Backend URL: http://localhost:10000<br>
                            - Supabase URL: https://pmvhsjezhuokwygvhhqk.supabase.co<br>
                            - Client initialized: ${authClient ? 'Yes' : 'No'}<br>
                            - Auth method: ${authClient?.authMethod || 'None'}<br>
                        `;
                        
                    } catch (error) {
                        clientStatusDiv.className = 'status error';
                        clientStatusDiv.innerHTML = '‚ùå Failed to initialize HybridAuthClient: ' + error.message;
                        debugInfoDiv.innerHTML = '‚ùå Error: ' + error.message;
                    }
                } else {
                    loadStatusDiv.className = 'status error';
                    loadStatusDiv.innerHTML = '‚ùå HybridAuthClient is not defined - script failed to load!';
                    debugInfoDiv.innerHTML = '‚ùå Check if backend server is running on http://localhost:10000';
                }
            }, 1000);
        });
        
        async function testLogin() {
            const resultDiv = document.getElementById('loginResult');
            const email = document.getElementById('testEmail').value;
            const password = document.getElementById('testPassword').value;
            
            if (!authClient) {
                resultDiv.className = 'status error';
                resultDiv.innerHTML = '‚ùå Auth client not initialized';
                return;
            }
            
            resultDiv.className = 'status info';
            resultDiv.innerHTML = 'üîÑ Testing login...';
            
            try {
                const result = await authClient.login(email, password);
                
                if (result.success) {
                    resultDiv.className = 'status success';
                    resultDiv.innerHTML = '‚úÖ Login successful: ' + JSON.stringify(result, null, 2);
                } else {
                    resultDiv.className = 'status error';
                    resultDiv.innerHTML = '‚ùå Login failed: ' + result.message;
                }
            } catch (error) {
                resultDiv.className = 'status error';
                resultDiv.innerHTML = '‚ùå Login error: ' + error.message;
            }
        }
        
        async function testBackend() {
            const resultDiv = document.getElementById('backendResult');
            
            resultDiv.className = 'status info';
            resultDiv.innerHTML = 'üîÑ Testing backend connection...';
            
            try {
                const response = await fetch('http://localhost:10000/health');
                const data = await response.json();
                
                resultDiv.className = 'status success';
                resultDiv.innerHTML = '‚úÖ Backend connected: ' + data.status;
                
            } catch (error) {
                resultDiv.className = 'status error';
                resultDiv.innerHTML = '‚ùå Backend connection failed: ' + error.message;
            }
        }
    </script>
</body>
</html>
