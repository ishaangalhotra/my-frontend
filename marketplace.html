<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🛒 QuickLocal - Premium Local Marketplace</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2874f0;
            --primary-dark: #1e5ba8;
            --secondary-color: #ff6161;
            --success-color: #00d084;
            --warning-color: #ff9f00;
            --error-color: #ff6161;
            --text-primary: #212121;
            --text-secondary: #878787;
            --background-light: #fafafa;
            --background-white: #ffffff;
            --border-color: #e0e0e0;
            --shadow-light: 0 2px 4px rgba(0,0,0,0.08);
            --shadow-medium: 0 4px 12px rgba(0,0,0,0.15);
            --shadow-heavy: 0 8px 24px rgba(0,0,0,0.15);
            --border-radius: 8px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--background-light);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }

        .loading-overlay.hide {
            opacity: 0;
            pointer-events: none;
        }

        .loading-content {
            text-align: center;
            color: white;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Header */
        .header {
            background: var(--background-white);
            box-shadow: var(--shadow-light);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: var(--transition);
        }

        .header.scrolled {
            box-shadow: var(--shadow-medium);
        }

        .nav {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            height: 64px;
            gap: 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .search-container {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .search-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-input {
            width: 100%;
            height: 40px;
            padding: 0 50px 0 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 14px;
            transition: var(--transition);
            background: var(--background-white);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(40, 116, 240, 0.1);
        }

        .search-btn {
            position: absolute;
            right: 8px;
            background: var(--primary-color);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .search-btn:hover {
            background: var(--primary-dark);
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--background-white);
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1001;
            display: none;
            box-shadow: var(--shadow-medium);
        }

        .search-suggestions.show {
            display: block;
            animation: slideDown 0.2s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .suggestion-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f1f1f1;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .suggestion-item:hover {
            background: var(--background-light);
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border: none;
            background: none;
            color: var(--text-primary);
            cursor: pointer;
            border-radius: var(--border-radius);
            transition: var(--transition);
            font-weight: 500;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: var(--background-light);
        }

        .cart-btn {
            background: var(--primary-color);
            color: white;
            position: relative;
        }

        .cart-btn:hover {
            background: var(--primary-dark);
            color: white;
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--secondary-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Banner Section */
        .banner-section {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 60px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .banner-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translateX(-50px) translateY(-50px); }
            100% { transform: translateX(50px) translateY(50px); }
        }

        .banner-content {
            position: relative;
            z-index: 1;
            max-width: 600px;
            margin: 0 auto;
        }

        .banner-title {
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 16px;
            animation: fadeInUp 1s ease;
        }

        .banner-subtitle {
            font-size: 18px;
            opacity: 0.9;
            margin-bottom: 32px;
            animation: fadeInUp 1s ease 0.2s both;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .banner-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 40px;
            animation: fadeInUp 1s ease 0.4s both;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            display: block;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.8;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Status Banner */
        .status-banner {
            margin: 20px 0;
            padding: 16px 20px;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: var(--transition);
            animation: slideInDown 0.5s ease;
        }

        @keyframes slideInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .status-banner.connecting {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #bbdefb;
        }

        .status-banner.connected {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }

        .status-banner.error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }

        .status-icon {
            animation: spin 2s linear infinite;
        }

        .status-banner.connected .status-icon,
        .status-banner.error .status-icon {
            animation: none;
        }

        /* Filters Section */
        .filters-section {
            background: var(--background-white);
            border-radius: var(--border-radius);
            padding: 24px;
            margin: 20px 0;
            box-shadow: var(--shadow-light);
            animation: fadeIn 0.8s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .filters-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }

        .filters-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .clear-filters {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .clear-filters:hover {
            text-decoration: underline;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-label {
            font-weight: 500;
            color: var(--text-primary);
            font-size: 14px;
        }

        .filter-select,
        .filter-input {
            height: 40px;
            padding: 0 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 14px;
            transition: var(--transition);
            background: var(--background-white);
        }

        .filter-select:focus,
        .filter-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(40, 116, 240, 0.1);
        }

        .apply-filters-btn {
            height: 40px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .apply-filters-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        /* Products Section */
        .products-section {
            margin: 20px 0;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .view-toggle {
            display: flex;
            background: var(--background-white);
            border-radius: var(--border-radius);
            padding: 4px;
            box-shadow: var(--shadow-light);
        }

        .view-btn {
            padding: 8px 12px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 4px;
            transition: var(--transition);
            color: var(--text-secondary);
        }

        .view-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .products-list {
            display: none;
            flex-direction: column;
            gap: 16px;
        }

        .products-list.active {
            display: flex;
        }

        .products-grid.list-view {
            display: none;
        }

        /* Product Card */
        .product-card {
            background: var(--background-white);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
            position: relative;
            cursor: pointer;
            animation: slideInUp 0.6s ease;
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-heavy);
        }

        .product-image-container {
            position: relative;
            height: 200px;
            overflow: hidden;
            background: #f8f9fa;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .product-card:hover .product-image {
            transform: scale(1.05);
        }

        .product-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: var(--secondary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1;
        }

        .product-wishlist {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            z-index: 1;
        }

        .product-wishlist:hover {
            background: var(--secondary-color);
            color: white;
            transform: scale(1.1);
        }

        .product-wishlist.active {
            background: var(--secondary-color);
            color: white;
        }

        .product-content {
            padding: 16px;
        }

        .product-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-description {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 12px;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 12px;
        }

        .rating-stars {
            display: flex;
            gap: 2px;
        }

        .star {
            color: #ffc107;
            font-size: 14px;
        }

        .star.empty {
            color: #e0e0e0;
        }

        .rating-text {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .product-price {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .current-price {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .original-price {
            font-size: 14px;
            color: var(--text-secondary);
            text-decoration: line-through;
        }

        .discount {
            background: var(--success-color);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .product-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .stock-status {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stock-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success-color);
        }

        .stock-indicator.out-of-stock {
            background: var(--error-color);
        }

        .product-actions {
            display: flex;
            gap: 8px;
        }

        .add-to-cart-btn {
            flex: 1;
            height: 40px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .add-to-cart-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .add-to-cart-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .buy-now-btn {
            height: 40px;
            padding: 0 16px;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .buy-now-btn:hover {
            background: #ff4757;
            transform: translateY(-1px);
        }

        /* List View Product Card */
        .product-card.list-view {
            display: none;
            flex-direction: row;
            height: 150px;
            animation: none;
        }

        .product-card.list-view.active {
            display: flex;
        }

        .product-card.list-view .product-image-container {
            width: 150px;
            height: 100%;
            flex-shrink: 0;
        }

        .product-card.list-view .product-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* Loading and Empty States */
        .loading-state,
        .error-state,
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            background: var(--background-white);
            border-radius: var(--border-radius);
            margin: 20px 0;
        }

        .state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.6;
        }

        .state-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .state-message {
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .state-action {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .state-action:hover {
            background: var(--primary-dark);
        }

        /* Cart Sidebar */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: var(--background-white);
            box-shadow: var(--shadow-heavy);
            transition: var(--transition);
            z-index: 2000;
            display: flex;
            flex-direction: column;
        }

        .cart-sidebar.open {
            right: 0;
        }

        .cart-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--background-white);
        }

        .cart-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .close-cart-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            color: var(--text-secondary);
        }

        .close-cart-btn:hover {
            background: var(--background-light);
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        .cart-item {
            display: flex;
            gap: 12px;
            padding: 16px 20px;
            border-bottom: 1px solid #f1f1f1;
            transition: var(--transition);
        }

        .cart-item:hover {
            background: var(--background-light);
        }

        .cart-item-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: var(--border-radius);
            background: #f8f9fa;
        }

        .cart-item-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .cart-item-title {
            font-weight: 500;
            font-size: 14px;
            color: var(--text-primary);
            line-height: 1.4;
        }

        .cart-item-price {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 14px;
        }

        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .qty-btn {
            width: 24px;
            height: 24px;
            border: 1px solid var(--border-color);
            background: var(--background-white);
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 14px;
        }

        .qty-btn:hover {
            background: var(--background-light);
        }

        .qty-display {
            min-width: 32px;
            text-align: center;
            font-weight: 500;
            font-size: 14px;
        }

        .remove-item-btn {
            color: var(--error-color);
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: var(--transition);
            margin-left: auto;
        }

        .remove-item-btn:hover {
            background: rgba(255, 97, 97, 0.1);
        }

        .cart-footer {
            border-top: 1px solid var(--border-color);
            padding: 20px;
            background: var(--background-white);
        }

        .cart-summary {
            margin-bottom: 16px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .summary-row.total {
            font-weight: 600;
            font-size: 16px;
            color: var(--text-primary);
            border-top: 1px solid var(--border-color);
            padding-top: 8px;
            margin-top: 8px;
        }

        .cart-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .cart-btn {
            height: 44px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .cart-btn.primary {
            background: var(--primary-color);
            color: white;
        }

        .cart-btn.primary:hover {
            background: var(--primary-dark);
        }

        .cart-btn.secondary {
            background: var(--background-light);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .cart-btn.secondary:hover {
            background: #e8e8e8;
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1500;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .overlay.show {
            opacity: 1;
            visibility: visible;
        }

        /* Notification Toast */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 3000;
        }

        .toast {
            background: var(--background-white);
            padding: 16px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-heavy);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            animation: slideInRight 0.3s ease;
            border-left: 4px solid var(--success-color);
        }

        .toast.error {
            border-left-color: var(--error-color);
        }

        .toast.warning {
            border-left-color: var(--warning-color);
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast-icon {
            color: var(--success-color);
            font-size: 18px;
        }

        .toast.error .toast-icon {
            color: var(--error-color);
        }

        .toast.warning .toast-icon {
            color: var(--warning-color);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 2px;
            font-size: 14px;
        }

        .toast-message {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .toast-close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 4px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .toast-close:hover {
            background: var(--background-light);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav {
                padding: 0 16px;
                height: 56px;
                gap: 12px;
            }

            .logo {
                font-size: 20px;
            }

            .search-container {
                max-width: none;
            }

            .nav-actions {
                gap: 8px;
            }

            .nav-btn {
                padding: 6px 12px;
                font-size: 14px;
            }

            .banner-title {
                font-size: 32px;
            }

            .banner-subtitle {
                font-size: 16px;
            }

            .banner-stats {
                flex-direction: column;
                gap: 20px;
            }

            .container {
                padding: 0 16px;
            }

            .filters-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 16px;
            }

            .cart-sidebar {
                width: 100vw;
                right: -100vw;
            }

            .section-header {
                flex-direction: column;
                align-items: stretch;
                gap: 16px;
            }

            .product-card.list-view {
                flex-direction: column;
                height: auto;
            }

            .product-card.list-view .product-image-container {
                width: 100%;
                height: 200px;
            }

            .toast {
                min-width: calc(100vw - 40px);
                margin: 0 20px 12px;
            }
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --text-primary: #ffffff;
                --text-secondary: #b0b0b0;
                --background-light: #121212;
                --background-white: #1e1e1e;
                --border-color: #333333;
            }
        }

        /* Utility Classes */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .slide-up {
            animation: slideInUp 0.5s ease;
        }

        .hidden {
            display: none !important;
        }

        .loading {
            pointer-events: none;
            opacity: 0.6;
        }

        /* Skeleton Loading */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-card {
            background: var(--background-white);
            border-radius: var(--border-radius);
            padding: 16px;
            margin-bottom: 16px;
        }

        .skeleton-image {
            height: 200px;
            border-radius: var(--border-radius);
            margin-bottom: 12px;
        }

        .skeleton-text {
            height: 16px;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .skeleton-text.short {
            width: 60%;
        }

        .skeleton-text.medium {
            width: 80%;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>Loading QuickLocal</h3>
            <p>Setting up your premium shopping experience...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="header" id="header">
        <nav class="nav">
            <a href="#" class="logo">
                <i class="fas fa-shopping-bag"></i>
                QuickLocal
            </a>
            
            <div class="search-container">
                <div class="search-wrapper">
                    <input 
                        type="text" 
                        class="search-input" 
                        id="searchInput" 
                        placeholder="Search for products, brands and more..."
                        autocomplete="off"
                    >
                    <button class="search-btn" onclick="performSearch()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="search-suggestions" id="searchSuggestions"></div>
            </div>

            <div class="nav-actions">
                <a href="#" class="nav-btn" onclick="showLogin()">
                    <i class="fas fa-user"></i>
                    Login
                </a>
                <a href="#" class="nav-btn">
                    <i class="fas fa-heart"></i>
                    Wishlist
                </a>
                <button class="nav-btn cart-btn" onclick="toggleCart()">
                    <i class="fas fa-shopping-cart"></i>
                    Cart
                    <span class="cart-count" id="cartCount">0</span>
                </button>
            </div>
        </nav>
    </header>

    <!-- Banner Section -->
    <section class="banner-section">
        <div class="banner-content">
            <h1 class="banner-title">Welcome to QuickLocal</h1>
            <p class="banner-subtitle">Discover amazing products from local sellers with lightning-fast delivery</p>
            
            <div class="banner-stats">
                <div class="stat-item">
                    <span class="stat-number" id="totalProducts">1000+</span>
                    <span class="stat-label">Products</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">500+</span>
                    <span class="stat-label">Sellers</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">20 min</span>
                    <span class="stat-label">Delivery</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">24/7</span>
                    <span class="stat-label">Support</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Container -->
    <div class="container">
        <!-- Status Banner -->
        <div class="status-banner connecting" id="statusBanner">
            <i class="fas fa-satellite-dish status-icon"></i>
            <span>Connecting to QuickLocal servers...</span>
        </div>

        <!-- Filters Section -->
        <div class="filters-section">
            <div class="filters-header">
                <h2 class="filters-title">Find Your Perfect Product</h2>
                <a href="#" class="clear-filters" onclick="clearAllFilters()">Clear All</a>
            </div>
            <div class="filters-grid">
                <div class="filter-group">
                    <label class="filter-label">Category</label>
                    <select class="filter-select" id="categoryFilter">
                        <option value="">All Categories</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Price Range</label>
                    <select class="filter-select" id="priceFilter">
                        <option value="">All Prices</option>
                        <option value="0-1000">Under ₹1,000</option>
                        <option value="1000-5000">₹1,000 - ₹5,000</option>
                        <option value="5000-10000">₹5,000 - ₹10,000</option>
                        <option value="10000-50000">₹10,000 - ₹50,000</option>
                        <option value="50000-999999">Above ₹50,000</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Sort By</label>
                    <select class="filter-select" id="sortFilter">
                        <option value="relevance">Relevance</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                        <option value="rating">Customer Rating</option>
                        <option value="newest">Newest First</option>
                        <option value="popularity">Popularity</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Rating</label>
                    <select class="filter-select" id="ratingFilter">
                        <option value="">All Ratings</option>
                        <option value="4">4★ & above</option>
                        <option value="3">3★ & above</option>
                        <option value="2">2★ & above</option>
                    </select>
                </div>
                <button class="apply-filters-btn" onclick="applyFilters()">
                    <i class="fas fa-filter"></i>
                    Apply Filters
                </button>
            </div>
        </div>

        <!-- Products Section -->
        <div class="products-section">
            <div class="section-header">
                <h2 class="section-title">Products for You</h2>
                <div class="view-toggle">
                    <button class="view-btn active" onclick="toggleView('grid')">
                        <i class="fas fa-th-large"></i>
                    </button>
                    <button class="view-btn" onclick="toggleView('list')">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
            </div>

            <!-- Products Container -->
            <div id="productsContainer">
                <!-- Loading State -->
                <div class="loading-state">
                    <div class="state-icon">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                    <h3 class="state-title">Loading Products</h3>
                    <p class="state-message">Finding the best deals for you...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h3 class="cart-title">Shopping Cart</h3>
            <button class="close-cart-btn" onclick="toggleCart()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="cart-items" id="cartItems">
            <!-- Cart items will be populated here -->
        </div>
        
        <div class="cart-footer">
            <div class="cart-summary">
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span id="cartSubtotal">₹0.00</span>
                </div>
                <div class="summary-row">
                    <span>Delivery:</span>
                    <span id="deliveryFee">Free</span>
                </div>
                <div class="summary-row total">
                    <span>Total:</span>
                    <span id="cartTotal">₹0.00</span>
                </div>
            </div>
            <div class="cart-actions">
                <button class="cart-btn secondary" onclick="toggleCart()">
                    <i class="fas fa-arrow-left"></i>
                    Continue Shopping
                </button>
                <button class="cart-btn primary" onclick="proceedToCheckout()">
                    <i class="fas fa-credit-card"></i>
                    Proceed to Checkout
                </button>
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="closeOverlay()"></div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        console.log('[QuickLocal] 🚀 Premium QuickLocal Marketplace starting...');

        // Configuration
        const CONFIG = {
            API_BASE_URL: 'https://quicklocal-backend.onrender.com/api',
            PRODUCTS_ENDPOINT: '/products',
            DEFAULT_IMAGE: 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=400&h=300&fit=crop&q=80',
            DELIVERY_THRESHOLD: 500,
            FREE_DELIVERY_TEXT: 'Free',
            PAID_DELIVERY_FEE: 40
        };

        // Global State
        let state = {
            allProducts: [],
            filteredProducts: [],
            cart: JSON.parse(localStorage.getItem('quicklocal_cart')) || [],
            wishlist: JSON.parse(localStorage.getItem('quicklocal_wishlist')) || [],
            currentUser: JSON.parse(localStorage.getItem('quicklocal_user')) || null,
            viewMode: 'grid',
            isLoading: false,
            currentFilters: {
                category: '',
                priceRange: '',
                rating: '',
                sortBy: 'relevance'
            }
        };

        // Utility Functions
        const utils = {
            formatPrice: (price) => {
                return new Intl.NumberFormat('en-IN', {
                    style: 'currency',
                    currency: 'INR',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(price);
            },

            calculateDiscountedPrice: (originalPrice, discountPercentage) => {
                return originalPrice - (originalPrice * discountPercentage / 100);
            },

            generateStars: (rating) => {
                let stars = '';
                for (let i = 1; i <= 5; i++) {
                    if (i <= rating) {
                        stars += '<i class="fas fa-star star"></i>';
                    } else {
                        stars += '<i class="fas fa-star star empty"></i>';
                    }
                }
                return stars;
            },

            truncateText: (text, maxLength) => {
                if (text.length <= maxLength) return text;
                return text.substr(0, maxLength) + '...';
            },

            debounce: (func, wait) => {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            showToast: (title, message, type = 'success') => {
                const toastContainer = document.getElementById('toastContainer');
                const toastId = 'toast-' + Date.now();
                
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.id = toastId;
                toast.innerHTML = `
                    <div class="toast-icon">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    </div>
                    <div class="toast-content">
                        <div class="toast-title">${title}</div>
                        <div class="toast-message">${message}</div>
                    </div>
                    <button class="toast-close" onclick="removeToast('${toastId}')">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                toastContainer.appendChild(toast);
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    removeToast(toastId);
                }, 5000);
            }
        };

        // Toast Management
        function removeToast(toastId) {
            const toast = document.getElementById(toastId);
            if (toast) {
                toast.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }
        }

        // Image Error Handler
        function handleImageError(img) {
            if (!img.dataset.fallbackAttempted) {
                img.dataset.fallbackAttempted = 'true';
                img.src = CONFIG.DEFAULT_IMAGE;
            } else {
                // If fallback also fails, hide image and show placeholder
                img.style.display = 'none';
                const placeholder = document.createElement('div');
                placeholder.style.cssText = `
                    width: 100%; 
                    height: 200px; 
                    background: #f8f9fa; 
                    display: flex; 
                    align-items: center; 
                    justify-content: center; 
                    color: #6c757d; 
                    font-size: 14px;
                    border-radius: 8px;
                `;
                placeholder.innerHTML = '<i class="fas fa-image" style="font-size: 24px; opacity: 0.5;"></i>';
                img.parentNode.appendChild(placeholder);
            }
        }

        // API Functions
        const api = {
            async fetchProducts() {
                try {
                    updateStatusBanner('connecting', 'Fetching latest products...');
                    
                    const response = await fetch(`${CONFIG.API_BASE_URL}${CONFIG.PRODUCTS_ENDPOINT}`);
                    const data = await response.json();
                    
                    if (response.ok && data.success) {
                        let products = data.data.products || [];
                        
                        // Normalize product data
                        products = products.map(product => ({
                            ...product,
                            category: typeof product.category === 'object' ? product.category.name : product.category,
                            rating: product.rating || Math.floor(Math.random() * 2) + 4, // Mock rating 4-5
                            reviews: product.reviews || Math.floor(Math.random() * 1000) + 100, // Mock reviews
                            seller: product.seller || 'QuickLocal Seller',
                            deliveryTime: product.deliveryTime || Math.floor(Math.random() * 5) + 1
                        }));
                        
                        state.allProducts = products;
                        updateStatusBanner('connected', `✅ Loaded ${products.length} products successfully!`);
                        
                        // Update banner stats
                        document.getElementById('totalProducts').textContent = `${products.length}+`;
                        
                        setTimeout(() => {
                            hideStatusBanner();
                        }, 3000);
                        
                        return products;
                    } else {
                        throw new Error(data.message || 'Failed to fetch products');
                    }
                } catch (error) {
                    console.error('[QuickLocal] ❌ Error fetching products:', error);
                    updateStatusBanner('error', '❌ Failed to load products. Using demo data...');
                    
                    // Load demo products as fallback
                    return this.loadDemoProducts();
                }
            },

            loadDemoProducts() {
                const demoProducts = [
                    {
                        id: 'demo-1',
                        name: 'Premium Wireless Headphones',
                        description: 'High-quality wireless headphones with noise cancellation and premium sound quality. Perfect for music lovers and professionals.',
                        price: 12999,
                        discountPercentage: 25,
                        finalPrice: 9749,
                        category: 'Electronics',
                        stock: 50,
                        images: [
                            { url: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400&h=300&fit=crop&q=80', alt: 'Wireless Headphones' }
                        ],
                        isInStock: true,
                        isOnSale: true,
                        rating: 4.5,
                        reviews: 1247,
                        seller: 'Tech Store Pro',
                        deliveryTime: 1
                    },
                    {
                        id: 'demo-2',
                        name: 'Smart Fitness Watch',
                        description: 'Advanced fitness tracking with heart rate monitoring, GPS, and smart notifications. Your perfect workout companion.',
                        price: 15999,
                        discountPercentage: 20,
                        finalPrice: 12799,
                        category: 'Electronics',
                        stock: 30,
                        images: [
                            { url: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400&h=300&fit=crop&q=80', alt: 'Smart Watch' }
                        ],
                        isInStock: true,
                        isOnSale: true,
                        rating: 4.3,
                        reviews: 892,
                        seller: 'Fitness Gear Co',
                        deliveryTime: 2
                    },
                    {
                        id: 'demo-3',
                        name: 'Organic Cotton T-Shirt',
                        description: 'Comfortable and sustainable organic cotton t-shirt in various colors. Perfect for everyday wear with eco-friendly materials.',
                        price: 899,
                        discountPercentage: 30,
                        finalPrice: 629,
                        category: 'Clothing',
                        stock: 100,
                        images: [
                            { url: 'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=400&h=300&fit=crop&q=80', alt: 'Cotton T-Shirt' }
                        ],
                        isInStock: true,
                        isOnSale: true,
                        rating: 4.2,
                        reviews: 456,
                        seller: 'EcoWear',
                        deliveryTime: 3
                    },
                    {
                        id: 'demo-4',
                        name: 'Premium Running Shoes',
                        description: 'Professional running shoes with advanced cushioning and breathable design. Perfect for athletes and fitness enthusiasts.',
                        price: 8999,
                        discountPercentage: 35,
                        finalPrice: 5849,
                        category: 'Sports',
                        stock: 25,
                        images: [
                            { url: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400&h=300&fit=crop&q=80', alt: 'Running Shoes' }
                        ],
                        isInStock: true,
                        isOnSale: true,
                        rating: 4.7,
                        reviews: 2341,
                        seller: 'Sports Zone',
                        deliveryTime: 2
                    },
                    {
                        id: 'demo-5',
                        name: 'Artisan Coffee Beans',
                        description: 'Premium roasted coffee beans sourced directly from local farmers. Rich aroma and perfect balance of flavor.',
                        price: 1299,
                        discountPercentage: 15,
                        finalPrice: 1104,
                        category: 'Food',
                        stock: 200,
                        images: [
                            { url: 'https://images.unsplash.com/photo-1447933601403-0c6688de566e?w=400&h=300&fit=crop&q=80', alt: 'Coffee Beans' }
                        ],
                        isInStock: true,
                        isOnSale: true,
                        rating: 4.6,
                        reviews: 789,
                        seller: 'Local Roasters',
                        deliveryTime: 1
                    }
                ];

                state.allProducts = demoProducts;
                utils.showToast('Demo Mode', 'Using demo products for preview', 'warning');
                return demoProducts;
            }
        };

        // Status Banner Functions
        function updateStatusBanner(type, message) {
            const banner = document.getElementById('statusBanner');
            const icons = {
                'connecting': 'fa-satellite-dish',
                'connected': 'fa-check-circle',
                'error': 'fa-exclamation-triangle'
            };
            
            banner.className = `status-banner ${type}`;
            banner.innerHTML = `
                <i class="fas ${icons[type]} status-icon"></i>
                <span>${message}</span>
            `;
            banner.style.display = 'flex';
        }

        function hideStatusBanner() {
            const banner = document.getElementById('statusBanner');
            banner.style.animation = 'slideUp 0.5s ease';
            setTimeout(() => {
                banner.style.display = 'none';
            }, 500);
        }

        // Product Display Functions
        function displayProducts(products) {
            const container = document.getElementById('productsContainer');
            
            if (products.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="state-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h3 class="state-title">No Products Found</h3>
                        <p class="state-message">Try adjusting your search criteria or browse our categories</p>
                        <button class="state-action" onclick="clearAllFilters()">Clear All Filters</button>
                    </div>
                `;
                return;
            }

            const gridClass = state.viewMode === 'list' ? 'products-list active' : 'products-grid';
            const productsHTML = products.map(product => createProductCard(product)).join('');
            
            container.innerHTML = `<div class="${gridClass}">${productsHTML}</div>`;
            
            // Add staggered animation
            const cards = container.querySelectorAll('.product-card');
            cards.forEach((card, index) => {
                card.style.animationDelay = `${index * 0.1}s`;
            });

            console.log(`[QuickLocal] 🎨 Displayed ${products.length} products`);
        }

        function createProductCard(product) {
            const hasValidImages = product.images && product.images.length > 0 && product.images[0].url;
            const imageUrl = hasValidImages ? product.images[0].url : CONFIG.DEFAULT_IMAGE;
            const imageAlt = hasValidImages ? product.images[0].alt : product.name;
            const finalPrice = product.finalPrice || utils.calculateDiscountedPrice(product.price, product.discountPercentage || 0);
            const isInWishlist = state.wishlist.some(item => item.id === product.id);

            return `
                <div class="product-card ${state.viewMode === 'list' ? 'list-view active' : ''}" onclick="viewProduct('${product.id}')">
                    <div class="product-image-container">
                        ${product.isOnSale ? `<div class="product-badge">${product.discountPercentage}% OFF</div>` : ''}
                        <button class="product-wishlist ${isInWishlist ? 'active' : ''}" onclick="event.stopPropagation(); toggleWishlist('${product.id}')">
                            <i class="fas fa-heart"></i>
                        </button>
                        <img 
                            src="${imageUrl}" 
                            alt="${imageAlt}" 
                            class="product-image"
                            onerror="handleImageError(this)"
                            loading="lazy"
                        >
                    </div>
                    <div class="product-content">
                        <h3 class="product-title">${product.name}</h3>
                        <p class="product-description">${utils.truncateText(product.description || 'No description available', 100)}</p>
                        
                        <div class="product-rating">
                            <div class="rating-stars">
                                ${utils.generateStars(product.rating || 4)}
                            </div>
                            <span class="rating-text">(${product.reviews || 0})</span>
                        </div>

                        <div class="product-price">
                            <span class="current-price">${utils.formatPrice(finalPrice)}</span>
                            ${product.isOnSale ? `
                                <span class="original-price">${utils.formatPrice(product.price)}</span>
                                <span class="discount">${product.discountPercentage}% OFF</span>
                            ` : ''}
                        </div>

                        <div class="product-meta">
                            <div class="stock-status">
                                <div class="stock-indicator ${product.isInStock ? '' : 'out-of-stock'}"></div>
                                <span>${product.isInStock ? `${product.stock} in stock` : 'Out of stock'}</span>
                            </div>
                            <div class="delivery-info">
                                <i class="fas fa-shipping-fast"></i>
                                <span>${product.deliveryTime || 2} day delivery</span>
                            </div>
                        </div>

                        <div class="product-actions">
                            <button 
                                class="add-to-cart-btn" 
                                onclick="event.stopPropagation(); addToCart('${product.id}')"
                                ${!product.isInStock ? 'disabled' : ''}
                            >
                                <i class="fas fa-shopping-cart"></i>
                                ${product.isInStock ? 'Add to Cart' : 'Out of Stock'}
                            </button>
                            ${product.isInStock ? `
                                <button class="buy-now-btn" onclick="event.stopPropagation(); buyNow('${product.id}')">
                                    Buy Now
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // Filter Functions
        function populateFilters() {
            const categories = [...new Set(state.allProducts.map(p => p.category))].sort();
            const categoryFilter = document.getElementById('categoryFilter');
            
            categoryFilter.innerHTML = '<option value="">All Categories</option>';
            categories.forEach(category => {
                categoryFilter.innerHTML += `<option value="${category}">${category}</option>`;
            });
            
            console.log(`[QuickLocal] 📂 Loaded ${categories.length} categories:`, categories.join(', '));
        }

        function applyFilters() {
            let filtered = [...state.allProducts];
            
            // Category filter
            const categoryFilter = document.getElementById('categoryFilter').value;
            if (categoryFilter) {
                filtered = filtered.filter(p => p.category === categoryFilter);
                state.currentFilters.category = categoryFilter;
            }
            
            // Price filter
            const priceFilter = document.getElementById('priceFilter').value;
            if (priceFilter) {
                const [min, max] = priceFilter.split('-').map(Number);
                filtered = filtered.filter(p => {
                    const price = p.finalPrice || p.price;
                    return price >= min && price <= max;
                });
                state.currentFilters.priceRange = priceFilter;
            }
            
            // Rating filter
            const ratingFilter = document.getElementById('ratingFilter').value;
            if (ratingFilter) {
                const minRating = parseFloat(ratingFilter);
                filtered = filtered.filter(p => (p.rating || 4) >= minRating);
                state.currentFilters.rating = ratingFilter;
            }
            
            // Sort
            const sortFilter = document.getElementById('sortFilter').value;
            switch(sortFilter) {
                case 'price-low':
                    filtered.sort((a, b) => (a.finalPrice || a.price) - (b.finalPrice || b.price));
                    break;
                case 'price-high':
                    filtered.sort((a, b) => (b.finalPrice || b.price) - (a.finalPrice || a.price));
                    break;
                case 'rating':
                    filtered.sort((a, b) => (b.rating || 4) - (a.rating || 4));
                    break;
                case 'popularity':
                    filtered.sort((a, b) => (b.reviews || 0) - (a.reviews || 0));
                    break;
                case 'newest':
                    filtered.reverse(); // Assume newer products are at the end
                    break;
            }
            
            state.currentFilters.sortBy = sortFilter;
            state.filteredProducts = filtered;
            displayProducts(filtered);
            
            console.log(`[QuickLocal] 🎯 Applied filters: ${JSON.stringify(state.currentFilters)} (${filtered.length} products)`);
        }

        function clearAllFilters() {
            document.getElementById('categoryFilter').value = '';
            document.getElementById('priceFilter').value = '';
            document.getElementById('ratingFilter').value = '';
            document.getElementById('sortFilter').value = 'relevance';
            
            state.currentFilters = {
                category: '',
                priceRange: '',
                rating: '',
                sortBy: 'relevance'
            };
            
            state.filteredProducts = state.allProducts;
            displayProducts(state.allProducts);
            
            utils.showToast('Filters Cleared', 'All filters have been reset');
        }

        // Search Functions
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchSuggestions = document.getElementById('searchSuggestions');
            
            const debouncedSearch = utils.debounce((query) => {
                if (query.length >= 2) {
                    showSearchSuggestions(query);
                } else {
                    hideSearchSuggestions();
                }
            }, 300);
            
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase().trim();
                debouncedSearch(query);
                
                if (query === '') {
                    displayProducts(state.filteredProducts);
                } else {
                    performSearch(query);
                }
            });
            
            searchInput.addEventListener('focus', () => {
                if (searchInput.value.length >= 2) {
                    showSearchSuggestions(searchInput.value);
                }
            });
            
            document.addEventListener('click', (e) => {
                if (!searchInput.contains(e.target) && !searchSuggestions.contains(e.target)) {
                    hideSearchSuggestions();
                }
            });
        }

        function showSearchSuggestions(query) {
            const suggestions = state.allProducts
                .filter(product => 
                    product.name.toLowerCase().includes(query.toLowerCase()) ||
                    product.category.toLowerCase().includes(query.toLowerCase())
                )
                .slice(0, 5);
            
            const suggestionsContainer = document.getElementById('searchSuggestions');
            
            if (suggestions.length > 0) {
                suggestionsContainer.innerHTML = suggestions.map(product => `
                    <div class="suggestion-item" onclick="selectSuggestion('${product.name}')">
                        <i class="fas fa-search"></i>
                        <span>${product.name}</span>
                        <small>${product.category}</small>
                    </div>
                `).join('');
                suggestionsContainer.classList.add('show');
            } else {
                hideSearchSuggestions();
            }
        }

        function hideSearchSuggestions() {
            const suggestionsContainer = document.getElementById('searchSuggestions');
            suggestionsContainer.classList.remove('show');
        }

        function selectSuggestion(productName) {
            document.getElementById('searchInput').value = productName;
            hideSearchSuggestions();
            performSearch(productName);
        }

        function performSearch(query = null) {
            const searchQuery = query || document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (!searchQuery) {
                displayProducts(state.filteredProducts);
                return;
            }
            
            const searchResults = state.filteredProducts.filter(product => 
                product.name.toLowerCase().includes(searchQuery) ||
                product.description.toLowerCase().includes(searchQuery) ||
                product.category.toLowerCase().includes(searchQuery) ||
                (product.seller && product.seller.toLowerCase().includes(searchQuery))
            );
            
            displayProducts(searchResults);
            console.log(`[QuickLocal] 🔍 Search for "${searchQuery}": ${searchResults.length} results`);
        }

        // View Toggle Functions
        function toggleView(mode) {
            state.viewMode = mode;
            
            // Update view buttons
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.view-btn').classList.add('active');
            
            // Re-render products with new view
            displayProducts(state.filteredProducts);
        }

        // Cart Functions
        function addToCart(productId) {
            const product = state.allProducts.find(p => p.id === productId);
            if (!product || !product.isInStock) return;
            
            const existingItem = state.cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += 1;
                utils.showToast('Updated Cart', `Increased quantity of ${product.name}`);
            } else {
                state.cart.push({
                    ...product,
                    quantity: 1
                });
                utils.showToast('Added to Cart', `${product.name} has been added to your cart`);
            }
            
            localStorage.setItem('quicklocal_cart', JSON.stringify(state.cart));
            updateCartDisplay();
            
            // Visual feedback on button
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> Added!';
            btn.style.background = 'var(--success-color)';
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.background = '';
            }, 2000);
        }

        function buyNow(productId) {
            addToCart(productId);
            setTimeout(() => {
                toggleCart();
                utils.showToast('Quick Buy', 'Product added to cart. Proceed to checkout!', 'success');
            }, 500);
        }

        function removeFromCart(productId) {
            const product = state.cart.find(item => item.id === productId);
            state.cart = state.cart.filter(item => item.id !== productId);
            localStorage.setItem('quicklocal_cart', JSON.stringify(state.cart));
            updateCartDisplay();
            
            if (product) {
                utils.showToast('Removed from Cart', `${product.name} has been removed from your cart`);
            }
        }

        function updateQuantity(productId, change) {
            const item = state.cart.find(item => item.id === productId);
            if (!item) return;
            
            item.quantity += change;
            
            if (item.quantity <= 0) {
                removeFromCart(productId);
                return;
            }
            
            localStorage.setItem('quicklocal_cart', JSON.stringify(state.cart));
            updateCartDisplay();
        }

        function updateCartDisplay() {
            const cartCount = document.getElementById('cartCount');
            const cartItems = document.getElementById('cartItems');
            const cartSubtotal = document.getElementById('cartSubtotal');
            const cartTotal = document.getElementById('cartTotal');
            const deliveryFee = document.getElementById('deliveryFee');
            
            const totalItems = state.cart.reduce((sum, item) => sum + item.quantity, 0);
            const subtotal = state.cart.reduce((sum, item) => sum + (item.finalPrice || item.price) * item.quantity, 0);
            
            // Calculate delivery fee
            const deliveryFeeAmount = subtotal >= CONFIG.DELIVERY_THRESHOLD ? 0 : CONFIG.PAID_DELIVERY_FEE;
            const total = subtotal + deliveryFeeAmount;
            
            cartCount.textContent = totalItems;
            cartSubtotal.textContent = utils.formatPrice(subtotal);
            deliveryFee.textContent = deliveryFeeAmount === 0 ? CONFIG.FREE_DELIVERY_TEXT : utils.formatPrice(deliveryFeeAmount);
            cartTotal.textContent = utils.formatPrice(total);
            
            if (state.cart.length === 0) {
                cartItems.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-shopping-cart" style="font-size: 48px; opacity: 0.3; margin-bottom: 16px; display: block;"></i>
                        <h3>Your cart is empty</h3>
                        <p>Start shopping to add items to your cart</p>
                    </div>
                `;
                return;
            }
            
            cartItems.innerHTML = state.cart.map(item => {
                const imageUrl = (item.images && item.images[0]) ? item.images[0].url : CONFIG.DEFAULT_IMAGE;
                
                return `
                    <div class="cart-item">
                        <img src="${imageUrl}" alt="${item.name}" class="cart-item-image" onerror="handleImageError(this)">
                        <div class="cart-item-details">
                            <div class="cart-item-title">${utils.truncateText(item.name, 40)}</div>
                            <div class="cart-item-price">${utils.formatPrice(item.finalPrice || item.price)}</div>
                            <div class="cart-item-actions">
                                <button class="qty-btn" onclick="updateQuantity('${item.id}', -1)">−</button>
                                <span class="qty-display">${item.quantity}</span>
                                <button class="qty-btn" onclick="updateQuantity('${item.id}', 1)">+</button>
                                <button class="remove-item-btn" onclick="removeFromCart('${item.id}')" title="Remove item">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function toggleCart() {
            const cartSidebar = document.getElementById('cartSidebar');
            const overlay = document.getElementById('overlay');
            
            cartSidebar.classList.toggle('open');
            overlay.classList.toggle('show');
        }

        function closeOverlay() {
            const cartSidebar = document.getElementById('cartSidebar');
            const overlay = document.getElementById('overlay');
            
            cartSidebar.classList.remove('open');
            overlay.classList.remove('show');
        }

        function proceedToCheckout() {
            if (state.cart.length === 0) {
                utils.showToast('Empty Cart', 'Please add items to your cart first', 'warning');
                return;
            }
            
            utils.showToast('Checkout', 'Redirecting to secure checkout...', 'success');
            
            // Simulated checkout process
            setTimeout(() => {
                alert('🎉 Order placed successfully! You will receive a confirmation email shortly.');
                
                // Clear cart after successful order
                state.cart = [];
                localStorage.setItem('quicklocal_cart', JSON.stringify(state.cart));
                updateCartDisplay();
                toggleCart();
            }, 2000);
        }

        // Wishlist Functions
        function toggleWishlist(productId) {
            const product = state.allProducts.find(p => p.id === productId);
            if (!product) return;
            
            const existingIndex = state.wishlist.findIndex(item => item.id === productId);
            
            if (existingIndex > -1) {
                state.wishlist.splice(existingIndex, 1);
                utils.showToast('Removed from Wishlist', `${product.name} removed from wishlist`);
            } else {
                state.wishlist.push(product);
                utils.showToast('Added to Wishlist', `${product.name} added to wishlist`);
            }
            
            localStorage.setItem('quicklocal_wishlist', JSON.stringify(state.wishlist));
            
            // Update wishlist icon in the product card
            const wishlistBtn = event.target.closest('.product-wishlist');
            if (wishlistBtn) {
                wishlistBtn.classList.toggle('active');
            }
        }

        // Product View Function
        function viewProduct(productId) {
            const product = state.allProducts.find(p => p.id === productId);
            if (!product) return;
            
            utils.showToast('Product View', `Opening ${product.name} details...`, 'success');
            
            // This would typically open a product detail modal or navigate to product page
            console.log('[QuickLocal] 👁️ Viewing product:', product);
        }

        // Authentication Functions
        function showLogin() {
            utils.showToast('Login', 'Login functionality coming soon!', 'info');
        }

        // Header Scroll Effect
        function setupHeaderScrollEffect() {
            const header = document.getElementById('header');
            let lastScrollY = window.scrollY;
            
            window.addEventListener('scroll', () => {
                const currentScrollY = window.scrollY;
                
                if (currentScrollY > 100) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
                
                lastScrollY = currentScrollY;
            });
        }

        // URL Parameters Handler
        function handleURLParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const category = urlParams.get('category');
            
            if (category) {
                setTimeout(() => {
                    const categoryFilter = document.getElementById('categoryFilter');
                    const options = Array.from(categoryFilter.options);
                    const matchingOption = options.find(option => 
                        option.value.toLowerCase() === category.toLowerCase()
                    );
                    
                    if (matchingOption) {
                        categoryFilter.value = matchingOption.value;
                        applyFilters();
                        console.log(`[QuickLocal] 🎯 Applied URL category filter: ${matchingOption.value}`);
                    }
                }, 1000);
            }
        }

        // Event Listeners Setup
        function setupEventListeners() {
            // Filter change listeners
            document.getElementById('categoryFilter').addEventListener('change', applyFilters);
            document.getElementById('priceFilter').addEventListener('change', applyFilters);
            document.getElementById('ratingFilter').addEventListener('change', applyFilters);
            document.getElementById('sortFilter').addEventListener('change', applyFilters);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Escape key to close overlays
                if (e.key === 'Escape') {
                    closeOverlay();
                }
                
                // Ctrl/Cmd + K to focus search
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    document.getElementById('searchInput').focus();
                }
            });
            
            // Window resize handler for responsive adjustments
            window.addEventListener('resize', utils.debounce(() => {
                // Handle responsive adjustments if needed
                console.log('[QuickLocal] 📱 Window resized');
            }, 250));
        }

        // Loading Screen Handler
        function hideLoadingScreen() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            setTimeout(() => {
                loadingOverlay.classList.add('hide');
                setTimeout(() => {
                    loadingOverlay.remove();
                }, 500);
            }, 1500); // Show loading for at least 1.5 seconds for smooth UX
        }

        // Main Initialization Function
        async function initializeApp() {
            console.log('[QuickLocal] 🎯 Initializing Premium QuickLocal Marketplace...');
            
            try {
                // Setup event listeners
                setupEventListeners();
                setupHeaderScrollEffect();
                setupSearch();
                
                // Load products
                await api.fetchProducts();
                
                // Initialize displays
                state.filteredProducts = state.allProducts;
                populateFilters();
                applyFilters();
                updateCartDisplay();
                
                // Handle URL parameters
                handleURLParameters();
                
                // Hide loading screen
                hideLoadingScreen();
                
                console.log('[QuickLocal] ✅ App initialized successfully!');
                utils.showToast('Welcome!', 'QuickLocal marketplace is ready for shopping', 'success');
                
            } catch (error) {
                console.error('[QuickLocal] ❌ Initialization error:', error);
                utils.showToast('Error', 'Failed to initialize marketplace', 'error');
                hideLoadingScreen();
            }
        }

        // Start the application when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }

        // Service Worker Registration (for PWA capabilities)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('[QuickLocal] 🔧 SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('[QuickLocal] 🔧 SW registration failed: ', registrationError);
                    });
            });
        }

        // Export functions for global access (for inline onclick handlers)
        window.QuickLocal = {
            addToCart,
            buyNow,
            removeFromCart,
            updateQuantity,
            toggleCart,
            toggleWishlist,
            viewProduct,
            performSearch,
            selectSuggestion,
            applyFilters,
            clearAllFilters,
            toggleView,
            showLogin,
            proceedToCheckout,
            closeOverlay,
            handleImageError,
            removeToast
        };

    </script>
</body>
</html>
// Add this function to your marketplace.html
function viewProduct(productId) {
    // Store product data for detail page
    const product = state.allProducts.find(p => p.id === productId);
    localStorage.setItem('current_product', JSON.stringify(product));
    
    // Redirect to product detail page
    window.location.href = `product-detail.html?id=${productId}`;
}

// Update your product card HTML to include click handler
function createProductCard(product) {
    return `
        <div class="product-card" onclick="viewProduct('${product.id}')">
            <!-- Your existing product card content -->
            <div class="product-image-container">
                <img src="${product.images?.[0]?.url || 'default.jpg'}" alt="${product.name}" class="product-image">
            </div>
            <div class="product-content">
                <h3 class="product-title">${product.name}</h3>
                <div class="product-price">₹${product.finalPrice || product.price}</div>
                <!-- Your existing content -->
            </div>
        </div>
    `;
}
// Add this function to your marketplace.html
function viewProduct(productId) {
    const product = state.allProducts.find(p => p.id === productId);
    if (product) {
        // Store product data for the detail page
        localStorage.setItem('current_product', JSON.stringify(product));
        // Redirect to product detail page
        window.location.href = `product-detail.html?id=${productId}`;
    }
}

// Update your product card creation to include click handler
function createProductCard(product) {
    return `
        <div class="product-card" onclick="viewProduct('${product.id}')" style="cursor: pointer;">
            <!-- Your existing product card HTML -->
        </div>
    `;
}

