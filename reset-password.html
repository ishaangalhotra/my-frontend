<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Reset Password • QuickLocal</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { --bg:#0b0b12; --card:#151524; --text:#e8e8f0; --muted:#9aa0b4; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);
    font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    .wrap{min-height:100vh;display:grid;place-items:center;padding:24px}
    .card{width:100%;max-width:440px;background:var(--card);border:1px solid #26263a;border-radius:16px;padding:28px}
    h1{margin:0 0 8px;font-size:22px} p{margin:0 0 18px;color:var(--muted)}
    input{width:100%;padding:12px;border-radius:10px;border:1px solid #2a2a3f;background:#111123;color:#e8e8f0;margin:8px 0}
    .btn{width:100%;padding:12px;border-radius:10px;background:#6366f1;color:#fff;border:0;cursor:pointer;margin-top:8px}
    .status{padding:12px;border-radius:10px;background:#1c1c2e;margin:12px 0}
    .ok{background:#15271a;border:1px solid #254a2f}
    .err{background:#2a1a1d;border:1px solid #5a3238}
    small{display:block;margin-top:10px;color:#7c8197}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Set a new password</h1>
      <p>Enter and confirm your new password.</p>
      <div id="status" class="status" style="display:none"></div>
      <input id="pw" type="password" placeholder="New password" />
      <input id="cpw" type="password" placeholder="Confirm new password" />
      <button id="submit" class="btn">Reset Password</button>
      <small id="detail"></small>
    </div>
  </div>

  <script>
    (function(){
      const API = 'https://quicklocal-backend.onrender.com/api/v1/auth';

      const segments = location.pathname.split('/').filter(Boolean);
      const token = segments[segments.length - 1]; // /reset-password/:token
      const statusEl = document.getElementById('status');
      const detailEl = document.getElementById('detail');

      function setStatus(msg, ok){
        statusEl.style.display = 'block';
        statusEl.className = 'status ' + (ok ? 'ok' : 'err');
        statusEl.textContent = msg;
      }

      document.getElementById('submit').onclick = async () => {
        const password = document.getElementById('pw').value;
        const confirmPassword = document.getElementById('cpw').value;

        if (!password || !confirmPassword) return setStatus('Please enter both fields.', false);
        try {
          const res = await fetch(`${API}/reset-password/${encodeURIComponent(token)}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', Accept: 'application/json' },
            credentials: 'include',
            body: JSON.stringify({ password, confirmPassword })
          });
          const data = await res.json().catch(() => ({}));
          if (!res.ok) throw new Error(data.message || (data.errors && data.errors[0]?.msg) || 'Reset failed');

          setStatus('✅ Password reset successful!', true);
          detailEl.textContent = 'Redirecting to Seller Dashboard...';
          setTimeout(() => location.href = '/seller-dashboard.html', 1500);
        } catch (err) {
          setStatus('❌ ' + (err.message || 'Reset failed'), false);
          detailEl.textContent = 'The token may be invalid or expired. Request a new reset link.';
        }
      };
    })();
  </script>
</body>
</html>
