<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>QuickLocal — Seller Dashboard (Merged)</title>
  <!-- Icons & libs -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* ===== CUSTOM TAILWIND-LIKE CSS (union of all three files, deduped) ===== */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; line-height: 1.5; color: #374151; }

    /* Sizing */
    .min-h-screen{min-height:100vh}.h-screen{height:100vh}.h-4{height:1rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-8{height:2rem}.h-10{height:2.5rem}.h-12{height:3rem}.h-16{height:4rem}.h-20{height:5rem}.h-48{height:12rem}
    .w-5{width:1.25rem}.w-6{width:1.5rem}.w-8{width:2rem}.w-10{width:2.5rem}.w-12{width:3rem}.w-16{width:4rem}.w-64{width:16rem}.w-full{width:100%}.w-auto{width:auto}

    /* Layout */
    .flex{display:flex}.inline-flex{display:inline-flex}.grid{display:grid}.hidden{display:none}
    .flex-col{flex-direction:column}.flex-row{flex-direction:row}.flex-wrap{flex-wrap:wrap}
    .flex-1{flex:1 1 0%}.flex-shrink-0{flex-shrink:0}
    .items-center{align-items:center}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-stretch{align-items:stretch}
    .justify-between{justify-content:space-between}.justify-center{justify-content:center}.justify-end{justify-content:flex-end}.justify-start{justify-content:flex-start}

    /* Overflow & position */
    .overflow-hidden{overflow:hidden}.overflow-auto{overflow:auto}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}
    .relative{position:relative}.absolute{position:absolute}.fixed{position:fixed}.sticky{position:sticky}.inset-0{top:0;right:0;bottom:0;left:0}

    /* Spacing */
    .p-1{padding:.25rem}.p-2{padding:.5rem}.p-3{padding:.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-6{padding:1.5rem}.p-8{padding:2rem}
    .px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}
    .py-1{padding-top:.25rem;padding-bottom:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}
    .pt-4{padding-top:1rem}.pt-6{padding-top:1.5rem}
    .pb-4{padding-bottom:1rem}.pb-6{padding-bottom:1.5rem}
    .pl-3{padding-left:.75rem}.pl-10{padding-left:2.5rem}
    .pr-4{padding-right:1rem}

    .m-4{margin:1rem}
    .mx-auto{margin-left:auto;margin-right:auto}
    .my-1{margin-top:.25rem;margin-bottom:.25rem}.my-4{margin-top:1rem;margin-bottom:1rem}.my-6{margin-top:1.5rem;margin-bottom:1.5rem}
    .mb-1{margin-bottom:.25rem}.mb-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}
    .mt-1{margin-top:.25rem}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}
    .mr-1{margin-right:.25rem}.mr-2{margin-right:.5rem}.mr-3{margin-right:.75rem}.mr-4{margin-right:1rem}
    .ml-2{margin-left:.5rem}.ml-3{margin-left:.75rem}.ml-4{margin-left:1rem}.ml-auto{margin-left:auto}

    .gap-1{gap:.25rem}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}
    .space-y-1>*+*{margin-top:.25rem}.space-y-2>*+*{margin-top:.5rem}.space-y-3>*+*{margin-top:.75rem}.space-y-4>*+*{margin-top:1rem}.space-y-6>*+*{margin-top:1.5rem}

    /* Colors */
    .bg-white{background:#fff}.bg-gray-50{background:#f9fafb}.bg-gray-100{background:#f3f4f6}.bg-gray-200{background:#e5e7eb}.bg-gray-300{background:#d1d5db}.bg-gray-700{background:#374151}.bg-gray-800{background:#1f2937}.bg-gray-900{background:#111827}
    .bg-purple-50{background:#faf5ff}.bg-purple-100{background:#f3e8ff}.bg-purple-500{background:#a855f7}.bg-purple-600{background:#9333ea}.bg-purple-700{background:#7e22ce}.bg-purple-800{background:#6b21a8}
    .bg-blue-100{background:#dbeafe}.bg-blue-600{background:#2563eb}
    .bg-green-100{background:#dcfce7}.bg-green-600{background:#16a34a}
    .bg-amber-100{background:#fef3c7}.bg-amber-600{background:#d97706}
    .bg-red-50{background:#fef2f2}.bg-red-100{background:#fee2e2}.bg-red-500{background:#ef4444}.bg-red-600{background:#dc2626}
    .bg-slate-100{background:#f1f5f9}
    .bg-indigo-50{background:#eef2ff}

    .text-white{color:#fff}.text-gray-400{color:#9ca3af}.text-gray-500{color:#6b7280}.text-gray-600{color:#4b5563}.text-gray-700{color:#374151}.text-gray-800{color:#1f2937}.text-gray-900{color:#111827}
    .text-purple-600{color:#9333ea}.text-blue-600{color:#2563eb}.text-green-600{color:#16a34a}.text-amber-600{color:#d97706}.text-red-500{color:#ef4444}.text-red-600{color:#dc2626}.text-red-700{color:#b91c1c}.text-red-800{color:#991b1b}

    .text-xs{font-size:.75rem;line-height:1rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}
    .font-medium{font-weight:500}.font-semibold{font-weight:600}.font-bold{font-weight:700}

    .rounded{border-radius:.25rem}.rounded-md{border-radius:.375rem}.rounded-lg{border-radius:.5rem}.rounded-xl{border-radius:.75rem}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}
    .rounded-l-lg{border-top-left-radius:.5rem;border-bottom-left-radius:.5rem}.rounded-r-lg{border-top-right-radius:.5rem;border-bottom-right-radius:.5rem}

    .border{border-width:1px;border-style:solid}.border-0{border-width:0}.border-2{border-width:2px}
    .border-gray-100{border-color:#f3f4f6}.border-gray-200{border-color:#e5e7eb}.border-gray-300{border-color:#d1d5db}.border-purple-100{border-color:#f3e8ff}
    .border-t{border-top:1px solid #e5e7eb}.border-b{border-bottom:1px solid #e5e7eb}

    .shadow{box-shadow:0 1px 3px rgba(0,0,0,.1),0 1px 2px rgba(0,0,0,.06)}
    .shadow-sm{box-shadow:0 1px 2px rgba(0,0,0,.05)}
    .shadow-lg{box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.05)}
    .shadow-xl{box-shadow:0 20px 25px -5px rgba(0,0,0,.1),0 10px 10px -5px rgba(0,0,0,.04)}

    .cursor-pointer{cursor:pointer}.cursor-not-allowed{cursor:not-allowed}
    .object-cover{object-fit:cover}

    .z-30{z-index:30}.z-40{z-index:40}.z-50{z-index:50}

    .transition{transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform;transition-duration:150ms;transition-timing-function:cubic-bezier(.4,0,.2,1)}
    .transition-all{transition-property:all;transition-duration:150ms;transition-timing-function:cubic-bezier(.4,0,.2,1)}
    .transition-colors{transition-property:background-color,border-color,color,fill,stroke;transition-duration:150ms;transition-timing-function:cubic-bezier(.4,0,.2,1)}
    .transition-opacity{transition-property:opacity;transition-duration:150ms;transition-timing-function:cubic-bezier(.4,0,.2,1)}
    .transition-transform{transition-property:transform;transition-duration:150ms;transition-timing-function:cubic-bezier(.4,0,.2,1)}
    .duration-200{transition-duration:200ms}.duration-300{transition-duration:300ms}
    .ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}
    .transform{transform:translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}
    .translate-x-0{--tw-translate-x:0}.translate-x-full{--tw-translate-x:100%}.
    -translate-y-1\/2{--tw-translate-y:-50%}
    .hover\:scale-105:hover{--tw-scale-x:1.05;--tw-scale-y:1.05}
    .hover\:bg-gray-50:hover{background:#f9fafb}.hover\:bg-gray-100:hover{background:#f3f4f6}.hover\:bg-purple-100:hover{background:#f3e8ff}.hover\:bg-red-50:hover{background:#fef2f2}
    .hover\:bg-green-700:hover{background:#15803d}.hover\:bg-red-700:hover{background:#b91c1c}.hover\:text-gray-700:hover{color:#374151}.hover\:text-gray-800:hover{color:#1f2937}.hover\:text-purple-500:hover{color:#a855f7}.hover\:shadow-lg:hover{box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.05)}
    .focus\:ring:focus{outline:2px solid transparent;outline-offset:2px;box-shadow:0 0 0 3px rgba(124,58,237,.35)}
    .focus\:border-purple-500:focus{border-color:#a855f7}

    .line-clamp-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .whitespace-nowrap{white-space:nowrap}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.break-all{word-break:break-all}

    /* Grid */
    .grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.grid-cols-6{grid-template-columns:repeat(6,minmax(0,1fr))}
    .col-span-2{grid-column:span 2/span 2}
    @media(min-width:640px){.sm\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media(min-width:768px){.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\:flex-row{flex-direction:row}.md\:items-center{align-items:center}.md\:justify-between{justify-content:space-between}.md\:block{display:block}}
    @media(min-width:1024px){.lg\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.lg\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.lg\:col-span-2{grid-column:span 2/span 2}.lg\:hidden{display:none}.lg\:pl-64{padding-left:16rem}.lg\:static{position:static}}
    @media(min-width:1280px){.xl\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}}

    /* Brand */
    :root{--brand-primary:#7c3aed;--brand-secondary:#a855f7;--toast-success:#16a34a;--toast-error:#ef4444;--toast-info:#3b82f6;--toast-warning:#f59e0b}
    .gradient-primary{background:linear-gradient(135deg,var(--brand-primary),var(--brand-secondary))}
    .text-gradient{background:linear-gradient(135deg,var(--brand-primary),var(--brand-secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}

    /* Sidebar behavior */
    .sidebar{transform:translateX(-100%);transition:transform .3s ease-in-out}
    .sidebar.open{transform:translateX(0)}
    @media(min-width:1024px){.sidebar{transform:translateX(0)}}

    /* Cards, uploader, skeleton */
    .stat-card{transition:all .3s ease}.stat-card:hover{transform:translateY(-3px);box-shadow:0 10px 15px -3px rgba(0,0,0,.1)}
    .product-card{transition:all .3s ease;border:1px solid transparent}
    .product-card:hover{transform:translateY(-5px);box-shadow:0 20px 25px -5px rgba(0,0,0,.1),0 10px 10px -5px rgba(0,0,0,.04);border-color:#e5e7eb}
    .image-uploader{border:2px dashed #d1d5db;transition:all .3s ease;cursor:pointer}
    .image-uploader:hover{border-color:var(--brand-primary);background:#f8fafc}
    .image-uploader.dragover{border-color:var(--toast-success);background:#f0fdf4;transform:scale(1.02)}
    .skeleton{background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200% 100%;animation:loading 1.5s infinite}
    @keyframes loading{0%{background-position:200% 0}100%{background-position:-200% 0}}

    /* Toasts */
    .toast{position:fixed;top:1.25rem;right:1.25rem;z-index:1050;padding:.75rem 1rem;border-radius:.5rem;color:#fff;opacity:0;transform:translateX(120%);transition:all .35s ease-in-out;max-width:400px;display:flex;align-items:center;gap:.5rem}
    .toast.show{opacity:1;transform:translateX(0)}
    .toast-success{background:var(--toast-success)}.toast-error{background:var(--toast-error)}.toast-info{background:var(--toast-info)}.toast-warning{background:var(--toast-warning)}

    /* Modal */
    .modal-backdrop{background:rgba(0,0,0,.55);backdrop-filter:blur(4px);opacity:0;transition:opacity .2s ease-in-out}
    .modal-backdrop.show{opacity:1}
    .modal-content{transform:scale(.95);opacity:0;transition:all .2s ease-in-out}
    .modal-backdrop.show .modal-content{transform:scale(1);opacity:1}

    /* Price prefix */
    .price-input{position:relative}
    .price-input::before{content:'₹';position:absolute;left:12px;top:50%;transform:translateY(-50%);color:#6b7280;font-weight:500}
    .price-input input{padding-left:30px!important}

    .status-indicator{width:10px;height:10px;border-radius:50%;display:inline-block;border:2px solid #fff}
    .status-active{background:#10b981}.status-inactive{background:#ef4444}

    .custom-scrollbar::-webkit-scrollbar{width:8px}
    .custom-scrollbar::-webkit-scrollbar-track{background:#f1f1f1;border-radius:10px}
    .custom-scrollbar::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:10px}
    .custom-scrollbar::-webkit-scrollbar-thumb:hover{background:#a8a29e}

    .animate-spin{animation:spin 1s linear infinite}
    @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}

    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;font-weight:500;border-radius:.5rem;transition:all .2s ease}
    .btn-primary{background:linear-gradient(135deg,var(--brand-primary),var(--brand-secondary));color:#fff}
    .btn-primary:hover{opacity:.9;transform:translateY(-1px)}

    .chart-container{position:relative;height:320px;width:100%}
  </style>
</head>
<body class="bg-slate-100 min-h-screen font-sans">
  <!-- ================= AUTH ================= -->
  <section id="auth-section" class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-purple-50 to-indigo-50">
    <div class="bg-white w-full max-w-md rounded-2xl shadow-xl p-8 transform transition-all hover:shadow-2xl">
      <div class="text-center mb-8">
        <div class="mx-auto w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mb-4 ring-4 ring-purple-50">
          <i data-lucide="store" class="text-purple-600 w-8 h-8"></i>
        </div>
        <h1 class="text-3xl font-bold text-gray-800">QuickLocal Seller</h1>
        <p class="text-gray-600 mt-2">Manage your products and grow your business.</p>
      </div>

      <div class="flex mb-6 bg-gray-100 rounded-lg p-1">
        <button id="login-tab" class="flex-1 py-2 px-4 rounded-md font-semibold transition-all bg-white text-purple-600 shadow-sm">Login</button>
        <button id="register-tab" class="flex-1 py-2 px-4 rounded-md font-medium transition-all text-gray-600">Register</button>
      </div>

      <!-- Login Form -->
      <form id="login-form" class="space-y-4">
        <div>
          <label for="login-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
          <div class="relative">
            <i data-lucide="mail" class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"></i>
            <input id="login-email" type="email" placeholder="you@example.com" required class="w-full border border-gray-300 rounded-lg p-3 pl-10 focus-ring focus:border-purple-500 transition-colors">
          </div>
        </div>
        <div>
          <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
          <div class="relative">
            <i data-lucide="lock" class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"></i>
            <input id="login-password" type="password" placeholder="••••••••" required class="w-full border border-gray-300 rounded-lg p-3 pl-10 focus-ring focus:border-purple-500 transition-colors">
          </div>
          <div class="mt-1 text-right">
            <a href="#" class="text-sm text-purple-600 hover:underline">Forgot password?</a>
          </div>
        </div>
        <button type="submit" class="w-full gradient-primary text-white py-3 rounded-lg font-semibold transition-all hover:shadow-lg flex items-center justify-center gap-2 btn btn-primary">
          <span id="login-btn-text">Sign In</span>
          <i data-lucide="loader" id="login-spinner" class="animate-spin hidden w-5 h-5"></i>
        </button>
      </form>

      <!-- Register Form -->
      <form id="register-form" class="space-y-4 hidden">
        <div>
          <label for="reg-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
          <input id="reg-name" type="text" placeholder="John Doe" required class="w-full border border-gray-300 rounded-lg p-3 focus-ring focus:border-purple-500 transition-colors">
        </div>
        <div>
          <label for="reg-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
          <input id="reg-email" type="email" placeholder="john@example.com" required class="w-full border border-gray-300 rounded-lg p-3 focus-ring focus:border-purple-500 transition-colors">
        </div>
        <div>
          <label for="reg-business" class="block text-sm font-medium text-gray-700 mb-1">Business Name</label>
          <input id="reg-business" type="text" placeholder="Your Business Name" required class="w-full border border-gray-300 rounded-lg p-3 focus-ring focus:border-purple-500 transition-colors">
        </div>
        <div>
          <label for="reg-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
          <input id="reg-password" type="password" placeholder="Minimum 6 characters" required class="w-full border border-gray-300 rounded-lg p-3 focus-ring focus:border-purple-500 transition-colors">
        </div>
        <div>
          <label for="reg-confirm-password" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
          <input id="reg-confirm-password" type="password" placeholder="Confirm your password" required class="w-full border border-gray-300 rounded-lg p-3 focus-ring focus:border-purple-500 transition-colors">
        </div>
        <div class="flex items-center">
          <input id="reg-terms" type="checkbox" class="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded">
          <label for="reg-terms" class="ml-2 block text-sm text-gray-700">I agree to the <a class="text-purple-600 hover:text-purple-500">Terms</a> & <a class="text-purple-600 hover:text-purple-500">Privacy</a></label>
        </div>
        <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition-all hover:shadow-lg flex items-center justify-center gap-2">
          <span id="register-btn-text">Create Account</span>
          <i data-lucide="loader" id="register-spinner" class="animate-spin hidden w-5 h-5"></i>
        </button>
      </form>
    </div>
  </section>

  <!-- ================= APP LAYOUT ================= -->
  <section id="dashboard-section" class="hidden">
    <!-- Mobile sidebar backdrop -->
    <div id="sidebar-backdrop" class="fixed inset-0 bg-gray-900 bg-opacity-50 z-40 lg:hidden lg:z-auto transition-opacity duration-200 hidden"></div>

    <!-- Sidebar -->
    <div id="sidebar" class="flex fixed top-0 left-0 z-50 flex-col flex-shrink-0 w-64 h-full bg-white border-r border-gray-200 sidebar">
      <div class="flex items-center justify-between px-6 py-4 border-b border-gray-200">
        <div class="flex items-center gap-3">
          <div class="bg-purple-100 p-2 rounded-lg"><i data-lucide="store" class="text-purple-600 w-6 h-6"></i></div>
          <span class="text-xl font-bold text-gray-800">QuickLocal</span>
        </div>
        <button id="close-sidebar" class="lg:hidden rounded-lg p-1 hover:bg-gray-100">
          <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
        </button>
      </div>

      <div class="flex flex-col justify-between flex-1 mt-6 px-4 pb-4 custom-scrollbar overflow-y-auto">
        <nav class="flex-1 space-y-2">
          <a href="#" class="nav-item active flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-50" data-page="dashboard"><i data-lucide="layout-dashboard" class="w-5 h-5"></i><span>Dashboard</span></a>
          <a href="#" class="nav-item flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-50" data-page="products"><i data-lucide="package" class="w-5 h-5"></i><span>Products</span><span id="nav-products-count" class="ml-auto text-xs bg-purple-100 text-purple-600 px-2 py-0.5 rounded-full">0</span></a>
          <a href="#" class="nav-item flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-50" data-page="orders"><i data-lucide="shopping-cart" class="w-5 h-5"></i><span>Orders</span><span id="nav-orders-count" class="ml-auto text-xs bg-purple-100 text-purple-600 px-2 py-0.5 rounded-full">0</span></a>
          <a href="#" class="nav-item flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-50" data-page="customers"><i data-lucide="users" class="w-5 h-5"></i><span>Customers</span></a>
          <a href="#" class="nav-item flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-50" data-page="analytics"><i data-lucide="bar-chart-3" class="w-5 h-5"></i><span>Analytics</span></a>
          <a href="#" class="nav-item flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-50" data-page="settings"><i data-lucide="settings" class="w-5 h-5"></i><span>Settings</span></a>
        </nav>
        <div class="border-t pt-4">
          <button id="logout-btn" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-red-50 text-red-600"><i data-lucide="log-out" class="w-5 h-5"></i><span>Logout</span></button>
        </div>
      </div>
    </div>

    <!-- Topbar -->
    <header class="sticky top-0 z-30 bg-white border-b border-gray-200 lg:pl-64">
      <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <button id="open-sidebar" class="lg:hidden rounded-lg p-2 hover:bg-gray-100"><i data-lucide="menu" class="w-6 h-6"></i></button>
          <h2 class="text-xl font-semibold">Seller Dashboard</h2>
        </div>
        <div class="flex items-center gap-3">
          <div id="seller-status" class="flex items-center gap-2 bg-green-100 text-green-600 px-3 py-1 rounded-full text-sm"><span class="status-indicator status-active"></span><span>Online</span></div>
          <div id="seller-name" class="text-sm text-gray-600 truncate max-w-[160px]"></div>
        </div>
      </div>
    </header>

    <!-- Content -->
    <main class="lg:pl-64">
      <div class="max-w-7xl mx-auto p-4 space-y-6">
        <!-- DASHBOARD PAGE -->
        <section id="page-dashboard" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="bg-white rounded-xl shadow stat-card p-4">
              <div class="flex items-center justify-between mb-2"><span class="text-sm text-gray-500">Total Sales</span><i data-lucide="indian-rupee" class="w-5 h-5 text-gray-400"></i></div>
              <div class="text-2xl font-bold" id="stat-total-sales">₹0</div>
              <div class="text-xs text-gray-500 mt-1" id="stat-sales-delta">+0% vs last week</div>
            </div>
            <div class="bg-white rounded-xl shadow stat-card p-4">
              <div class="flex items-center justify-between mb-2"><span class="text-sm text-gray-500">Orders</span><i data-lucide="shopping-bag" class="w-5 h-5 text-gray-400"></i></div>
              <div class="text-2xl font-bold" id="stat-orders">0</div>
              <div class="text-xs text-gray-500 mt-1">Last 7 days</div>
            </div>
            <div class="bg-white rounded-xl shadow stat-card p-4">
              <div class="flex items-center justify-between mb-2"><span class="text-sm text-gray-500">Products</span><i data-lucide="package" class="w-5 h-5 text-gray-400"></i></div>
              <div class="text-2xl font-bold" id="stat-products">0</div>
              <div class="text-xs text-gray-500 mt-1">Active listings</div>
            </div>
            <div class="bg-white rounded-xl shadow stat-card p-4">
              <div class="flex items-center justify-between mb-2"><span class="text-sm text-gray-500">Customers</span><i data-lucide="users" class="w-5 h-5 text-gray-400"></i></div>
              <div class="text-2xl font-bold" id="stat-customers">0</div>
              <div class="text-xs text-gray-500 mt-1">This month</div>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
            <div class="bg-white rounded-xl shadow p-4 lg:col-span-2">
              <div class="flex items-center justify-between mb-3">
                <h3 class="font-semibold">Sales Overview</h3>
                <div class="text-xs text-gray-500" id="chart-range-label">Last 7 days</div>
              </div>
              <div class="chart-container"><canvas id="salesChart"></canvas></div>
            </div>
            <div class="bg-white rounded-xl shadow p-4">
              <h3 class="font-semibold mb-3">Top Categories</h3>
              <ul id="top-categories" class="space-y-2 text-sm"></ul>
            </div>
          </div>
        </section>

        <!-- PRODUCTS PAGE -->
        <section id="page-products" class="hidden space-y-4">
          <div class="bg-white rounded-xl shadow p-4">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold">Add / Edit Product</h3>
              <button id="reset-product-form" class="text-sm text-gray-600 hover:underline">Reset</button>
            </div>
            <form id="product-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="text-sm text-gray-700 mb-1 block">Name</label>
                <input id="prod-name" class="w-full border border-gray-300 rounded-lg p-3 focus-ring focus:border-purple-500" placeholder="Product name" required />
              </div>
              <div>
                <label class="text-sm text-gray-700 mb-1 block">Category</label>
                <select id="prod-category" class="w-full border border-gray-300 rounded-lg p-3 focus-ring focus:border-purple-500" required></select>
              </div>
              <div class="price-input">
                <label class="text-sm text-gray-700 mb-1 block">Price</label>
                <input id="prod-price" type="number" min="0" step="0.01" class="w-full border border-gray-300 rounded-lg p-3 focus-ring focus:border-purple-500" placeholder="0.00" required />
              </div>
              <div>
                <label class="text-sm text-gray-700 mb-1 block">Stock</label>
                <input id="prod-stock" type="number" min="0" class="w-full border border-gray-300 rounded-lg p-3 focus-ring focus:border-purple-500" placeholder="0" required />
              </div>
              <div class="md:col-span-2">
                <label class="text-sm text-gray-700 mb-1 block">Description</label>
                <textarea id="prod-description" rows="3" class="w-full border border-gray-300 rounded-lg p-3 focus-ring focus:border-purple-500" placeholder="Short description..."></textarea>
              </div>
              <div class="md:col-span-2">
                <label class="text-sm text-gray-700 mb-1 block">Images</label>
                <div id="image-drop" class="image-uploader rounded-xl p-4 flex items-center justify-center text-gray-600">
                  <div class="text-center">
                    <i data-lucide="image" class="w-8 h-8 mb-2"></i>
                    <div>Drag & drop or click to upload</div>
                    <input id="prod-images" type="file" accept="image/*" multiple class="hidden" />
                  </div>
                </div>
                <div id="image-previews" class="flex flex-wrap gap-3 mt-3"></div>
              </div>
              <div class="md:col-span-2 flex items-center gap-3">
                <button class="btn btn-primary px-4 py-2" id="save-product" type="submit"><i data-lucide="save"></i> Save Product</button>
                <button class="px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50" id="delete-product" type="button"><i data-lucide="trash-2" class="mr-1"></i>Delete</button>
              </div>
            </form>
          </div>

          <div class="bg-white rounded-xl shadow p-4">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold">Your Products</h3>
              <input id="product-search" placeholder="Search products..." class="border border-gray-300 rounded-lg p-2 w-64 focus-ring focus:border-purple-500" />
            </div>
            <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
          </div>
        </section>

        <!-- ORDERS PAGE -->
        <section id="page-orders" class="hidden space-y-4">
          <div class="bg-white rounded-xl shadow p-4">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold">Recent Orders</h3>
              <select id="order-filter" class="border border-gray-300 rounded-lg p-2">
                <option value="all">All</option>
                <option value="pending">Pending</option>
                <option value="processing">Processing</option>
                <option value="shipped">Shipped</option>
                <option value="delivered">Delivered</option>
                <option value="cancelled">Cancelled</option>
              </select>
            </div>
            <div id="orders-list" class="space-y-2"></div>
          </div>
        </section>

        <!-- CUSTOMERS PAGE -->
        <section id="page-customers" class="hidden space-y-4">
          <div class="bg-white rounded-xl shadow p-4">
            <h3 class="font-semibold mb-3">Customers</h3>
            <div id="customers-list" class="space-y-2"></div>
          </div>
        </section>

        <!-- ANALYTICS PAGE -->
        <section id="page-analytics" class="hidden space-y-4">
          <div class="bg-white rounded-xl shadow p-4">
            <h3 class="font-semibold mb-3">Analytics</h3>
            <div class="chart-container"><canvas id="analyticsChart"></canvas></div>
          </div>
        </section>

        <!-- SETTINGS PAGE -->
        <section id="page-settings" class="hidden space-y-4">
          <div class="bg-white rounded-xl shadow p-4">
            <h3 class="font-semibold mb-3">Settings</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between"><span>Store Status</span><label class="flex items-center gap-2"><input type="checkbox" id="store-status-toggle" checked /><span class="text-sm text-gray-600">Online</span></label></div>
              <div class="flex items-center justify-between"><span>Low stock alerts</span><input type="checkbox" id="low-stock-toggle" checked /></div>
            </div>
          </div>
        </section>
      </div>
    </main>
  </section>

  <!-- Toast container -->
  <div id="toast" class="toast"></div>

  <!-- Simple Modal -->
  <div id="modal" class="modal-backdrop fixed inset-0 z-50 hidden items-center justify-center">
    <div class="modal-content bg-white rounded-xl shadow-xl p-6 max-w-lg w-full">
      <div class="flex items-center justify-between mb-2">
        <h3 id="modal-title" class="font-semibold">Confirm</h3>
        <button id="modal-close" class="rounded-lg p-1 hover:bg-gray-100"><i data-lucide="x" class="w-5 h-5"></i></button>
      </div>
      <div id="modal-body" class="text-sm text-gray-600">Are you sure?</div>
      <div class="flex items-center justify-end gap-2 mt-4">
        <button id="modal-cancel" class="px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50">Cancel</button>
        <button id="modal-ok" class="btn btn-primary px-4 py-2">OK</button>
      </div>
    </div>
  </div>

  <script>
    // ========= Preserve backend endpoints from seller-dashboard.html =========
    // If your original file defines window.ENDPOINTS, we keep it. Otherwise we use sensible defaults.
    const DEFAULT_API_BASE = 'https://quicklocal-backend.onrender.com/api/v1';
    const ENDPOINTS = window.ENDPOINTS || {
      base: DEFAULT_API_BASE,
      auth: {
        login: DEFAULT_API_BASE + '/auth/login',
        register: DEFAULT_API_BASE + '/auth/register',
        me: DEFAULT_API_BASE + '/auth/me'
      },
      categories: DEFAULT_API_BASE + '/categories',
      products: {
        listMine: DEFAULT_API_BASE + '/products/seller', // fallback
        list: DEFAULT_API_BASE + '/products',
        create: DEFAULT_API_BASE + '/products',
        update: id => DEFAULT_API_BASE + '/products/' + id,
        remove: id => DEFAULT_API_BASE + '/products/' + id
      },
      orders: {
        listMine: DEFAULT_API_BASE + '/orders/seller',
        updateStatus: (id) => DEFAULT_API_BASE + '/orders/' + id + '/status'
      },
      customers: DEFAULT_API_BASE + '/customers/seller'
    };

    // ========= Axios setup =========
    const api = axios.create({ baseURL: ENDPOINTS.base, withCredentials: true });
    api.interceptors.request.use(cfg => {
      const token = localStorage.getItem('accessToken');
      if (token) cfg.headers.Authorization = 'Bearer ' + token;
      return cfg;
    });

    // ========= Helpers =========
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const icon = () => lucide.createIcons();

    function showToast(msg, type='info'){ const el = $('#toast'); el.className = 'toast toast-' + type; el.innerHTML = `<i data-lucide="info"></i><span>${msg}</span>`; el.classList.add('show'); icon(); setTimeout(()=>el.classList.remove('show'), 2500); }

    function openModal({title='Confirm', body='Are you sure?', onOk=null}){
      $('#modal-title').textContent = title; $('#modal-body').textContent = body;
      const wrap = $('#modal'); wrap.classList.remove('hidden'); setTimeout(()=>wrap.classList.add('show'), 10);
      const cleanup = ()=>{ wrap.classList.add('hidden'); wrap.classList.remove('show'); $('#modal-ok').onclick=null; };
      $('#modal-close').onclick = cleanup; $('#modal-cancel').onclick = cleanup; $('#modal').onclick = e=>{ if(e.target===wrap) cleanup(); };
      $('#modal-ok').onclick = ()=>{ onOk && onOk(); cleanup(); };
    }

    function formatINR(num){ try{ return new Intl.NumberFormat('en-IN',{style:'currency',currency:'INR',maximumFractionDigits:0}).format(num||0);}catch{ return '₹'+(num||0); } }

    function setAuthUI(loggedIn){ $('#auth-section').classList.toggle('hidden', !!loggedIn); $('#dashboard-section').classList.toggle('hidden', !loggedIn); }

    // ========= Auth =========
    async function doLogin(e){ e.preventDefault(); $('#login-spinner').classList.remove('hidden');
      try{
        const email = $('#login-email').value.trim(); const password = $('#login-password').value.trim();
        const { data } = await api.post(ENDPOINTS.auth.login, { email, password });
        if(data?.accessToken){ localStorage.setItem('accessToken', data.accessToken); localStorage.setItem('seller', JSON.stringify(data.user||{})); await hydrate(); showToast('Logged in!', 'success'); }
        else showToast('Invalid response from server', 'error');
      }catch(err){ showToast(err?.response?.data?.message || 'Login failed', 'error'); }
      finally{ $('#login-spinner').classList.add('hidden'); }
    }

    async function doRegister(e){ e.preventDefault(); $('#register-spinner').classList.remove('hidden');
      try{
        const name=$('#reg-name').value.trim(); const email=$('#reg-email').value.trim(); const business=$('#reg-business').value.trim(); const password=$('#reg-password').value; const confirm=$('#reg-confirm-password').value; if(password!==confirm) return showToast('Passwords do not match','error');
        const { data } = await api.post(ENDPOINTS.auth.register, { name, email, businessName:business, password });
        showToast(data?.message||'Registered! Please log in.','success'); $('#login-tab').click();
      }catch(err){ showToast(err?.response?.data?.message || 'Registration failed','error'); }
      finally{ $('#register-spinner').classList.add('hidden'); }
    }

    function logout(){ localStorage.removeItem('accessToken'); localStorage.removeItem('seller'); setAuthUI(false); }

    // ========= Navigation =========
    function setPage(page){ ['dashboard','products','orders','customers','analytics','settings'].forEach(p=>{ $('#page-'+p).classList.toggle('hidden', p!==page); });
      $$('.nav-item').forEach(a=>a.classList.remove('bg-gray-100')); const active = $(`.nav-item[data-page="${page}"]`); active && active.classList.add('bg-gray-100'); icon(); }

    // ========= Data loads =========
    async function loadMe(){ try{ const {data}= await api.get(ENDPOINTS.auth.me); const user = data?.user || JSON.parse(localStorage.getItem('seller')||'{}'); $('#seller-name').textContent = user?.name || user?.email || 'Seller'; return user; }catch{ return JSON.parse(localStorage.getItem('seller')||'{}'); } }

    async function loadCategories(){ try{ const {data}= await api.get(ENDPOINTS.categories); const cats = Array.isArray(data)?data:(data?.data||[]); const sel=$('#prod-category'); sel.innerHTML = '<option value="">Select</option>' + cats.map(c=>`<option value="${c._id||c.id}">${c.name}</option>`).join(''); }catch{ showToast('Failed to load categories','error'); } }

    async function loadProducts(){ $('#products-grid').innerHTML = '<div class="grid grid-cols-2 gap-3">'+Array(4).fill().map(()=>`<div class="bg-white rounded-xl p-3 product-card skeleton h-48"></div>`).join('')+'</div>'; try{ const {data}= await api.get(ENDPOINTS.products.listMine); const items = data?.data || data || []; $('#nav-products-count').textContent = items.length; $('#stat-products').textContent = items.length; renderProducts(items); }catch{ showToast('Failed to load products','error'); $('#products-grid').innerHTML=''; } }

    function renderProducts(items){ const grid = $('#products-grid'); grid.innerHTML = items.map(p=>{
      const img = (p.images && p.images[0]) || p.imageUrl || 'https://via.placeholder.com/400x300?text=No+Image';
      return `<div class="bg-white rounded-xl shadow product-card overflow-hidden">
        <img src="${img}" alt="${(p.name||'').replace(/"/g,'&quot;')}" class="w-full h-40 object-cover">
        <div class="p-3">
          <div class="flex items-center justify-between mb-1"><div class="font-semibold truncate" title="${p.name}">${p.name}</div><div class="text-sm text-gray-600">${formatINR(p.price)}</div></div>
          <div class="text-xs text-gray-500 line-clamp-2">${p.description||''}</div>
          <div class="flex items-center justify-between mt-3">
            <button class="px-3 py-1 rounded-lg border border-gray-300 hover:bg-gray-50" data-edit="${p._id||p.id}"><i data-lucide="pencil"></i> Edit</button>
            <button class="px-3 py-1 rounded-lg text-red-600 hover:bg-red-50" data-remove="${p._id||p.id}"><i data-lucide="trash-2"></i> Remove</button>
          </div>
        </div>
      </div>`;
    }).join('');
      icon();
      grid.querySelectorAll('[data-edit]').forEach(btn=>btn.onclick = ()=>fillProductForm(items.find(i=> (i._id||i.id)===btn.dataset.edit)));
      grid.querySelectorAll('[data-remove]').forEach(btn=>btn.onclick = ()=>confirmDeleteProduct(btn.dataset.remove));
    }

    function fillProductForm(p){ if(!p) return; $('#prod-name').value=p.name||''; $('#prod-category').value=p.category? (p.category._id||p.category.id||p.category) : ''; $('#prod-price').value=p.price||0; $('#prod-stock').value=p.stock||0; $('#prod-description').value=p.description||''; $('#product-form').dataset.editId = p._id||p.id; window.scrollTo({top:0,behavior:'smooth'}); setPage('products'); }

    function resetProductForm(){ $('#product-form').reset(); delete $('#product-form').dataset.editId; $('#image-previews').innerHTML=''; }

    async function confirmDeleteProduct(id){ openModal({ title:'Delete product', body:'This action cannot be undone.', onOk:()=>deleteProduct(id) }); }

    async function deleteProduct(id){ try{ await api.delete(ENDPOINTS.products.remove(id)); showToast('Product deleted','success'); loadProducts(); }catch(err){ showToast(err?.response?.data?.message||'Delete failed','error'); } }

    async function saveProduct(e){ e.preventDefault(); const fd = new FormData(); fd.append('name',$('#prod-name').value.trim()); fd.append('category',$('#prod-category').value); fd.append('price',$('#prod-price').value); fd.append('stock',$('#prod-stock').value); fd.append('description',$('#prod-description').value.trim());
      const files = $$('#image-previews img').map(img=>img.file).filter(Boolean); files.forEach(f=>fd.append('images',f));
      try{
        const editId = $('#product-form').dataset.editId;
        if(editId){ await api.put(ENDPOINTS.products.update(editId), fd, { headers:{'Content-Type':'multipart/form-data'} }); showToast('Product updated','success'); }
        else { await api.post(ENDPOINTS.products.create, fd, { headers:{'Content-Type':'multipart/form-data'} }); showToast('Product created','success'); }
        resetProductForm(); loadProducts();
      }catch(err){ showToast(err?.response?.data?.message||'Save failed','error'); }
    }

    // Orders
    async function loadOrders(){ try{ const {data}= await api.get(ENDPOINTS.orders.listMine); const list = data?.data || data || []; $('#nav-orders-count').textContent = list.length; $('#stat-orders').textContent = list.length; renderOrders(list); }catch{ showToast('Failed to load orders','error'); }}

    function renderOrders(list){ const wrap = $('#orders-list'); if(!list.length){ wrap.innerHTML = '<div class="text-sm text-gray-500">No orders yet.</div>'; return; }
      wrap.innerHTML = list.map(o=>{
        const items = (o.items||[]).map(i=>`${i.qty||i.quantity}× ${i.name||i.product?.name||'Item'}`).join(', ');
        return `<div class="border border-gray-200 rounded-lg p-3 flex items-center justify-between">
          <div>
            <div class="font-semibold">#${o.orderId||o._id||''} <span class="text-xs text-gray-500">• ${new Date(o.createdAt||Date.now()).toLocaleString()}</span></div>
            <div class="text-sm text-gray-600 truncate max-w-[520px]">${items}</div>
          </div>
          <div class="flex items-center gap-3">
            <span class="text-sm px-2 py-1 rounded bg-gray-100">${o.status||'pending'}</span>
            <button class="px-3 py-1 rounded-lg border border-gray-300 hover:bg-gray-50" data-advance="${o._id||o.id}">Advance</button>
          </div>
        </div>`
      }).join('');
      icon();
      wrap.querySelectorAll('[data-advance]').forEach(btn=> btn.onclick = ()=>advanceOrder(btn.dataset.advance));
    }

    async function advanceOrder(id){ const statuses=['pending','processing','shipped','delivered']; try{ const {data}= await api.patch(ENDPOINTS.orders.updateStatus(id),{}); showToast(data?.message||'Order updated','success'); loadOrders(); }catch{ showToast('Failed to update order','error'); } }

    // Customers
    async function loadCustomers(){ try{ const {data}= await api.get(ENDPOINTS.customers); const list = data?.data || data || []; $('#stat-customers').textContent = list.length; $('#customers-list').innerHTML = list.map(c=>`<div class="border border-gray-200 rounded-lg p-3 flex items-center justify-between"><div><div class="font-semibold">${c.name||c.email}</div><div class="text-xs text-gray-500">${c.email||''}</div></div><div class="text-sm text-gray-600">Orders: ${c.ordersCount||0}</div></div>`).join(''); }catch{ $('#customers-list').innerHTML='<div class="text-sm text-gray-500">No data</div>'; }}

    // Charts
    let salesChart, analyticsChart;
    function renderSalesChart(series){ const ctx = document.getElementById('salesChart').getContext('2d'); if(salesChart) salesChart.destroy(); salesChart = new Chart(ctx,{ type:'line', data:{ labels: series.map(s=>s.label), datasets:[{ label:'Sales', data: series.map(s=>s.value), tension:.35, fill:false }] }, options:{ responsive:true, plugins:{ legend:{ display:false } }, scales:{ y:{ ticks:{ callback:v=>formatINR(v).replace('₹','') } } } }); }
    function renderAnalyticsChart(series){ const ctx = document.getElementById('analyticsChart').getContext('2d'); if(analyticsChart) analyticsChart.destroy(); analyticsChart = new Chart(ctx,{ type:'bar', data:{ labels: series.map(s=>s.label), datasets:[{ label:'Orders', data: series.map(s=>s.value) }] }, options:{ responsive:true, plugins:{ legend:{ display:false } } }); }

    async function loadDashboard(){ try{ // best-effort pulls
        const [productsRes, ordersRes] = await Promise.allSettled([ api.get(ENDPOINTS.products.listMine), api.get(ENDPOINTS.orders.listMine) ]);
        const products = productsRes.value?.data?.data || productsRes.value?.data || [];
        const orders = ordersRes.value?.data?.data || ordersRes.value?.data || [];
        $('#stat-products').textContent = products.length; $('#nav-products-count').textContent = products.length;
        $('#stat-orders').textContent = orders.length; $('#nav-orders-count').textContent = orders.length;
        const total = orders.reduce((sum,o)=> sum + (o.total||o.amount||0), 0); $('#stat-total-sales').textContent = formatINR(total);
        const last7 = Array.from({length:7}).map((_,i)=>{ const d=new Date(); d.setDate(d.getDate()- (6-i)); const label=d.toLocaleDateString('en-IN',{month:'short',day:'numeric'}); const dayTotal = orders.filter(o=> new Date(o.createdAt).toDateString()===d.toDateString()).reduce((s,o)=>s+(o.total||o.amount||0),0); return {label,value:dayTotal}; });
        renderSalesChart(last7); renderAnalyticsChart(last7.map(d=>({label:d.label,value:Math.round((d.value||0)/1000)})));
        const catCount = {}; products.forEach(p=>{ const name = p.category?.name || p.category || 'Other'; catCount[name] = (catCount[name]||0)+1; });
        $('#top-categories').innerHTML = Object.entries(catCount).sort((a,b)=>b[1]-a[1]).slice(0,5).map(([k,v])=>`<li class="flex items-center justify-between"><span>${k}</span><span class="text-sm text-gray-600">${v}</span></li>`).join('');
      }catch{ /* non-fatal */ }
    }

    // Uploader UI
    function initUploader(){ const box = $('#image-drop'); const input = $('#prod-images');
      box.onclick = ()=> input.click();
      box.ondragover = e=>{ e.preventDefault(); box.classList.add('dragover'); };
      box.ondragleave = ()=> box.classList.remove('dragover');
      box.ondrop = e=>{ e.preventDefault(); box.classList.remove('dragover'); handleFiles(e.dataTransfer.files); };
      input.onchange = ()=> handleFiles(input.files);
      function handleFiles(files){ const list = Array.from(files); list.forEach(f=>{ const reader = new FileReader(); reader.onload = ()=>{ const img = new Image(); img.src = reader.result; img.className='w-16 h-16 object-cover rounded-lg border border-gray-200'; img.file = f; const wrap = document.createElement('div'); wrap.className='relative'; wrap.innerHTML = `<button class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center" title="Remove">×</button>`; wrap.appendChild(img); wrap.querySelector('button').onclick = ()=> wrap.remove(); $('#image-previews').appendChild(wrap); }; reader.readAsDataURL(f); }); }
    }

    // Sidebar mobile
    function setupSidebar(){ const sb = $('#sidebar'), bd = $('#sidebar-backdrop'); $('#open-sidebar').onclick = ()=>{ sb.classList.add('open'); bd.classList.remove('hidden'); }; $('#close-sidebar').onclick = ()=>{ sb.classList.remove('open'); bd.classList.add('hidden'); }; bd.onclick = ()=>{ sb.classList.remove('open'); bd.classList.add('hidden'); } }

    // Hydrate after login
    async function hydrate(){ setAuthUI(true); icon(); await loadMe(); await Promise.all([loadCategories(), loadProducts(), loadOrders(), loadCustomers()]); await loadDashboard(); setPage('dashboard'); }

    // ========= Events =========
    document.addEventListener('DOMContentLoaded', ()=>{
      icon(); setupSidebar(); initUploader();
      // tabs
      $('#login-tab').onclick = ()=>{ $('#login-form').classList.remove('hidden'); $('#register-form').classList.add('hidden'); $('#login-tab').classList.add('bg-white','text-purple-600','shadow-sm'); $('#register-tab').classList.remove('bg-white','text-purple-600','shadow-sm'); };
      $('#register-tab').onclick = ()=>{ $('#register-form').classList.remove('hidden'); $('#login-form').classList.add('hidden'); $('#register-tab').classList.add('bg-white','text-purple-600','shadow-sm'); $('#login-tab').classList.remove('bg-white','text-purple-600','shadow-sm'); };

      // auth
      $('#login-form').addEventListener('submit', doLogin);
      $('#register-form').addEventListener('submit', doRegister);
      $('#logout-btn').onclick = logout;

      // nav
      $$('.nav-item').forEach(a=> a.onclick = (e)=>{ e.preventDefault(); setPage(a.dataset.page); });

      // product form
      $('#product-form').addEventListener('submit', saveProduct);
      $('#reset-product-form').onclick = resetProductForm;

      // filters
      $('#order-filter').onchange = ()=> loadOrders();

      // settings
      $('#store-status-toggle').onchange = (e)=>{ const on = e.target.checked; $('#seller-status').className = 'flex items-center gap-2 '+(on?'bg-green-100 text-green-600':'bg-red-100 text-red-600')+' px-3 py-1 rounded-full text-sm'; $('#seller-status .status-indicator').className = 'status-indicator '+(on?'status-active':'status-inactive'); };

      // restore session
      const token = localStorage.getItem('accessToken'); if(token){ hydrate(); } else { setAuthUI(false); }
    });
  </script>
</body>
</html>
