<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QuickLocal Seller – Super Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg: #f3f4f6;
            --bg-soft: #e5e7eb;
            --dark: #111827;
            --text: #1f2933;
            --gray: #6b7280;
            --primary: #6366f1;
            --primary-soft: rgba(99, 102, 241, 0.08);
            --primary-light: #e0e7ff;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border: #e5e7eb;
            --radius: 12px;
            --shadow: 0 10px 30px rgba(15, 23, 42, 0.06);
            --shadow-soft: 0 4px 10px rgba(15, 23, 42, 0.05);
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background: radial-gradient(circle at top left, #eef2ff 0, #f9fafb 45%, #f3f4f6 100%);
            color: var(--text);
            min-height: 100vh;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        /* Top Nav */
        .top-nav {
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(16px);
            background: rgba(15, 23, 42, 0.92);
            color: white;
            padding: 0.75rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 10px 30px rgba(15, 23, 42, 0.35);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.04em;
        }

        .brand-logo {
            width: 32px;
            height: 32px;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 30%, #f97316, #6366f1);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 0 2px rgba(15,23,42,0.7);
        }

        .brand span {
            font-size: 0.95rem;
            text-transform: uppercase;
        }

        .nav-links {
            display: flex;
            gap: 1.25rem;
            align-items: center;
        }

        .nav-link {
            font-size: 0.9rem;
            padding: 0.4rem 0.75rem;
            border-radius: 999px;
            color: #e5e7eb;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            transition: 0.2s;
        }

        .nav-link i {
            font-size: 0.9rem;
        }

        .nav-link:hover {
            background: rgba(148, 163, 184, 0.15);
            color: #f9fafb;
        }

        .nav-link.active {
            background: linear-gradient(135deg, #4f46e5, #6366f1);
            color: #f9fafb;
            box-shadow: 0 0 0 1px rgba(191, 219, 254, 0.5);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .user-role {
            font-size: 0.75rem;
            color: #cbd5f5;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 20%, #f97316, #6366f1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.95rem;
            cursor: pointer;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 1.5rem auto 3rem;
            padding: 0 1.5rem;
        }

        /* Sections */
        .section {
            display: none;
            animation: fadeIn 0.25s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(6px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Section header */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--dark);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
            gap: 1.25rem;
            margin-bottom: 1.75rem;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 1.25rem;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            transition: 0.18s ease;
        }

        .stat-card::after {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top left, rgba(99, 102, 241, 0.06), transparent 55%);
            pointer-events: none;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 16px 40px rgba(15, 23, 42, 0.10);
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }

        .stat-icon.primary { background: var(--primary-light); color: var(--primary); }
        .stat-icon.success { background: #d1fae5; color: var(--success); }
        .stat-icon.warning { background: #fef3c7; color: var(--warning); }
        .stat-icon.danger  { background: #fee2e2; color: var(--danger); }

        .stat-value {
            font-weight: 700;
            font-size: 1.4rem;
            margin-bottom: 0.1rem;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .stat-change {
            font-size: 0.75rem;
            margin-top: 0.4rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .stat-change.positive { color: var(--success); }
        .stat-change.negative { color: var(--danger); }

        /* Charts */
        .chart-container {
            background: white;
            border-radius: var(--radius);
            padding: 1.25rem 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-size: 0.98rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.75rem;
        }

        /* Filters bar (shared) */
        .filters-bar {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.75rem;
            background: white;
            padding: 0.85rem 1rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-soft);
            margin-bottom: 1.25rem;
        }

        .search-box {
            position: relative;
            flex: 1;
            min-width: 220px;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 0.6rem 0.9rem 0.6rem 2.25rem;
            border-radius: 999px;
            border: 1px solid var(--border);
            font-size: 0.85rem;
            outline: none;
            transition: 0.16s;
        }

        .search-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(129, 140, 248, 0.35);
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            font-size: 0.85rem;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .filter-label {
            font-size: 0.78rem;
            color: var(--gray);
        }

        .filter-select {
            padding: 0.45rem 0.65rem;
            border-radius: 999px;
            border: 1px solid var(--border);
            background: #fff;
            font-size: 0.8rem;
        }

        /* Products grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1.25rem;
        }

        .product-card {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-soft);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .product-image {
            width: 100%;
            height: 170px;
            object-fit: cover;
            background: #e5e7eb;
        }

        .product-content {
            padding: 0.9rem 1rem 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .product-name {
            font-size: 0.95rem;
            font-weight: 600;
            margin: 0 0 0.2rem;
        }

        .product-category {
            font-size: 0.75rem;
            color: var(--gray);
        }

        .product-stock {
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
            border-radius: 999px;
            font-weight: 600;
            white-space: nowrap;
        }

        .stock-in { background: #ecfdf5; color: var(--success); }
        .stock-low { background: #fffbeb; color: var(--warning); }
        .stock-out { background: #fef2f2; color: var(--danger); }

        .product-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            font-size: 0.78rem;
        }

        .product-detail {
            display: flex;
            justify-content: space-between;
            gap: 0.25rem;
        }

        .detail-label {
            color: var(--gray);
        }

        .detail-value {
            font-weight: 600;
        }

        .product-actions {
            margin-top: 0.6rem;
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        /* Empty state */
        .empty-state {
            background: white;
            border-radius: var(--radius);
            padding: 2rem 1.5rem;
            text-align: center;
            box-shadow: var(--shadow-soft);
        }

        .empty-icon {
            font-size: 2.2rem;
            margin-bottom: 0.75rem;
            color: var(--border);
        }

        .empty-title {
            margin: 0 0 0.25rem;
            font-size: 1.05rem;
        }

        .empty-description {
            margin: 0 0 1rem;
            font-size: 0.85rem;
            color: var(--gray);
        }

        /* Buttons */
        .btn {
            border: none;
            border-radius: 999px;
            padding: 0.5rem 0.95rem;
            font-size: 0.78rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            font-weight: 600;
        }

        .btn i {
            font-size: 0.8rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4f46e5, #6366f1);
            color: white;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #111827;
        }

        .btn-danger {
            background: #fee2e2;
            color: #b91c1c;
        }

        .btn-sm {
            padding: 0.35rem 0.7rem;
            font-size: 0.72rem;
        }

        /* Inventory TABLE view */
        .inventory-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: 1.25rem;
        }

        .inventory-title {
            font-size: 1.35rem;
            font-weight: 700;
            color: var(--dark);
        }

        .data-table-wrapper {
            background: white;
            border-radius: 10px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-soft);
            overflow-x: auto;
        }

        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
            font-size: 0.8rem;
        }

        .inventory-table thead {
            background: #f9fafb;
        }

        .inventory-table th,
        .inventory-table td {
            padding: 0.6rem 0.8rem;
            border-bottom: 1px solid var(--border);
            text-align: left;
        }

        .inventory-table th {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--gray);
        }

        .inventory-table tbody tr:hover td {
            background: #f9fafb;
        }

        .product-row-main {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .inventory-img {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            object-fit: cover;
            border: 1px solid var(--border);
        }

        .product-info {
            display: flex;
            flex-direction: column;
            gap: 0.1rem;
        }

        .product-name-link {
            font-weight: 600;
            color: var(--primary);
            font-size: 0.8rem;
        }

        .product-meta {
            font-size: 0.7rem;
            color: var(--gray);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.25rem 0.55rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .status-active {
            background: #ecfdf5;
            color: var(--success);
        }

        .status-inactive {
            background: #fef2f2;
            color: var(--danger);
        }

        .editable-input {
            width: 70px;
            padding: 0.25rem 0.35rem;
            border-radius: 6px;
            border: 1px solid var(--border);
            font-size: 0.75rem;
        }

        .inventory-empty {
            text-align: center;
            padding: 2rem;
            font-size: 0.85rem;
            color: var(--gray);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.4);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-container {
            width: 100%;
            max-width: 720px;
            max-height: 90vh;
            background: white;
            border-radius: 18px;
            box-shadow: 0 25px 80px rgba(15, 23, 42, 0.45);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 0.9rem 1.25rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 1.05rem;
            font-weight: 600;
        }

        .modal-close {
            border: none;
            background: transparent;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--gray);
        }

        .modal-body {
            padding: 1rem 1.25rem 1.25rem;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 0.8rem 1.25rem;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .form-group {
            margin-bottom: 0.75rem;
        }

        .form-label {
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
            display: block;
        }

        .form-control,
        .form-textarea,
        .form-control-select {
            width: 100%;
            border-radius: 10px;
            border: 1px solid var(--border);
            padding: 0.45rem 0.65rem;
            font-size: 0.85rem;
            outline: none;
        }

        .form-textarea {
            min-height: 90px;
            resize: vertical;
        }

        .file-upload {
            border: 1.5px dashed var(--border);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            font-size: 0.8rem;
            color: var(--gray);
            cursor: pointer;
        }

        .image-preview {
            margin-top: 0.75rem;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 0.6rem;
        }

        .image-preview-item {
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .image-preview-item img {
            width: 100%;
            height: 80px;
            object-fit: cover;
        }

        .image-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            border-radius: 999px;
            border: none;
            background: rgba(15, 23, 42, 0.85);
            color: white;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            cursor: pointer;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 0.5rem;
        }

        .category-item {
            padding: 0.5rem;
            border-radius: 999px;
            border: 1px solid var(--border);
            font-size: 0.78rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            justify-content: center;
            transition: 0.16s;
        }

        .category-item:hover {
            border-color: var(--primary);
            background: var(--primary-soft);
            color: var(--primary);
        }

        .category-item.selected {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Alert */
        #alertContainer {
            position: fixed;
            top: 72px;
            right: 16px;
            z-index: 120;
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .alert {
            padding: 0.6rem 0.8rem;
            border-radius: 10px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            box-shadow: var(--shadow-soft);
        }

        .alert-success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .alert-error {
            background: #fee2e2;
            color: #b91c1c;
            border: 1px solid #fecaca;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        /* Loading overlay */
        #loadingOverlay {
            justify-content: center;
            align-items: center;
        }

        #loadingOverlay .loading {
            display: block;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 1.5rem;
        }

        .spinner {
            width: 32px;
            height: 32px;
            border-radius: 999px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            animation: spin 0.7s linear infinite;
            margin: 0 auto 0.75rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .top-nav {
                padding-inline: 1rem;
            }

            .nav-links {
                display: none;
            }

            .container {
                padding-inline: 1rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .products-grid {
                grid-template-columns: 1fr;
            }

            .filters-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .inventory-table {
                min-width: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="brand">
            <div class="brand-logo">
                <i class="fas fa-store"></i>
            </div>
            <span>QuickLocal Seller</span>
        </div>

        <div class="nav-links">
            <a href="#" class="nav-link active" data-tab="dashboard">
                <i class="fas fa-chart-line"></i> Dashboard
            </a>
            <a href="#" class="nav-link" data-tab="products">
                <i class="fas fa-boxes"></i> Products
            </a>
            <a href="#" class="nav-link" data-tab="inventory">
                <i class="fas fa-list"></i> Inventory
            </a>
            <a href="#" class="nav-link" data-tab="orders">
                <i class="fas fa-shopping-bag"></i> Orders
            </a>
            <a href="#" class="nav-link" data-tab="analytics">
                <i class="fas fa-chart-bar"></i> Analytics
            </a>
            <a href="#" class="nav-link" data-tab="settings">
                <i class="fas fa-gear"></i> Settings
            </a>
        </div>

        <div class="user-menu">
            <div class="user-info">
                <div class="user-name" id="userName">Seller</div>
                <div class="user-role">QuickLocal</div>
            </div>
            <div class="user-avatar" onclick="logout()">
                <span id="userInitials">S</span>
            </div>
        </div>
    </nav>

    <div class="container">
        <div id="alertContainer"></div>

        <!-- DASHBOARD -->
        <section id="dashboard" class="section active">
            <h1 class="section-title">Dashboard Overview</h1>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon primary">
                        <i class="fas fa-rupee-sign"></i>
                    </div>
                    <div class="stat-value" id="totalRevenue">₹0.00</div>
                    <div class="stat-label">Total Revenue</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        12% from last month
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon success">
                        <i class="fas fa-shopping-bag"></i>
                    </div>
                    <div class="stat-value" id="totalOrders">0</div>
                    <div class="stat-label">Total Orders</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        8% from last month
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon warning">
                        <i class="fas fa-box-open"></i>
                    </div>
                    <div class="stat-value" id="totalProducts">0</div>
                    <div class="stat-label">Active Products</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        5% from last month
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon danger">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-value" id="lowStock">0</div>
                    <div class="stat-label">Low Stock Items</div>
                    <div class="stat-change negative">
                        <i class="fas fa-arrow-down"></i>
                        2% from last month
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <h3 class="chart-title">Sales Performance (Last 7 Days)</h3>
                <canvas id="salesChart" height="100"></canvas>
            </div>

            <div class="chart-container">
                <h3 class="chart-title">Recent Orders</h3>
                <div id="recentOrders">
                    <div class="loading" style="display:block;">
                        <div class="spinner"></div>
                        <p>Loading orders.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- PRODUCTS (Card Grid) -->
        <section id="products" class="section">
            <div class="section-header">
                <h1 class="section-title">Product Management</h1>
                <button class="btn btn-primary" onclick="openAddProductModal()">
                    <i class="fas fa-plus"></i> Add New Product
                </button>
            </div>

            <div class="filters-bar">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="productSearch" class="search-input" placeholder="Search by name or description.">
                </div>

                <div class="filter-group">
                    <span class="filter-label">Category:</span>
                    <select id="categoryFilter" class="filter-select">
                        <option value="">All Categories</option>
                    </select>
                </div>

                <div class="filter-group">
                    <span class="filter-label">Status:</span>
                    <select id="statusFilter" class="filter-select">
                        <option value="">All</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>

                <div class="filter-group">
                    <span class="filter-label">Stock:</span>
                    <select id="stockFilter" class="filter-select">
                        <option value="">All Stock</option>
                        <option value="in-stock">In Stock</option>
                        <option value="low-stock">Low Stock</option>
                        <option value="out-of-stock">Out of Stock</option>
                    </select>
                </div>

                <button class="btn btn-secondary" onclick="loadProducts()">
                    <i class="fas fa-sync"></i> Refresh
                </button>
            </div>

            <div id="productsContainer">
                <div class="loading" style="display:block;">
                    <div class="spinner"></div>
                    <p>Loading products.</p>
                </div>
            </div>
        </section>

        <!-- INVENTORY TABLE VIEW -->
        <section id="inventory" class="section">
            <div class="inventory-header">
                <div>
                    <h1 class="inventory-title">Inventory Table View</h1>
                    <p style="margin:0;font-size:0.8rem;color:var(--gray);">
                        Inline edit stock & price just like Seller Central.
                    </p>
                </div>
                <button class="btn btn-primary" onclick="openAddProductModal()">
                    <i class="fas fa-plus"></i> Add Product
                </button>
            </div>

            <div class="filters-bar">
                <div class="filter-group">
                    <span class="filter-label">Status:</span>
                    <select id="inventoryStatusFilter" class="filter-select">
                        <option value="">All</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>

                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="inventorySearch" class="search-input"
                           placeholder="Search by name or ID.">
                </div>
            </div>

            <div class="data-table-wrapper">
                <table class="inventory-table">
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Product</th>
                            <th>Date Created</th>
                            <th>Available</th>
                            <th>Fee Preview</th>
                            <th>Your Price</th>
                            <th style="text-align:right;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryBody">
                    </tbody>
                </table>
            </div>
            <div id="inventoryEmpty" class="inventory-empty" style="display:none;">
                <i class="fas fa-box-open empty-icon"></i>
                <p>No inventory found for current filters.</p>
            </div>
        </section>

        <!-- ORDERS -->
        <section id="orders" class="section">
            <div class="section-header">
                <h1 class="section-title">Orders</h1>
                <button class="btn btn-secondary" onclick="loadSellerOrders()">
                    <i class="fas fa-sync"></i> Refresh
                </button>
            </div>

            <div id="ordersContainer">
                <div class="loading" style="display:block;">
                    <div class="spinner"></div>
                    <p>Loading orders.</p>
                </div>
            </div>
        </section>

        <!-- ANALYTICS -->
        <section id="analytics" class="section">
            <div class="section-header">
                <h1 class="section-title">Business Analytics</h1>
                <div class="filter-group">
                    <select id="analyticsPeriod" class="filter-select">
                        <option value="7">Last 7 Days</option>
                        <option value="30" selected>Last 30 Days</option>
                        <option value="90">Last 90 Days</option>
                        <option value="365">Last Year</option>
                    </select>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalVisitors">0</div>
                    <div class="stat-label">Store Visitors</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="conversionRate">0%</div>
                    <div class="stat-label">Conversion Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgOrderValue">₹0.00</div>
                    <div class="stat-label">Average Order Value</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="bestSelling">0</div>
                    <div class="stat-label">Best Selling Products</div>
                </div>
            </div>

            <div class="chart-container">
                <h3 class="chart-title">Sales Trend</h3>
                <canvas id="analyticsChart" height="100"></canvas>
            </div>
        </section>

        <!-- SETTINGS -->
        <section id="settings" class="section">
            <h1 class="section-title">Store Settings</h1>
            <div class="chart-container">
                <p style="font-size:0.88rem;color:var(--gray);">
                    Store settings configuration UI can be added here later.
                </p>
            </div>
        </section>
    </div>

    <!-- Add/Edit Product Modal -->
    <div class="modal-overlay" id="productModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Add New Product</h2>
                <button class="modal-close" onclick="closeProductModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="productForm" onsubmit="event.preventDefault(); submitProductForm();">
                    <input type="hidden" id="productId">

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="productName">Product Name *</label>
                            <input type="text" id="productName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="productBrand">Brand</label>
                            <input type="text" id="productBrand" class="form-control">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="productDescription">Description *</label>
                        <textarea id="productDescription" class="form-textarea" required></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="productPrice">Price (₹) *</label>
                            <input type="number" id="productPrice" class="form-control" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="productOriginalPrice">Original Price (₹)</label>
                            <input type="number" id="productOriginalPrice" class="form-control" step="0.01">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="productStock">Stock Quantity *</label>
                            <input type="number" id="productStock" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="productUnit">Unit</label>
                            <select id="productUnit" class="form-control-select">
                                <option value="piece">Piece</option>
                                <option value="kg">Kilogram</option>
                                <option value="gram">Gram</option>
                                <option value="liter">Liter</option>
                                <option value="pack">Pack</option>
                                <option value="box">Box</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Category *</label>
                        <div id="categoryOptions" class="category-grid">
                            <!-- categories loaded dynamically -->
                        </div>
                        <input type="hidden" id="productCategory">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="productTags">Tags (comma separated)</label>
                        <input type="text" id="productTags" class="form-control">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Product Images</label>
                        <label class="file-upload">
                            <input type="file" id="productImages" multiple accept="image/*" style="display:none;">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <span>Click to upload images (max 8).</span>
                        </label>
                        <div id="imagePreview" class="image-preview"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" onclick="closeProductModal()">Cancel</button>
                <button class="btn btn-primary" type="button" onclick="submitProductForm()">Save Product</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="modal-overlay" id="loadingOverlay">
        <div class="loading">
            <div class="spinner"></div>
            <p>Processing.</p>
        </div>
    </div>

    <!-- Hybrid Auth client -->
    <script src="https://ecommerce-backend-mlik.onrender.com/hybrid-auth-client.js"></script>

    <script>
        const API_BASE_URL = window.HybridAuthClient?.backendUrl || 'https://ecommerce-backend-mlik.onrender.com/api/v1';

        let currentUser = null;
        let globalProducts = [];
        let globalCategories = [];
        let selectedFiles = [];
        let selectedCategory = '';

        document.addEventListener('DOMContentLoaded', async () => {
            console.log('[Seller] Initializing super dashboard...');
            await initializeAuth();

            await Promise.all([
                loadDashboardData(),
                loadCategories(),
                loadProducts()
            ]);

            setupEventListeners();
            setupCharts();
            console.log('[Seller] Super dashboard ready.');
        });

        async function initializeAuth() {
            if (!window.HybridAuthClient) {
                showAlert('Authentication client failed to load. Refresh the page.', 'error');
                return;
            }

            const isAuthenticated = await window.HybridAuthClient.isAuthenticated();
            if (!isAuthenticated) {
                window.location.href = 'seller-login.html';
                return;
            }

            currentUser = window.HybridAuthClient.getCurrentUser();
            if (!currentUser || (currentUser.role !== 'seller' && currentUser.role !== 'admin')) {
                window.location.href = 'seller-login.html';
                return;
            }

            updateUserInfo();
        }

        function updateUserInfo() {
            if (!currentUser) return;
            const displayName = currentUser.name || currentUser.businessName || 'Seller';
            const initials = displayName.charAt(0).toUpperCase();
            document.getElementById('userName').textContent = displayName;
            document.getElementById('userInitials').textContent = initials;
        }

        function setupEventListeners() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', e => {
                    e.preventDefault();
                    const tab = link.getAttribute('data-tab');
                    switchTab(tab);
                });
            });

            const productSearch = document.getElementById('productSearch');
            if (productSearch) {
                let debounce;
                productSearch.addEventListener('input', () => {
                    clearTimeout(debounce);
                    debounce = setTimeout(filterProducts, 250);
                });
            }

            ['categoryFilter', 'statusFilter', 'stockFilter'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('change', filterProducts);
            });

            const invSearch = document.getElementById('inventorySearch');
            if (invSearch) {
                let debounceInv;
                invSearch.addEventListener('input', () => {
                    clearTimeout(debounceInv);
                    debounceInv = setTimeout(filterInventory, 250);
                });
            }

            const invStatus = document.getElementById('inventoryStatusFilter');
            if (invStatus) invStatus.addEventListener('change', filterInventory);

            const imgInput = document.getElementById('productImages');
            if (imgInput) imgInput.addEventListener('change', handleImageUpload);

            document.querySelectorAll('.file-upload').forEach(el => {
                el.addEventListener('click', () => {
                    const input = el.querySelector('input[type="file"]');
                    if (input) input.click();
                });
            });
        }

        function switchTab(tabId) {
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            const activeLink = document.querySelector(`.nav-link[data-tab="${tabId}"]`);
            if (activeLink) activeLink.classList.add('active');

            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
            const target = document.getElementById(tabId);
            if (target) target.classList.add('active');

            switch (tabId) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'products':
                    if (!globalProducts.length) loadProducts();
                    break;
                case 'inventory':
                    if (!globalProducts.length) {
                        loadProducts().then(() => renderInventoryTable(globalProducts));
                    } else {
                        renderInventoryTable(globalProducts);
                    }
                    break;
                case 'orders':
                    loadSellerOrders();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
            }
        }

        // ==== DASHBOARD ====
        async function loadDashboardData() {
            try {
                let res = await window.HybridAuthClient.apiCall('/seller/enterprise/dashboard');
                if (!res.ok) {
                    res = await window.HybridAuthClient.apiCall('/seller/dashboard');
                }

                if (!res.ok) {
                    throw new Error(`Dashboard API returned ${res.status}`);
                }

                const data = await res.json();
                if (!data || !data.data) return;

                const overview = data.data.overview || {};

                document.getElementById('totalRevenue').textContent =
                    '₹' + (overview.revenue?.total || overview.totalRevenue || 0).toLocaleString();
                document.getElementById('totalOrders').textContent =
                    overview.orders?.total || overview.totalOrders || 0;
                document.getElementById('totalProducts').textContent =
                    overview.products?.active || overview.activeProducts || 0;
                document.getElementById('lowStock').textContent =
                    overview.products?.lowStock || overview.lowStock || 0;

                updateRecentOrders(data.data.recentOrders || []);
            } catch (err) {
                console.error('Dashboard load error', err);
                showAlert('Failed to load dashboard data', 'error');
            }
        }

        function updateRecentOrders(orders) {
            const container = document.getElementById('recentOrders');
            if (!orders || !orders.length) {
                container.innerHTML = '<p class="empty-description">No recent orders</p>';
                return;
            }

            container.innerHTML = orders.slice(0, 5).map(o => `
                <div class="product-detail">
                    <span class="detail-label">Order #${o.orderNumber || (o._id || '').slice(-8)}</span>
                    <span class="detail-value">₹${(o.total || 0).toFixed(2)}</span>
                </div>
            `).join('');
        }

        // ==== PRODUCTS (Grid) ====
        async function loadProducts() {
            const container = document.getElementById('productsContainer');
            container.innerHTML = `
                <div class="loading" style="display:block;">
                    <div class="spinner"></div>
                    <p>Loading products.</p>
                </div>
            `;

            try {
                if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                    navigator.serviceWorker.controller.postMessage({ type: 'CLEAR_API_CACHE' });
                    await new Promise(r => setTimeout(r, 80));
                }

                const cacheBuster = `_t=${Date.now()}`;
                const res = await window.HybridAuthClient.apiCall(`/products?limit=1000&${cacheBuster}`, {
                    method: 'GET'
                });
                const result = await res.json();

                let products = [];
                if (result.success && result.data) {
                    if (Array.isArray(result.data)) products = result.data;
                    else if (Array.isArray(result.data.products)) products = result.data.products;
                } else if (Array.isArray(result)) {
                    products = result;
                }

                globalProducts = products || [];
                renderProducts(globalProducts);
                renderInventoryTable(globalProducts);

            } catch (err) {
                console.error('Products load error', err);
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle empty-icon"></i>
                        <h3 class="empty-title">Error loading products</h3>
                        <p class="empty-description">${err.message}</p>
                        <button class="btn btn-primary" onclick="loadProducts()">
                            <i class="fas fa-sync"></i> Try again
                        </button>
                    </div>
                `;
            }
        }

        function renderProducts(products) {
            const container = document.getElementById('productsContainer');
            if (!products || !products.length) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-box-open empty-icon"></i>
                        <h3 class="empty-title">No products yet</h3>
                        <p class="empty-description">
                            Add your first product to start selling on QuickLocal.
                        </p>
                        <button class="btn btn-primary" onclick="openAddProductModal()">
                            <i class="fas fa-plus"></i> Add your first product
                        </button>
                    </div>
                `;
                return;
            }

            const html = products.map(createProductCard).join('');
            container.innerHTML = `<div class="products-grid">${html}</div>`;
        }

        function createProductCard(product) {
            const imageUrl = product.images?.[0]?.url || 'https://placehold.co/300x200?text=No+Image';
            const categoryName = product.category?.name || 'Uncategorized';
            const stock = product.stock || 0;
            const stockClass = stock === 0 ? 'stock-out' : stock <= 10 ? 'stock-low' : 'stock-in';
            const stockText = stock === 0 ? 'Out of Stock' : stock <= 10 ? 'Low Stock' : 'In Stock';

            return `
                <div class="product-card" data-product-id="${product._id || product.id}">
                    <img src="${imageUrl}" alt="${escapeHtml(product.name || '')}" class="product-image">
                    <div class="product-content">
                        <div class="product-header">
                            <div>
                                <h3 class="product-name">${escapeHtml(product.name || '')}</h3>
                                <span class="product-category">${escapeHtml(categoryName)}</span>
                            </div>
                            <span class="product-stock ${stockClass}">${stockText}</span>
                        </div>
                        <div class="product-details">
                            <div class="product-detail">
                                <span class="detail-label">Price:</span>
                                <span class="detail-value">₹${(product.price || 0).toLocaleString()}</span>
                            </div>
                            <div class="product-detail">
                                <span class="detail-label">Stock:</span>
                                <span class="detail-value">${stock} ${product.unit || 'pieces'}</span>
                            </div>
                            ${product.brand ? `
                            <div class="product-detail">
                                <span class="detail-label">Brand:</span>
                                <span class="detail-value">${escapeHtml(product.brand)}</span>
                            </div>` : ''}
                        </div>
                        <div class="product-actions">
                            <button class="btn btn-secondary btn-sm"
                                onclick="editProduct('${product._id || product.id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-danger btn-sm"
                                onclick="deleteProduct('${product._id || product.id}', '${escapeHtml(product.name || '')}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function filterProducts() {
            const searchTerm = (document.getElementById('productSearch')?.value || '').toLowerCase();
            const categoryId = document.getElementById('categoryFilter')?.value || '';
            const status = document.getElementById('statusFilter')?.value || '';
            const stockFilter = document.getElementById('stockFilter')?.value || '';

            const filtered = globalProducts.filter(product => {
                const name = (product.name || '').toLowerCase();
                const desc = (product.description || '').toLowerCase();
                const matchesSearch = !searchTerm || name.includes(searchTerm) || desc.includes(searchTerm);

                const productCategoryId = product.category?._id || product.category;
                const matchesCategory = !categoryId || productCategoryId === categoryId;

                let matchesStatus = true;
                if (status === 'active') matchesStatus = (product.stock || 0) > 0;
                if (status === 'inactive') matchesStatus = (product.stock || 0) === 0;

                let matchesStock = true;
                const stock = product.stock || 0;
                if (stockFilter === 'in-stock') matchesStock = stock > 10;
                if (stockFilter === 'low-stock') matchesStock = stock > 0 && stock <= 10;
                if (stockFilter === 'out-of-stock') matchesStock = stock === 0;

                return matchesSearch && matchesCategory && matchesStatus && matchesStock;
            });

            renderProducts(filtered);
        }

        // ==== INVENTORY TABLE ====
        function renderInventoryTable(products) {
            const tbody = document.getElementById('inventoryBody');
            const empty = document.getElementById('inventoryEmpty');
            if (!tbody) return;

            if (!products || !products.length) {
                tbody.innerHTML = '';
                if (empty) empty.style.display = 'block';
                return;
            }

            if (empty) empty.style.display = 'none';

            tbody.innerHTML = products.map(p => {
                const img = p.images?.[0]?.url || 'https://placehold.co/60x60?text=No+Img';
                const id = p._id || p.id || '';
                const statusActive = (p.stock || 0) > 0;
                const statusText = statusActive ? 'Active' : 'Inactive';
                const statusClass = statusActive ? 'status-active' : 'status-inactive';
                const created = p.createdAt ? new Date(p.createdAt).toLocaleDateString() : '-';
                const stock = p.stock || 0;
                const fee = ((p.price || 0) * 0.15).toFixed(2);

                const idStr = (id + '') || '';
                const sku = idStr ? idStr.slice(-6).toUpperCase() : 'SKU---';
                const asin = idStr ? 'B0' + idStr.slice(-8).toUpperCase() : 'B0-XXXX';

                return `
                    <tr>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <div class="product-row-main">
                                <img src="${img}" class="inventory-img" alt="">
                                <div class="product-info">
                                    <a href="#" class="product-name-link" onclick="editProduct('${id}');return false;">
                                        ${escapeHtml(p.name || '')}
                                    </a>
                                    <div class="product-meta">SKU: ${sku}</div>
                                    <div class="product-meta">ASIN: ${asin}</div>
                                </div>
                            </div>
                        </td>
                        <td>${created}</td>
                        <td>
                            <input type="number" class="editable-input" value="${stock}"
                                   onchange="quickUpdate('${id}','stock',this.value)">
                        </td>
                        <td>Est. Fee: ₹${fee}</td>
                        <td>
                            <div style="display:flex;align-items:center;gap:4px;">
                                <span>₹</span>
                                <input type="number" class="editable-input" value="${p.price || 0}"
                                       onchange="quickUpdate('${id}','price',this.value)">
                            </div>
                        </td>
                        <td style="text-align:right;">
                            <button class="btn btn-secondary btn-sm" onclick="editProduct('${id}')">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteProduct('${id}','${escapeHtml(p.name || '')}')">
                                Delete
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function filterInventory() {
            const term = (document.getElementById('inventorySearch')?.value || '').toLowerCase();
            const status = document.getElementById('inventoryStatusFilter')?.value || '';

            const filtered = globalProducts.filter(p => {
                const name = (p.name || '').toLowerCase();
                const id = (p._id || p.id || '').toString().toLowerCase();
                const matchesSearch = !term || name.includes(term) || id.includes(term);

                const isActive = (p.stock || 0) > 0;
                let matchesStatus = true;
                if (status === 'active') matchesStatus = isActive;
                if (status === 'inactive') matchesStatus = !isActive;

                return matchesSearch && matchesStatus;
            });

            renderInventoryTable(filtered);
        }

        async function quickUpdate(id, field, value) {
            if (!id) return;
            try {
                const formData = new FormData();
                formData.append(field, value);

                const res = await window.HybridAuthClient.apiCall(`/products/${id}`, {
                    method: 'PUT',
                    body: formData
                });

                if (res.ok) {
                    showAlert(`${field} updated`, 'success');
                    const idx = globalProducts.findIndex(p => (p._id || p.id) === id);
                    if (idx !== -1) {
                        globalProducts[idx][field] = (field === 'price' || field === 'stock')
                            ? Number(value) : value;
                    }
                    renderProducts(globalProducts);
                    filterInventory();
                    loadDashboardData();
                } else {
                    showAlert(`Failed to update ${field}`, 'error');
                }
            } catch (e) {
                console.error('quickUpdate error', e);
                showAlert(`Error updating ${field}`, 'error');
            }
        }

        // ==== CATEGORIES ====
        async function loadCategories() {
            try {
                let response = await window.HybridAuthClient.apiCall('/categories?limit=50');
                const result = await response.json();

                let categories = [];
                if (result.success && result.data) {
                    categories = result.data.categories || result.data;
                } else if (Array.isArray(result.categories)) {
                    categories = result.categories;
                } else if (Array.isArray(result)) {
                    categories = result;
                }

                globalCategories = categories || [];
                populateCategoryFilters();
            } catch (e) {
                console.error('Category load error', e);
            }
        }

        function populateCategoryFilters() {
            const categorySelect = document.getElementById('categoryFilter');
            const categoryOptions = document.getElementById('categoryOptions');

            if (categorySelect) {
                categorySelect.innerHTML =
                    '<option value="">All Categories</option>' +
                    (globalCategories || []).map(c =>
                        `<option value="${c._id}">${escapeHtml(c.name)}</option>`
                    ).join('');
            }

            if (categoryOptions) {
                categoryOptions.innerHTML = (globalCategories || []).map(c => `
                    <div class="category-item" data-category-id="${c._id}">
                        <i class="fas fa-tag"></i>
                        <span>${escapeHtml(c.name)}</span>
                    </div>
                `).join('');

                document.querySelectorAll('.category-item').forEach(item => {
                    item.addEventListener('click', () => {
                        document.querySelectorAll('.category-item')
                            .forEach(i => i.classList.remove('selected'));
                        item.classList.add('selected');
                        selectedCategory = item.dataset.categoryId;
                        document.getElementById('productCategory').value = selectedCategory;
                    });
                });
            }
        }

        // ==== PRODUCT MODAL ====
        function openAddProductModal() {
            document.getElementById('modalTitle').textContent = 'Add New Product';
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = '';
            selectedFiles = [];
            selectedCategory = '';
            document.getElementById('productCategory').value = '';
            document.getElementById('imagePreview').innerHTML = '';

            document.querySelectorAll('.category-item').forEach(i => i.classList.remove('selected'));

            document.getElementById('productModal').classList.add('active');
        }

        function openEditModal(productId) {
            const product = globalProducts.find(p => (p._id || p.id) === productId);
            if (!product) return;

            document.getElementById('modalTitle').textContent = 'Edit Product';
            document.getElementById('productId').value = product._id || product.id;
            document.getElementById('productName').value = product.name || '';
            document.getElementById('productBrand').value = product.brand || '';
            document.getElementById('productDescription').value = product.description || '';
            document.getElementById('productPrice').value = product.price || '';
            document.getElementById('productOriginalPrice').value = product.originalPrice || '';
            document.getElementById('productStock').value = product.stock || '';
            document.getElementById('productUnit').value = product.unit || 'piece';
            document.getElementById('productTags').value =
                Array.isArray(product.tags) ? product.tags.join(', ') : (product.tags || '');

            const categoryId = product.category?._id || product.category;
            if (categoryId) {
                selectedCategory = categoryId;
                document.getElementById('productCategory').value = categoryId;

                document.querySelectorAll('.category-item').forEach(item => {
                    item.classList.toggle('selected', item.dataset.categoryId === categoryId);
                });
            }

            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';
            if (product.images && product.images.length) {
                product.images.forEach(img => {
                    const div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = `
                        <img src="${img.url}" alt="Product Image">
                        <button type="button" class="image-remove" onclick="removeImage(this)">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    preview.appendChild(div);
                });
            }

            selectedFiles = [];
            document.getElementById('productModal').classList.add('active');
        }

        function editProduct(productId) {
            openEditModal(productId);
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.remove('active');
        }

        function handleImageUpload(e) {
            const files = Array.from(e.target.files || []);
            if (files.length > 8) {
                showAlert('Maximum 8 images allowed', 'warning');
                return;
            }
            selectedFiles = files;
            displayImagePreviews(files);
        }

        function displayImagePreviews(files) {
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';

            files.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = ev => {
                    const div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = `
                        <img src="${ev.target.result}" alt="Preview ${index + 1}">
                        <button type="button" class="image-remove" onclick="removeUploadedImage(${index})">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    preview.appendChild(div);
                };
                reader.readAsDataURL(file);
            });
        }

        function removeUploadedImage(index) {
            selectedFiles.splice(index, 1);
            const dt = new DataTransfer();
            selectedFiles.forEach(f => dt.items.add(f));
            document.getElementById('productImages').files = dt.files;
            displayImagePreviews(selectedFiles);
        }

        function removeImage(btn) {
            const item = btn.closest('.image-preview-item');
            if (item) item.remove();
        }

        async function submitProductForm() {
            const form = document.getElementById('productForm');
            if (!form.checkValidity()) {
                showAlert('Please fill all required fields', 'warning');
                return;
            }
            if (!selectedCategory && !document.getElementById('productCategory').value) {
                showAlert('Please select a category', 'warning');
                return;
            }

            const productId = document.getElementById('productId').value;
            const isEdit = !!productId;

            showLoading(true);

            try {
                const formData = new FormData();
                formData.append('name', document.getElementById('productName').value);
                formData.append('description', document.getElementById('productDescription').value);
                formData.append('price', document.getElementById('productPrice').value);
                formData.append('category', selectedCategory || document.getElementById('productCategory').value);
                formData.append('stock', document.getElementById('productStock').value);
                formData.append('unit', document.getElementById('productUnit').value);

                const brand = document.getElementById('productBrand').value;
                if (brand) formData.append('brand', brand);

                const originalPrice = document.getElementById('productOriginalPrice').value;
                if (originalPrice) formData.append('originalPrice', originalPrice);

                const tags = document.getElementById('productTags').value;
                if (tags) {
                    formData.append('tags', tags.split(',').map(t => t.trim()).join(','));
                }

                selectedFiles.forEach(file => formData.append('images', file));

                const url = isEdit ? `/products/${productId}` : '/products';
                const method = isEdit ? 'PUT' : 'POST';

                const res = await window.HybridAuthClient.apiCall(url, {
                    method,
                    body: formData
                });
                const data = await res.json();

                if (res.ok) {
                    showAlert(isEdit ? 'Product updated successfully!' : 'Product created successfully!', 'success');
                    closeProductModal();

                    if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                        navigator.serviceWorker.controller.postMessage({ type: 'CLEAR_API_CACHE' });
                    }

                    await loadProducts();
                    await loadDashboardData();
                } else {
                    throw new Error(data.message || 'Operation failed');
                }

            } catch (e) {
                console.error('Submit error', e);
                showAlert(`Failed to save product: ${e.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        async function deleteProduct(productId, productName) {
            if (!confirm(`Delete "${productName}"? This cannot be undone.`)) return;

            showLoading(true);
            try {
                const res = await window.HybridAuthClient.apiCall(`/products/${productId}`, {
                    method: 'DELETE'
                });

                if (res.ok || res.status === 204) {
                    showAlert('Product deleted', 'success');

                    if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                        navigator.serviceWorker.controller.postMessage({ type: 'CLEAR_API_CACHE' });
                    }

                    globalProducts = globalProducts.filter(p => (p._id || p.id) !== productId);
                    renderProducts(globalProducts);
                    filterInventory();
                    await loadDashboardData();
                } else {
                    throw new Error('Delete failed');
                }
            } catch (e) {
                console.error('Delete error', e);
                showAlert('Failed to delete product', 'error');
            } finally {
                showLoading(false);
            }
        }

        // ==== ORDERS ====
        async function loadSellerOrders() {
            const container = document.getElementById('ordersContainer');
            container.innerHTML = `
                <div class="loading" style="display:block;">
                    <div class="spinner"></div>
                    <p>Loading orders.</p>
                </div>
            `;

            try {
                const res = await window.HybridAuthClient.apiCall('/seller/orders');
                const result = await res.json();

                if (result.success && result.data && result.data.length) {
                    displayOrders(result.data);
                } else {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-shopping-bag empty-icon"></i>
                            <h3 class="empty-title">No orders yet</h3>
                            <p class="empty-description">
                                Orders will appear here once customers start buying your products.
                            </p>
                        </div>
                    `;
                }
            } catch (e) {
                console.error('Orders load error', e);
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle empty-icon"></i>
                        <h3 class="empty-title">Error loading orders</h3>
                        <p class="empty-description">${e.message}</p>
                    </div>
                `;
            }
        }

        function displayOrders(orders) {
            const container = document.getElementById('ordersContainer');
            const html = orders.map(o => `
                <div class="stat-card">
                    <div class="product-detail">
                        <span class="detail-label">Order #${o.orderNumber || (o._id || '').slice(-8)}</span>
                        <span class="detail-value">₹${(o.total || 0).toFixed(2)}</span>
                    </div>
                    <div class="product-detail">
                        <span class="detail-label">Status:</span>
                        <span class="detail-value">${o.status || 'Pending'}</span>
                    </div>
                    <div class="product-detail">
                        <span class="detail-label">Customer:</span>
                        <span class="detail-value">${o.customerName || 'Guest'}</span>
                    </div>
                    <div class="product-detail">
                        <span class="detail-label">Date:</span>
                        <span class="detail-value">
                            ${o.createdAt ? new Date(o.createdAt).toLocaleDateString() : '-'}
                        </span>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `<div class="stats-grid">${html}</div>`;
        }

        // ==== ANALYTICS ====
        async function loadAnalytics() {
            try {
                const res = await window.HybridAuthClient.apiCall('/seller/enterprise/analytics');
                const data = await res.json();
                if (data.success && data.data) {
                    updateAnalyticsData(data.data);
                }
            } catch (e) {
                console.error('Analytics load error', e);
            }
        }

        function updateAnalyticsData(data) {
            document.getElementById('totalVisitors').textContent = data.visitors || 0;
            document.getElementById('conversionRate').textContent =
                `${(data.conversionRate || 0).toFixed(1)}%`;
            document.getElementById('avgOrderValue').textContent =
                `₹${(data.avgOrderValue || 0).toFixed(2)}`;
            document.getElementById('bestSelling').textContent = data.bestSelling || 0;
        }

        // ==== CHARTS ====
        function setupCharts() {
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Sales (₹)',
                        data: [1200, 1800, 900, 1600, 2300, 1900, 2700],
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99,102,241,0.12)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            const analyticsCtx = document.getElementById('analyticsChart').getContext('2d');
            new Chart(analyticsCtx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Revenue (₹)',
                        data: [15000, 18000, 22000, 16000, 25000, 30000],
                        backgroundColor: '#10b981'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // ==== UTILITIES ====
        function showLoading(show) {
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }

        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            container.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 4500);
        }

        function escapeHtml(text) {
            if (text == null) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function logout() {
            if (window.HybridAuthClient) {
                window.HybridAuthClient.logout();
            }
            window.location.href = 'seller-login.html';
        }
    </script>
</body>
</html>
